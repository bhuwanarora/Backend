(function(e){"use strict";e.module("ngSlider",["ngSanitize"]).directive("slider",["$timeout",function(e){return{restrict:"AE",require:"?ngModel",scope:{options:"="},priority:1,template:'<span ng-class="mainSliderClass" id="{{sliderTmplId}}">'+"<table><tr><td>"+'<div class="jslider-bg">'+'<i class="l"></i><i class="f"></i><i class="r"></i>'+"</div>"+'<div class="jslider-pointer"></div>'+'<div class="jslider-pointer jslider-pointer-to"></div>'+'<div class="jslider-label"><span ng-bind-html="from"></span></div>'+'<div class="jslider-label jslider-label-to"><span ng-bind-html="to"></span>{{options.dimension}}</div>'+'<div class="jslider-value"><span></span>{{options.dimension}}</div>'+'<div class="jslider-value jslider-value-to"><span></span>{{options.dimension}}</div>'+'<div class="jslider-scale" id="{{sliderScaleDivTmplId}}"></div>'+"</td></tr></table>"+"</span>",link:function(t,n,r,i){if(!i)return;t.sliderTmplId=r.id+"-slider-span";t.sliderScaleDivTmplId=r.id+"-slider-scale";t.mainSliderClass="jslider";t.mainSliderClass+=" jslider_round";i.$render=function(){if(!i.$viewValue.split(";")[1])t.mainSliderClass+=" jslider-single";t.init()};t.init=function(){t.from=""+t.options.from;t.to=""+t.options.to;var n={from:t.options.from,to:t.options.to,step:t.options.step,smooth:t.options.smooth,limits:true,round:t.options.round||0,value:i.$viewValue,dimension:"",scale:t.options.scale,sliderSpanId:t.sliderTmplId,callback:function(e){t.$apply(function(){i.$setViewValue(e)})}};if(t.options.calculate)n.calculate=t.options.calculate;e(function(){$("#"+r.id).slider(n);$("#"+t.sliderScaleDivTmplId).html(t.generateScale());t.drawScale()})};t.generateScale=function(){if(t.options.scale&&t.options.scale.length>0){var e="";var n=t.options.scale;var r=Math.round(100/(n.length-1)*10)/10;for(var i=0;i<n.length;i++){e+='<span style="left: '+i*r+'%">'+(n[i]!="|"?"<ins>"+n[i]+"</ins>":"")+"</span>"}return e}else return"";return""};t.drawScale=function(){$("#"+r.id+"-slider-span").find(".jslider-scale span ins").each(function(){$(this).css({marginLeft:-$(this).outerWidth()/2})})};t.$watch("options",function(e){t.init()})}}}]);(function(e){function n(e){if(typeof e=="undefined")return false;if(e instanceof Array||!(e instanceof Object)&&Object.prototype.toString.call(e)=="[object Array]"||typeof e.length=="number"&&typeof e.splice!="undefined"&&typeof e.propertyIsEnumerable!="undefined"&&!e.propertyIsEnumerable("splice")){return true}return false}function r(){return this.init.apply(this,arguments)}function i(){this._init.apply(this,arguments)}function s(){i.apply(this,arguments)}var t={settings:{from:1,to:40,step:1,smooth:true,limits:true,round:0,value:"3",dimension:""},className:"jslider",selector:".jslider-"};e.slider=function(t,n){var i=e(t);if(!i.data("jslider"))i.data("jslider",new r(t,n));return i.data("jslider")};e.fn.slider=function(t,r){function o(e){return e!==undefined}function u(e){return o(e)&&e!==null}var i,s=arguments;this.each(function(){e(this).data("jslider",null);var a=e.slider(this,t);if(typeof t=="string"){var f;switch(t){case"value":if(o(s[1])&&o(s[2])){f=a.getPointers();if(u(f[0])&&u(s[1])){f[0].set(s[1]);f[0].setIndexOver()}if(u(f[1])&&u(s[2])){f[1].set(s[2]);f[1].setIndexOver()}}else if(o(s[1])){f=a.getPointers();if(u(f[0])&&u(s[1])){f[0].set(s[1]);f[0].setIndexOver()}}else i=a.getValue();break;case"prc":if(o(s[1])&&o(s[2])){f=a.getPointers();if(u(f[0])&&u(s[1])){f[0]._set(s[1]);f[0].setIndexOver()}if(u(f[1])&&u(s[2])){f[1]._set(s[2]);f[1].setIndexOver()}}else if(o(s[1])){f=a.getPointers();if(u(f[0])&&u(s[1])){f[0]._set(s[1]);f[0].setIndexOver()}}else i=a.getPrcValue();break;case"calculatedValue":var l=a.getValue().split(";");i="";for(var c=0;c<l.length;c++){i+=(c>0?";":"")+a.nice(l[c])}break;case"skin":a.setSkin(s[1]);break}}else if(!t&&!r){if(!n(i))i=[];i.push(a)}});if(n(i)&&i.length==1)i=i[0];return i||this};r.prototype.init=function(n,r){this.settings=e.extend(true,{},t.settings,r?r:{});this.inputNode=e(n).hide();this.settings.interval=this.settings.to-this.settings.from;if(this.settings.calculate&&e.isFunction(this.settings.calculate))this.nice=this.settings.calculate;if(this.settings.onstatechange&&e.isFunction(this.settings.onstatechange))this.onstatechange=this.settings.onstatechange;this.is={init:false};this.o={};this.create()};r.prototype.create=function(){var n=this;this.domNode=e("#"+this.settings.sliderSpanId);this.inputNode.after(this.domNode);this.sizes={domWidth:this.domNode.width(),domOffset:this.domNode.offset()};e.extend(this.o,{pointers:{},labels:{0:{o:this.domNode.find(t.selector+"value").not(t.selector+"value-to")},1:{o:this.domNode.find(t.selector+"value").filter(t.selector+"value-to")}},limits:{0:this.domNode.find(t.selector+"label").not(t.selector+"label-to"),1:this.domNode.find(t.selector+"label").filter(t.selector+"label-to")}});e.extend(this.o.labels[0],{value:this.o.labels[0].o.find("span")});e.extend(this.o.labels[1],{value:this.o.labels[1].o.find("span")});if(!n.settings.value.split(";")[1]){this.settings.single=true}var r;this.domNode.find(t.selector+"pointer").each(function(e){var t=n.settings.value.split(";")[e];if(t){n.o.pointers[e]=new s(this,e,n);var r=n.settings.value.split(";")[e-1];if(r&&t<r)t=r;t=t<n.settings.from?n.settings.from:t;t=t>n.settings.to?n.settings.to:t;n.o.pointers[e].set(t,true);if(e===0){n.domNode.mousedown(function(t){n.o.pointers[e]._parent={offset:n.domNode.offset(),width:n.domNode.width()};n.o.pointers[e]._mousemove(t);n.o.pointers[e].onmouseup();return false})}}});this.o.value=this.domNode.find(".v");this.is.init=true;e.each(this.o.pointers,function(e){n.redraw(this)});(function(t){e(window).resize(function(){t.onresize()})})(this)};r.prototype.nice=function(e){return e};r.prototype.onstatechange=function(){};r.prototype.limits=function(e,t){if(!this.settings.smooth){var n=this.settings.step*100/this.settings.interval;e=Math.round(e/n)*n}var r=this.o.pointers[1-t.uid];if(r&&t.uid&&e<r.value.prc)e=r.value.prc;if(r&&!t.uid&&e>r.value.prc)e=r.value.prc;if(e<0)e=0;if(e>100)e=100;return Math.round(e*10)/10};r.prototype.setPointersIndex=function(t){e.each(this.getPointers(),function(e){this.index(e)})};r.prototype.getPointers=function(){return this.o.pointers};r.prototype.onresize=function(){var t=this;this.sizes={domWidth:this.domNode.width(),domOffset:this.domNode.offset()};e.each(this.o.pointers,function(e){t.redraw(this)})};r.prototype.update=function(){this.onresize();this.drawScale()};r.prototype.drawScale=function(){this.domNode.find(t.selector+"scale span ins").each(function(){e(this).css({marginLeft:-e(this).outerWidth()/2})})};r.prototype.redraw=function(e){if(!this.is.init)return false;this.setValue();if(this.o.pointers[0]&&this.o.pointers[1])this.o.value.css({left:this.o.pointers[0].value.prc+"%",width:this.o.pointers[1].value.prc-this.o.pointers[0].value.prc+"%"});this.o.labels[e.uid].value.html(this.nice(e.value.origin));this.redrawLabels(e)};r.prototype.redrawLabels=function(e){function t(e,t,r){t.margin=-t.label/2;var i=t.border+t.margin;if(i<0)t.margin-=i;if(t.border+t.label/2>n.sizes.domWidth){t.margin=0;t.right=true}else t.right=false;e.o.css({left:r+"%",marginLeft:t.margin,right:"auto"});if(t.right)e.o.css({left:"auto",right:0});return t}var n=this;var r=this.o.labels[e.uid];var i=e.value.prc;var s={label:r.o.outerWidth(),right:false,border:i*this.sizes.domWidth/100};var o=null;if(!this.settings.single){var u=this.o.pointers[1-e.uid];o=this.o.labels[u.uid];switch(e.uid){case 0:if(s.border+s.label/2>o.o.offset().left-this.sizes.domOffset.left){o.o.css({visibility:"hidden"});o.value.html(this.nice(u.value.origin));r.o.css({visibility:"visible"});i=(u.value.prc-i)/2+i;if(u.value.prc!=e.value.prc){r.value.html(this.nice(e.value.origin)+"&nbsp;&ndash;&nbsp;"+this.nice(u.value.origin));s.label=r.o.outerWidth();s.border=i*this.sizes.domWidth/100}}else{o.o.css({visibility:"visible"})}break;case 1:if(s.border-s.label/2<o.o.offset().left-this.sizes.domOffset.left+o.o.outerWidth()){o.o.css({visibility:"hidden"});o.value.html(this.nice(u.value.origin));r.o.css({visibility:"visible"});i=(i-u.value.prc)/2+u.value.prc;if(u.value.prc!=e.value.prc){r.value.html(this.nice(u.value.origin)+"&nbsp;&ndash;&nbsp;"+this.nice(e.value.origin));s.label=r.o.outerWidth();s.border=i*this.sizes.domWidth/100}}else{o.o.css({visibility:"visible"})}break}}s=t(r,s,i);if(o){s={label:o.o.outerWidth(),right:false,border:u.value.prc*this.sizes.domWidth/100};s=t(o,s,u.value.prc)}this.redrawLimits()};r.prototype.redrawLimits=function(){if(this.settings.limits){var e=[true,true];for(var t in this.o.pointers){if(!this.settings.single||t===0){var n=this.o.pointers[t];var r=this.o.labels[n.uid];var i=r.o.offset().left-this.sizes.domOffset.left;var s=this.o.limits[0];if(i<s.outerWidth())e[0]=false;s=this.o.limits[1];if(i+r.o.outerWidth()>this.sizes.domWidth-s.outerWidth())e[1]=false}}for(var o=0;o<e.length;o++){if(e[o])this.o.limits[o].fadeIn("fast");else this.o.limits[o].fadeOut("fast")}}};r.prototype.setValue=function(){var e=this.getValue();this.inputNode.attr("value",e);this.onstatechange.call(this,e)};r.prototype.getValue=function(){if(!this.is.init)return false;var t=this;var n="";e.each(this.o.pointers,function(e){if(this.value.prc!==undefined&&!isNaN(this.value.prc))n+=(e>0?";":"")+t.prcToValue(this.value.prc)});return n};r.prototype.getPrcValue=function(){if(!this.is.init)return false;var t=this;var n="";e.each(this.o.pointers,function(e){if(this.value.prc!==undefined&&!isNaN(this.value.prc))n+=(e>0?";":"")+this.value.prc});return n};r.prototype.prcToValue=function(e){var t;if(this.settings.heterogeneity&&this.settings.heterogeneity.length>0){var n=this.settings.heterogeneity;var r=0;var i=this.settings.from;for(var s=0;s<=n.length;s++){var o;if(n[s])o=n[s].split("/");else o=[100,this.settings.to];if(e>=r&&e<=o[0]){t=i+(e-r)*(o[1]-i)/(o[0]-r)}r=o[0];i=o[1]}}else{t=this.settings.from+e*this.settings.interval/100}return this.round(t)};r.prototype.valueToPrc=function(e,t){var n;if(this.settings.heterogeneity&&this.settings.heterogeneity.length>0){var r=this.settings.heterogeneity;var i=0;var s=this.settings.from;for(var o=0;o<=r.length;o++){var u;if(r[o])u=r[o].split("/");else u=[100,this.settings.to];if(e>=s&&e<=u[1]){n=t.limits(i+(e-s)*(u[0]-i)/(u[1]-s))}i=u[0];s=u[1]}}else{n=t.limits((e-this.settings.from)*100/this.settings.interval)}return n};r.prototype.round=function(e){e=Math.round(e/this.settings.step)*this.settings.step;if(this.settings.round)e=Math.round(e*Math.pow(10,this.settings.round))/Math.pow(10,this.settings.round);else e=Math.round(e);return e};i.prototype.oninit=function(){};i.prototype.events=function(){};i.prototype.onmousedown=function(){this.ptr.css({position:"absolute"})};i.prototype.onmousemove=function(e,t,n){this.ptr.css({left:t,top:n})};i.prototype.onmouseup=function(){};i.prototype.isDefault={drag:false,clicked:false,toclick:true,mouseup:false};i.prototype._init=function(){if(arguments.length>0){this.ptr=e(arguments[0]);this.outer=e(".draggable-outer");this.is={};e.extend(this.is,this.isDefault);var t=this.ptr.offset();this.d={left:t.left,top:t.top,width:this.ptr.width(),height:this.ptr.height()};this.oninit.apply(this,arguments);this._events()}};i.prototype._getPageCoords=function(e){if(e.targetTouches&&e.targetTouches[0]){return{x:e.targetTouches[0].pageX,y:e.targetTouches[0].pageY}}else return{x:e.pageX,y:e.pageY}};i.prototype._bindEvent=function(e,t,n){var r=this;if(this.supportTouches_)e.get(0).addEventListener(this.events_[t],n,false);else e.bind(this.events_[t],n)};i.prototype._events=function(){var t=this;this.supportTouches_="ontouchend"in document;this.events_={click:this.supportTouches_?"touchstart":"click",down:this.supportTouches_?"touchstart":"mousedown",move:this.supportTouches_?"touchmove":"mousemove",up:this.supportTouches_?"touchend":"mouseup"};this._bindEvent(e(document),"move",function(e){if(t.is.drag){e.stopPropagation();e.preventDefault();t._mousemove(e)}});this._bindEvent(e(document),"down",function(e){if(t.is.drag){e.stopPropagation();e.preventDefault()}});this._bindEvent(e(document),"up",function(e){t._mouseup(e)});this._bindEvent(this.ptr,"down",function(e){t._mousedown(e);return false});this._bindEvent(this.ptr,"up",function(e){t._mouseup(e)});this.ptr.find("a").click(function(){t.is.clicked=true;if(!t.is.toclick){t.is.toclick=true;return false}}).mousedown(function(e){t._mousedown(e);return false});this.events()};i.prototype._mousedown=function(t){this.is.drag=true;this.is.clicked=false;this.is.mouseup=false;var n=this.ptr.offset();var r=this._getPageCoords(t);this.cx=r.x-n.left;this.cy=r.y-n.top;e.extend(this.d,{left:n.left,top:n.top,width:this.ptr.width(),height:this.ptr.height()});if(this.outer&&this.outer.get(0)){this.outer.css({height:Math.max(this.outer.height(),e(document.body).height()),overflow:"hidden"})}this.onmousedown(t)};i.prototype._mousemove=function(e){this.is.toclick=false;var t=this._getPageCoords(e);this.onmousemove(e,t.x-this.cx,t.y-this.cy)};i.prototype._mouseup=function(t){var n=this;if(this.is.drag){this.is.drag=false;if(this.outer&&this.outer.get(0)){if(e.browser.mozilla){this.outer.css({overflow:"hidden"})}else{this.outer.css({overflow:"visible"})}if(e.browser.msie&&e.browser.version=="6.0"){this.outer.css({height:"100%"})}else{this.outer.css({height:"auto"})}}this.onmouseup(t)}};window.Draggable=i;s.prototype=new i;s.prototype.oninit=function(e,t,n){this.uid=t;this.parent=n;this.value={};this.settings=this.parent.settings};s.prototype.onmousedown=function(e){this._parent={offset:this.parent.domNode.offset(),width:this.parent.domNode.width()};this.ptr.addClass("jslider-pointer-hover");this.setIndexOver()};s.prototype.onmousemove=function(e,t){var n=this._getPageCoords(e);this._set(this.calc(n.x))};s.prototype.onmouseup=function(t){if(this.parent.settings.callback&&e.isFunction(this.parent.settings.callback))this.parent.settings.callback.call(this.parent,this.parent.getValue());this.ptr.removeClass("jslider-pointer-hover")};s.prototype.setIndexOver=function(){this.parent.setPointersIndex(1);this.index(2)};s.prototype.index=function(e){this.ptr.css({zIndex:e})};s.prototype.limits=function(e){return this.parent.limits(e,this)};s.prototype.calc=function(e){var t=this.limits((e-this._parent.offset.left)*100/this._parent.width);return t};s.prototype.set=function(e,t){this.value.origin=this.parent.round(e);this._set(this.parent.valueToPrc(e,this),t)};s.prototype._set=function(e,t){if(!t)this.value.origin=this.parent.prcToValue(e);this.value.prc=e;this.ptr.css({left:e+"%"});this.parent.redraw(this)}})(jQuery)})(angular)