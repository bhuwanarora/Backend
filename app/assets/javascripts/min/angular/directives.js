websiteApp.directive("moreFilters",["$rootScope","$timeout",function(){return{restrict:"E",controller:["$scope","recommendationService","websiteService","RecommendationUIConstants",function(a,b,c,d){a.handle_left_columns=function(){a.column_heights={show_filters:!0,notifications_style:{"max-height":d.NotificationsMinHeight},friends_grid_style:{height:d.FriendsGridMinHeight}}},a.stop_click_propagation=function(a){a.stopPropagation()},a.toggle_menu=function(){a.show_menu?(a.show_menu=!1,a.filter_expanded=!1):(a.show_menu=!0,a.filter_expanded=!0)}}],templateUrl:"/assets/angular/views/unused/more_filters.html"}}]),websiteApp.directive("notificationLink",function(){return{restrict:"E",templateUrl:"/assets/angular/views/unused/notification_link.html"}}),websiteApp.directive("tickerPopup",function(){return{restrict:"E",templateUrl:"/assets/angular/views/left_panel/shared/ticker_popup.html"}}),websiteApp.directive("filter",["$rootScope","$timeout","$routeParams",function(a,b,c){return{restrict:"E",scope:{filter:"=data",url:"@",hideIcon:"@",textClass:"@",iconClass:"@"},controller:["$scope",function(d){_initialise_filters=function(c){if(d.filter){var e=d.filter.id,f=d.filter.name,g=e==parseInt(d.$routeParams.label_id),h=e==parseInt(d.$routeParams.trend_id),i=e==parseInt(d.$routeParams.grid_id);if(g||h||i){if(d.active=!0,-1==a.filters[c].indexOf(e)){a.filters[c].push(e);var j="SUCCESS-'"+f+"' added to filters.",k=notify(a,j,b);d.$on("destroy",function(){b.cancel(k)})}}else d.active=!1}},_add_listeners=function(){d.$on("resetFilter",function(){d.active&&(d.active=!1)})},(_init=function(){d.$routeParams=c,_initialise_filters("more_filters"),_add_listeners()})()}],templateUrl:"/assets/angular/views/left_panel/partials/filter.html"}}]),websiteApp.directive("header",["$timeout","$rootScope",function(a,b){return{restrict:"E",controller:["$scope",function(c){c.toggle_notification_popup=function(){angular.isDefined(b.popups)&&angular.isDefined(b.popups.show_notifications_popup)&&b.popups.show_notifications_popup?b.popups.show_notifications_popup=!1:(b.popups={},b.popups.show_notifications_popup=!0),c.hide_notification_circle=!0,event.stopPropagation()},_add_listeners=function(){c.$on("gamifyCount",function(d,e,f){if(c.initiate_counting)c.count=c.count+e;else{c.initiate_counting=!0,c.count=e;var g=a(function(){c.is_additive=f,b.user.total_count=f?b.user.total_count+c.count:b.user.total_count-c.count,c.initiate_counting=!1;var d=a(function(){c.count=!1},3e3);c.$on("destroy",function(){a.cancel(d)})},200);c.$on("destroy",function(){a.cancel(g)})}})},(_init=function(){c.count=!1,_add_listeners()})()}],templateUrl:"/assets/angular/views/header/show.html"}}]),websiteApp.directive("navbar",["scroller","$rootScope","websiteService","$timeout","$cookieStore","RecommendationUIConstants",function(a,b,c,d,e,f){return{restrict:"E",controller:["$scope",function(a){a.toggle_bookmarked=function(d){if(b.user.show_profile=!1,b.popups.left_panel_width={},b.style={},delete b.focused_book,delete b.ticker_popup,!a.bookmark_selected){a.panel_selected="BOOKMARK",e.put("tab",a.panel_selected),a.bookmark_selected=!0,a.read_selected=!1;var f=0;c.get_books_bookmarked(f).then(function(a){angular.isArray(a)&&(b.user.books={},b.user.books.bookmarked=[],angular.forEach(a,function(a){var c=[];angular.forEach(b.labels,function(b){if(a[2].indexOf(b.name)>=0)var d={name:b.name,checked:!0};else var d={name:b.name,checked:!1};c.push(d)},c);var d={isbn:a[0],id:a[1],bookmark_status:!0,labels:c};this.push(d)},b.user.books.bookmarked))})}d.stopPropagation()},a.toggle_recommendations=function(){delete b.focused_book,b.popups.left_panel_width={},b.style={},delete b.ticker_popup,b.user.show_profile=!1,(a.bookmark_selected||a.read_selected)&&(a.read_selected=!1,a.bookmark_selected=!1,a.panel_selected="",e.put("tab",a.panel_selected),a.reset())},a.toggle_read=function(){if(b.user.show_profile=!1,delete b.focused_book,b.popups.left_panel_width={},b.style={},delete b.ticker_popup,!a.read_selected){a.glowShelf=!1,a.bookmark_selected=!1,a.read_selected=!0,a.panel_selected="READ",e.put("tab",a.panel_selected);var d=0;c.get_books_read(d).then(function(a){b.user.books={},b.user.books.read=[],angular.forEach(a,function(a){var b={isbn:a[0],id:a[1],status:!0};this.push(b)},b.user.books.read)})}},a.reset_filter=function(b,c,d,e){var f="timeGroup"==d||"readingTime"==d||"country"==d;if(c){if(f){var g={name:"<span class='icon-loop'></span><span>&nbsp;Reset</span>"};a.advance_filter_changed(g,d)}else a.clear_filter(e,d),a.genre="";b.stopPropagation()}else f||(a.handle_left_columns(),_handle_filter_selection(d))},_handle_filter_selection=function(b){if("genre"==b){a.show_lists=!1,a.genre_selected=!0;var c=d(function(){a.genre_selected=!1},1e3);a.$on("destroy",function(){d.cancel(c)})}if("author"==b){a.show_lists=!1,a.author_selected=!0;var c=d(function(){a.author_selected=!1},500);a.$on("destroy",function(){d.cancel(c)})}},a.handle_notification_ticker_size=function(c,d){var e=angular.isDefined(c);if(e)var g=c.deltaY>0;else var g=d;g&&(a.column_heights={notifications_style:{"max-height":f.NotificationsMaxHeight},friends_grid_style:{height:f.FriendsGridMinHeight},show_filters:!1}),delete b.ticker_popup,e&&c.stopPropagation()},a.goto_info_card=function(a){angular.isDefined(a)&&(b.user.profile_status=a),b.user.compressed_info=!1,b.user.collapsed_column=!0,b.user.collapsed_filters=!0,b.user.collapsed_friends=!0,b.user.collapsed_trends=!0,b.user.collapsed_lists=!0,b.user.collapsed_left_column=!0,b.popups.left_panel_width={width:"15%"}},a.toggle_footer=function(){a.compact_footer=!0},_init_shelf=function(){a.read_selected=!1,(angular.isUndefined(a.bookmark_selected)||!a.bookmark_selected)&&(a.bookmark_selected=!1)},_add_listeners=function(){open_shelf_event=a.$on("showBookReadShelf",function(){a.read_selected=!0,event.stopPropagation()})},_init_left_column=function(){a.show_lists=!1,a.column_heights={notifications_style:{"max-height":f.NotificationsMinHeight},friends_grid_style:{height:f.FriendsGridMinHeight},show_filters:!0}},(_init=function(){_init_left_column(),_init_shelf(),a.compact_footer=window.innerWidth<1e3?!0:!1,a.genre_selected=!1,a.author_selected=!1,a.column_heights={show_filters:!1}})()}],templateUrl:"/assets/angular/views/cover/navbar.html"}}]),websiteApp.directive("rate",["$rootScope","$timeout","widgetService","sharedService",function(a,b,c,d){return{restrict:"E",scope:{rate_object:"=data"},controller:["$scope",function(e){e.show_if_rated=function(a){e.temp_rating=e.rate_object.user_rating,e.rate_object.user_rating=parseInt(a)+1,e.ready_to_rate=!0},e.reset_rating=function(){e.ready_to_rate=!1,e.rate_object.user_rating=e.temp_rating},_add_notification=function(){var b=a.user.email;angular.isDefined(a.user.name)&&(b=a.user.name);var c="<span>gave "+e.rate_object.user_rating+"/10 stars to&nbsp;</span><span class='site_color'>"+e.rate_object.title+"</span>",d={thumb:a.user.thumb,message:c,timestamp:(new Date).getTime(),book:{id:e.rate_object.id,title:e.rate_object.title,author_name:e.rate_object.author_name,isbn:e.rate_object.isbn},user:{id:a.user.id,name:b}};e.$emit("addToNotifications",d)},_gamify=function(){e.rate_object.rated||e.$emit("gamifyCount",10,!0)},e.mark_as_rated=function(f,g){_gamify(),e.rate_object.rated=!0,e.rate_object.user_rating=parseInt(f)+1,e.temp_rating=parseInt(f)+1;var h=notify(a,"SUCCESS-Thanks, This will help us to recommend you better books.",b);e.$on("destroy",function(){b.cancel(h)});var i={id:e.rate_object.id,data:e.rate_object.user_rating};(angular.isUndefined(e.rate_object.status)||!e.rate_object.status)&&d.mark_as_read(e,e.rate_object,g),c.rate_this_book(i),_add_notification(),g.stopPropagation()},e.is_active=function(a){var b=!1;if(e.rate_object){var c=parseInt(a)+1;c<=e.rate_object.user_rating&&(b=!0)}return b}}],templateUrl:"/assets/angular/views/shared/rate.html"}}]),websiteApp.directive("bookGrid",["recommendationService","$rootScope",function(a,b){return{restrict:"E",scope:{grid:"=data"},controller:["$scope",function(a){(_init=function(){a.user_id=b.user.id})()}],templateUrl:"/assets/angular/views/home/partials/book_grid.html"}}]),websiteApp.directive("gettingStarted",["$rootScope","$timeout","sharedService","websiteService","WebsiteUIConstants","scroller","RecommendationUIConstants",function(a,b,c,d,e,f,g){return{restrict:"E",controller:["$scope","websiteService",function(d,f){d.mark_as_read=function(a,b){angular.isDefined(a.id)&&(c.bookmark_book(d,a,b,g.InfluentialBooks),c.mark_as_read(d,a,b))},d.close_edit_profile=function(b){a.user.compressed_info=!0,d.popular_books=[],b.stopPropagation()},d.stop_propagation=function(a){a.stopPropagation()},d.save_genre=function(a){var b={genre:a.id,status:!0};f.save_user_info(b)},d.remove_genre=function(a){var b={genre:a.id,status:!1};f.save_user_info(b)},d.search_info_card=function(a,c){var f=a.keyCode==e.KeyUp,g=a.keyCode==e.KeyDown,i=a.keyCode==e.KeyLeft,j=a.keyCode==e.KeyRight,k=a.keyCode==e.Enter,l=a.keyCode==e.Backspace,m=!(f||g||k||i||j);if(m){if("BOOK"==c)var n=d.info.search_book.length>3;else var n=d.info.search_author.length>3;n?(d.popular_books=[{title:"Searching..."}],b.cancel(h),h=b(function(){d.handle_search_input(c)},300)):l?"BOOK"==c?(d.popular_books=[],d.get_popular_books()):(d.popular_authors=[],d.get_popular_authors()):d.popular_books=[{title:"Type more characters..."}]}a.stopPropagation()},d._fetch_book_results=function(a){var b=d.popular_books.length,c=function(){d.all_results_found=!0,d.popular_books.push({title:"All results fetched. "+d.popular_books.length+" books found for <span class='site_color'>"+d.info.search_book+"</span>"})};f.search_books(d.info.search_book,b).then(function(b){if(angular.isDefined(a)&&(d.popular_books=[]),b=b.results,0!=b.length)angular.forEach(b,function(a){var b=null!=a[4],c={isbn:a[0],id:a[1],title:a[2],author_name:a[3],status:b,user_rating:a[5]};this.push(c)},d.popular_books),10!=b.length&&c();else{var e=angular.isUndefined(all_results_found)||!all_results_found;0==d.popular_books.length?e&&(d.all_results_found=!0,d.popular_books=[{title:"No results found..."}]):e&&c()}d.loading=!1})},d.handle_search_input=function(a){d.loading=!0,"BOOK"==a?(d.all_results_found=!1,d.popular_books=[],d._fetch_book_results(!0)):f.search_authors("q="+d.info.search_author).then(function(a){d.popular_authors=[],0!=a.length?angular.forEach(a,function(a){var b={name:a[0]};this.push(b)},d.popular_authors):d.popular_authors=[{title:"No results found..."}],d.loading=!1})},d._get_genres=function(){(angular.isUndefined(d.info.genres)||0==d.info.genres.length)&&(d.info.genres=[],f.get_genres().then(function(a){angular.forEach(a,function(a){var b=null!=a[3],c={name:a[0],id:a[1],icon:a[2],status:b};this.push(c)},d.info.genres)}))},_handle_info_card_bindings=function(b){1==a.user.profile_status?b._get_genres():2==a.user.profile_status?b.get_popular_books():3==a.user.profile_status&&(navigator.geolocation?navigator.geolocation.getCurrentPosition(function(c){var d=c.coords.latitude,e=c.coords.longitude;a.user.latitude=d,a.user.longitude=e,b.set_location()}):x.innerHTML="Geolocation is not supported by this browser.")},_get_info_data=function(){f.get_info_data().then(function(a){d.book_counts=a.reading_count_list,d.user_book_count=d.book_counts[0]})},d.edit_books_read=function(){d.goto_info_card(),a.user.profile_status=2,d.get_popular_books()},d.edit_genres_like=function(){d.goto_info_card(),a.user.profile_status=1,d._get_genres()},d.edit_authors_read=function(){d.goto_info_card(),a.user.profile_status=3,d.get_popular_authors()},d.get_popular_authors=function(){var a=d.popular_authors.length,b=!d.loading;b&&(d.loading=!0,f.get_popular_authors(a).then(function(a){angular.forEach(a,function(a){var b={name:a[0]};this.push(b)},d.popular_authors),d.loading=!1}))},d.get_popular_books=function(){var a=d.popular_books.length,b=!d.loading&&(angular.isUndefined(d.info.search_book)||d.info.search_book.length<1);b?(d.loading=!0,f.get_popular_books(a).then(function(a){angular.forEach(a,function(a){var b=null!=a[4],c={isbn:a[0],id:a[1],title:a[2],author_name:a[3],user_rating:a[5],status:b};this.push(c)},d.popular_books),d.loading=!1})):(angular.isUndefined(all_results_found)||!all_results_found)&&d._fetch_book_results()},d.prev_profile_state=function(){0!=a.user.profile_status?a.user.profile_status=a.user.profile_status-1:a.user.compressed_info=!0,_handle_info_card_bindings(d)},d.next_profile_state=function(){3!=a.user.profile_status?a.user.profile_status=a.user.profile_status+1:a.user.compressed_info=!0,_handle_info_card_bindings(d)},d.stop_horizontal_scroll=function(a){a.stopPropagation()},d.user_profile_changed=function(a){var b={profile:a.name};f.save_user_info(b)},d.add_book=function(){},d.add_author=function(){},d.set_user_name=function(){if(angular.isDefined(a.user.name)&&a.user.name.length>0){var b={name:a.user.name};f.save_user_info(b)}},d.set_email=function(){if(angular.isDefined(a.user.email)&&a.user.email.length>0){var b={email:a.user.email};f.save_user_info(b)}},d.set_gender=function(){if(a.user.gender){var b={gender:a.user.gender};f.save_user_info(b)}},d.set_init_book_read_count=function(){if(a.user.init_book_read_count){var b={init_book_read_count:a.user.init_book_read_count};f.save_user_info(b)}},d.set_init_book_written_count=function(){if(a.user.init_book_written_count){var b={init_book_written_count:a.user.init_book_written_count};f.save_user_info(b)}},d.set_location=function(){if(a.user.latitude){var b={latitude:a.user.latitude,longitude:a.user.longitude};f.save_user_info(b)}},d.set_date_of_birth=function(){var b={selectedYear:a.user.selectedYear,selectedMonth:a.user.selectedMonth,selectedDay:a.user.selectedDay};f.save_user_info(b)};var h="";(_init=function(){if(a.user.profile_status=0,_get_info_data(),d.popular_books=[],d.popular_authors=[],d.loading=!1,d.info={search_book:"",search_author:"",genres:[]},d.profileOptions=[{name:"Reader"},{name:"Author"},{name:"Publisher"},{name:"Editor"}],angular.isUndefined(a.user.ask_info)&&a.user.ask_info){a.user.compressed_info=!1;var b={ask_info:!1};f.save_user_info(b)}else a.user.compressed_info=!0;d.profileSelected={name:"Reader"},d.info_card_width=350,d.info_card_ratio=1.34})()}],templateUrl:"/assets/angular/views/getting_started/show.html"}}]);var facebook_invite=function(){FB.ui({method:"apprequests",message:"Your Message diaolog"})};;websiteApp.directive("siteLogo",[function(){return{restrict:"E",templateUrl:"/assets/angular/views/unused/site_logo.html"}}]),websiteApp.directive("userThumb",[function(){return{restrict:"E",templateUrl:"/assets/angular/views/unused/user_thumb.html"}}]),websiteApp.directive("toggle",function(){return{restrict:"E",scope:{obj:"=data",onSelect:"&",onDeselect:"&"},controller:["$scope",function(a){a.toggle=function(){a.obj.status?(a.obj.status=!1,a.onDeselect()):(a.obj.status=!0,a.onSelect())}}],templateUrl:"/assets/angular/views/getting_started/shared/toggle.html"}}),websiteApp.directive("track",["$rootScope",function(a){return{restrict:"A",link:function(){_record_details=function(b){node_name=b.currentTarget.nodeName,time_stamp=b.timeStamp,thousand_milliseconds=1e5,time_stamp=thousand_milliseconds*(time_stamp%thousand_milliseconds/thousand_milliseconds),action_type=b.type,"A"==node_name&&(node_name=b.currentTarget.href),id=b.currentTarget.id,uid=node_name+":"+id,array=id.split("-"),containsCategory=array.length>1,containsCategory?(category=array[0],book_id=array[1]):(category="",book_id=""),data_json=[{time_stamp:time_stamp,action_type:action_type,node_name:node_name,uid:uid,category:category,book_id:book_id}],a.data=a.data.concat(data_json)}}}}]),websiteApp.directive("horizontalScroller",function(){return{restrict:"E",templateUrl:"/assets/angular/views/unused/horizontal_scroller.html"}}),websiteApp.directive("setFocus",["$timeout","$parse","$rootScope",function(a,b,c){return{link:function(d,e,f){var g=b(f.setFocus);d.$watch(g,function(b){1==b&&a(function(){c.keyCode&&(e[0].value=String.fromCharCode(c.keyCode)),e[0].focus()})})}}}]),websiteApp.directive("typeAhead",["$timeout","$sce","$document",function(a){return{restrict:"E",scope:{items:"=",prompt:"@",title:"@",id:"@",custom:"@",iconClass:"@",customOptions:"@",focusWhen:"=",subtitle:"@",model:"=",itemId:"=",onSelect:"&",autoPopulate:"&",onClear:"&"},link:function(){},controller:["$scope","$sce","recommendationService","WebsiteUIConstants",function(b,c,d,e){b.is_current=function(a,c){return b.current==a&&(b.currentItem=c.name,b.currentItemId=c.id),b.current==a},b.set_current=function(a){b.current=a},b.navigate_options=function(){var a=event.keyCode==e.Enter;a&&b.handle_selection(b.currentItem,b.currentItemId)},b.key_up=function(){var a=event.keyCode==e.KeyUp,c=event.keyCode==e.KeyDown,d=event.keyCode==e.Backspace;a?b.set_current(0!=b.current?b.current-1:b.filtered.length-1):c?b.set_current(b.current!=b.filtered.length-1?b.current+1:0):d&&(angular.isUndefined(b.model)||""==b.model)&&(b.filtered=[],b.onClear())},_init=function(){b.current=0,b.selected=!0,b.name=""},b.focus_on_input=function(){},b.auto_populate=function(){b.autoPopulate()},b.highlight=function(a,b){return angular.isDefined(b)&&angular.isDefined(a)?c.trustAsHtml(b.replace(new RegExp(a,"gi"),'<span style="font-weight:bold;">$&</span>')):void 0},b.remove_filter=function(){b.model="",b.onClear()},b.handle_selection=function(c,d){angular.isDefined(d)?(b.itemId=d,b.model=c.toUpperCase()):(b.itemId=c.id,b.model=c.name.toUpperCase()),b.current=0,b.selected=!0,a(function(){b.onSelect()},200)},_init()}],templateUrl:"/assets/angular/views/unused/type_ahead.html"}}]),websiteApp.directive("message",function(){return{restrict:"E",controller:["$scope",function(a){a.close_message=function(){"Allow your webcam. Swipe Left|Right to look for more books."==a.message?a.message='Just "START TYPING" anytime to search.':a.message_closed=!0},_init_motion_adaption=function(){},(_init=function(){a.message_closed=!0})()}],templateUrl:"/assets/angular/views/unused/message.html"}}),websiteApp.directive("notification",["$rootScope","$timeout","$location","$routeParams",function(a,b,c,d){return{restrict:"E",scope:{notification:"=data"},controller:["$scope",function(e){e.toggle_ticker_popup=function(d,f){var g=angular.isDefined(f.title);if(g)c.path("/user/"+a.user.id+"/trending/books/id/"+f.id+"/name/"+f.name);else{var h=null==a.ticker_popup;if(h)angular.isDefined(e.notification.book)&&null!=e.notification.book.id&&(a.ticker_popup=e.notification.book,delete a.focused_book,a.popups.left_panel_width={},a.style={});else if(a.ticker_popup==e.notification.book)delete a.ticker_popup;else{delete a.ticker_popup;var i=b(function(){angular.isDefined(e.notification.book.id)&&null!=e.notification.book.id&&(a.ticker_popup=e.notification.book)},200);e.$on("destroy",function(){b.cancel(i)})}}d.stopPropagation()},_get_arrow_position=function(a){var b=90,c=17;return a.y>b&&a.y<b+54||(a.y>b+54&&a.y<b+108?c+=54:a.y>b+108&&a.y<b+162?c+=108:a.y>b+162&&a.y<b+216?c+=162:a.y>b+216&&a.y<b+270&&(c+=216)),c},e.show_ticker_popup=function(){a.ticker_popup=e.notification.book},(_init=function(){e.$routeParams=d})()}],templateUrl:"/assets/angular/views/left_panel/partials/notification.html"}}]),websiteApp.directive("compile",["$compile",function(a){return["scope","element","attrs",function(b,c,d){var e=b.$watch(function(a){return a.$eval(d.compile)},function(d){c.html(d),a(c.contents())(b),e()})}]}]),websiteApp.directive("searchBar",function(){return{restrict:"E",templateUrl:"/assets/angular/views/search/partials/search_bar.html"}}),websiteApp.directive("checkScrollBottom",function(){return{restrict:"A",link:function(a,b,c){var d=b[0];b.bind("scroll",function(){var b=20;d.scrollTop+d.offsetHeight+b>d.scrollHeight&&a.$apply(c.checkScrollBottom)})}}}),websiteApp.directive("checkScrollUp",function(){return{restrict:"A",link:function(a,b,c){var d=b[0],e=d.scrollTop;b.bind("scroll",function(){d.scrollTop<=e&&a.$apply(c.checkScrollUp),e=d.scrollTop})}}}),websiteApp.directive("checkScrollDown",function(){return{restrict:"A",link:function(a,b,c){var d=b[0],e=d.scrollTop;b.bind("scroll",function(){d.scrollTop>e&&a.$apply(c.checkScrollDown),e=d.scrollTop})}}}),websiteApp.directive("focusOut",function(){return function(a,b,c){b.bind("blur",function(){a.$apply(c.focusOut)})}}),websiteApp.directive("calendar",["$rootScope",function(a){return{restrict:"E",scope:{saveDate:"&"},controller:["$scope",function(b){b.date_check=function(){var a=b.months.indexOf(b.selectedMonth)+1,c=new Date(b.selectedYear,a,0).getDate();b.days=new Array(c).join().split(",").map(function(a,b){return++b})},b.save_date=function(c,d,e){a.user.selectedDay=e,a.user.selectedMonth=d,a.user.selectedYear=c,b.saveDate()},(_init=function(){b.days=new Array(31).join().split(",").map(function(a,b){return++b}),b.months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],b.years=[],b.selectedDay=a.user.selectedDay,b.selectedMonth=a.user.selectedMonth,b.selectedYear=a.user.selectedYear;for(var c=(new Date).getFullYear(),d=c;d>1904;d--)b.years.push(d)})()}],templateUrl:"/assets/angular/views/getting_started/shared/calendar.html"}}]),websiteApp.directive("feedbackPopup",["$document","websiteService","$rootScope","$timeout",function(a,b,c,d){return{restrict:"A",link:function(a,b){b=b.children()},controller:["$scope",function(a){a.get_feedback=!1,a.feedback_text="Feedback",c.user.feedback="",a.handle_feedback=function(){if(c.user.feedback.length>8){var e={feedback:c.user.feedback};a.feedback_text="Sent! :)",b.save_feedback(e),c.user.feedback="";var f=d(function(){g()},3e3);a.$on("destroy",function(){d.cancel(f)})}else a.feedback_text="Please elaborate a bit more..";var g=function(){a.feedback_text="Feedback"}}}],templateUrl:"/assets/angular/views/footer/feedback_popup.html"}}]),websiteApp.directive("feed",["$rootScope","$timeout","websiteService","widgetService","WebsiteUIConstants","StatusUIConstants",function(a,b,c,d,e,f){return{restrict:"E",controller:["$scope",function(g){g.update_hashtagged_comment=function(){},g.get_notifications=function(a,b){g.$emit("getNotifications",a,b)},_clear_focus=function(){var a=b(function(){g.start_searching=!1},200);g.$on("destroy",function(){b.cancel(a)})},g.handle_interact_book_selection=function(b){g.current_interact_book=0,g.selected_interact_book=b,a.user.interact_books=[],event.stopPropagation()},g.remove_selected_book=function(){a.user.interact_books=[],g.placeholder=e.Share,delete g.selected_interact_book},g.is_current_interact_book=function(a,b){return g.current_interact_book==a&&(g.current_interact_book_item=b),g.current_interact_book==a},g.set_current_interact_book=function(a){g.current_interact_book=a},g.search_interact_books=function(d){var f=d.keyCode==e.KeyUp,h=d.keyCode==e.KeyDown,i=d.keyCode==e.Enter,j=d.keyCode==e.Backspace,k=!(f||h||i);if(f?g.set_current_interact_book(0!=g.current_interact_book?g.current_interact_book-1:a.user.interact_books.length-1):h?g.set_current_interact_book(g.current_interact_book!=a.user.interact_books.length-1?g.current_interact_book+1:0):i&&(g.handle_interact_book_selection(g.current_interact_book_item),d.preventDefault()),k){var l=g.user.interact_book.length>3;if(l)var m=b(function(){g.loading=!0,c.search(g.user.interact_book,"BOOK",10).then(function(a){g.user.interact_books=[],a=a.results.data,0!=a.length?angular.forEach(a,function(a){var b={title:a[0],author_name:a[1],id:a[2]};this.push(b)},g.user.interact_books):g.user.interact_books=[],g.loading=!1,b.cancel(m)})},500);else j&&(g.user.interact_books=[])}},g.select_level1=function(a,b){g.level1_option=a,delete g.level2_option,delete g.level3_option,g.level1_options=[],g.level2_options=a.value,g.show_search=angular.isDefined(a.value)&&angular.isDefined(a.value[0])&&a.value[0].SearchBook,g.start_searching=g.show_search,_clear_focus(),b.stopPropagation()},g.select_level2=function(a,b){g.level2_option=a,g.level3_option=a,g.level1_options=[],g.level2_options=[],g.show_search=angular.isDefined(a.value)&&angular.isDefined(a.value[0])&&a.value[0].SearchBook,g.start_searching=g.show_search,_clear_focus(),b.stopPropagation()},g.show_interaction_options=function(a,b){a==f.EmotionConstants.name?g.level1_options=f.EmotionConstants.value:a==f.OwnershipConstants.name?g.level1_options=f.OwnershipConstants.value:a==f.QuoteConstants.name&&(g.level1_options=f.QuoteConstants.value),g.level2_options=[],delete g.level1_option,delete g.level2_option,delete g.level3_option,b.stopPropagation()},g.stop_propagation=function(a){g.level1_options=[],g.level2_options=[],a.stopPropagation()},g.close_interaction_box=function(){angular.isDefined(g.hash_tags)&&g.hash_tags.length>0?g.hash_tags=[]:angular.isDefined(g.level1_options)&&g.level1_options.length>0?g.level1_options=[]:angular.isDefined(g.level2_options)&&g.level2_options.length>0?g.level2_options=[]:angular.isDefined(a.user.interact_books)&&a.user.interact_books.length>0?a.user.interact_books=[]:a.user.interact=!1},g.stop_horizontal_scroll=function(a){a.stopPropagation()},g.handle_selection=function(b){g.current=0;var c=a.user.current_comment.split(" "),d=a.user.hash_tagged_comment.split(" "),e=(String.fromCharCode(event.keyCode),c.length);if(1==e)var f=c.slice(0,e-1).join(" ").trim(),h=d.slice(0,e-1).join(" ").trim();else var f=c.slice(0,e-1).join(" ")+" ",h=d.slice(0,e-1).join(" ")+" ";c.pop(),d.pop(),g.hash_tagging;a.user.hash_tagged_comment=h+"<b>"+b+"</b>",a.user.current_comment=f+b,delete g.hash_tags,event.stopPropagation()},g.handle_backspace=function(b){var c=a.user.current_comment.split(" "),d=a.user.hash_tagged_comment.split(" "),f=(String.fromCharCode(b.keyCode),c.length);if(1==f)var h=c.slice(0,f-1).join(" "),i=d.slice(0,f-1).join(" ");else var h=c.slice(0,f-1).join(" ")+" ",i=d.slice(0,f-1).join(" ")+" ";var j=c.pop(),k=d.pop(),l=b.keyCode==e.Backspace,m=g.hash_tagging;if(l){if("#"==j)g.hash_tagging=!1,delete g.hash_tags,a.user.hash_tagged_comment=i;else{var n=i.split("<b>").length!=i.split("</b>").length,o=">"==k[k.length-1],p=k.indexOf("<br/>")>=0;if(p&&(d=i.split("<br/>"),f=d.length,i=d.slice(0,f-1).join("<br/>"),h=i.replace(/<br\/>/,"")),n&&(d=i.split("<b>"),f=d.length,i=d.slice(0,f-1).join("<b>"),h=i.replace(/<b>/,"").replace(/<\/b>/,"")),m||o)a.user.hash_tagged_comment=i,a.user.current_comment=h,g.is_new_word_initiation=!0,g.hash_tagging=!1,delete g.hash_tags,b.preventDefault();else{var q=a.user.hash_tagged_comment;a.user.hash_tagged_comment=q.substring(0,q.length-1)}}a.user.current_comment&&""!=a.user.current_comment||(a.user.hash_tagged_comment="")}b.stopPropagation()},g.handle_hash_tags=function(b){""==a.user.current_comment.trim()&&(g.is_new_word_initiation=!0);var d=a.user.current_comment.split(" "),f=String.fromCharCode(b.keyCode),h=d.length,i=(d.slice(0,h-1).join(" "),d.pop()),j=g.is_new_word_initiation,k=(g.hash_tagging,b.keyCode==e.Enter);if(k)g.hash_tags?(b.preventDefault(),g.handle_selection(g.currentItem)):(g.hash_tagging=!1,g.is_new_word_initiation=!0,a.user.hash_tagged_comment=a.user.hash_tagged_comment+"<br/>");else{if(j&&"#"==f){var l="<b>"+f+"</b>";g.hash_tagging=!0,a.user.hash_tagged_comment=a.user.hash_tagged_comment+l}else if(j&&"+"==f){var l="<b>"+f+"</b>";g.hash_tagging=!0,a.user.hash_tagged_comment=a.user.hash_tagged_comment+l,g.search_for="TAGS"}else if(j&&"@"==f){var l="<b>"+f+"</b>";g.hash_tagging=!0,a.user.hash_tagged_comment=a.user.hash_tagged_comment+l,g.search_for="[AUTHORS, READERS]"}else if(" "==f)g.hash_tagging=!1,a.user.hash_tagged_comment=a.user.hash_tagged_comment+f,delete g.search_for;else if(g.hash_tagging){var m=a.user.hash_tagged_comment.split("</b>"),n=m.length;if(n>2){var o=m[n-2]+f+"</b>"+m[n-1];a.user.hash_tagged_comment=m.slice(0,n-2).join("</b>")+"</b>"+o}else{var o=m[n-2]+f+"</b>"+m[n-1];a.user.hash_tagged_comment=o}}else a.user.hash_tagged_comment=a.user.hash_tagged_comment+f;g.search_for&&i.length>2&&(string_to_be_searched=i.slice(1,i.length)+""+f,c.search(string_to_be_searched.trim(),g.search_for,3).then(function(a){g.hash_tags=[];for(var b=a.results.data,c=0;c<b.length;c++){var d={name:b[c][0]};g.hash_tags.push(d)}})),g.is_new_word_initiation=" "==f?!0:!1}b.stopPropagation()},g.share_post=function(){var b=a.user.hash_tagged_comment.replace(/<b>/,"<a>").replace(/<\/b>/,"</a>"),c={message:b,user:{name:a.user.name,thumb:a.user.thumb}};c=_add_labels_to_tweet(c);var d=g.selected_interact_book;c=_add_comment(c,d),angular.isDefined(a.focused_book)&&(0==a.focused_book.tweets.length?a.focused_book.tweets=a.focused_book.tweets.concat([c]):a.focused_book.tweets.push(c))},_add_labels_to_tweet=function(a){if(angular.isDefined(g.level1_option)){var b={label1:{name:g.level1_option.name,icon:g.level1_option.icon,label:g.level1_option.label,icon2:g.level1_option.icon2}};a=angular.extend(a,b)}if(angular.isDefined(g.level2_option)){var b={label2:{name:g.level2_option.name,icon:g.level2_option.icon,label:g.level2_option.label,icon2:g.level2_option.icon2}};a=angular.extend(a,b)}return a},_reset_interact_box=function(){delete g.level1_option,delete g.level2_option,a.user.interact_book="",a.user.current_comment="",a.user.hash_tagged_comment="",g.status_message=e.StatusPosted;b(function(){g.status_message=""},5e3);g.$on("destroy",function(){b.cancel("share_timeout_event")})},_get_tag_for_tweet=function(a,b){if(angular.isDefined(a.label2)){if(angular.isDefined(a.label2.icon)&&null!=a.label2.icon)var c=a.label2.icon;else var c=a.label1.icon;var d="<span class='site_color'><span class='"+c+"'></span><span> "+a.label1.name+" "+a.label2.name+" "+b.title+"</span></span>"}else if(angular.isDefined(a.label1))var d="<span class='site_color'><span class='"+a.label1.icon+"'></span><span> "+a.label1.name+" "+b.title+"</span></span>";else if(angular.isDefined(b))var d="<span class='site_color'><span>"+b.title+"</span></span>";else var d=null;return d},_add_comment=function(b){if(angular.isDefined(g.selected_interact_book))var c=g.selected_interact_book;else if(angular.isDefined(a.focused_book))var c=a.focused_book;if(angular.isDefined(a.user.name))var e=a.user.name;else var e=a.user.email;var f="<span>"+b.message+"</span>",h=_get_tag_for_tweet(b,c);if(angular.isDefined(c))var i={id:c.id,message:b},j={thumb:a.user.thumb,message:f,timestamp:(new Date).getTime(),book:{id:c.id,title:c.title,author_name:c.author_name,isbn:c.isbn},user:{id:a.user.id,name:e}};else var i={message:b},j={thumb:a.user.thumb,message:f,timestamp:(new Date).getTime(),user:{id:a.user.id,name:e}};return angular.isDefined(h)&&(j=angular.extend(j,{tag:h})),d.comment(i),g.$emit("addToNotifications",j),_reset_interact_box(),b=angular.extend(b,{tag:h})},g.is_current=function(a,b){return g.current==a&&(g.currentItem=b),g.current==a},g.set_current=function(a){g.current=a},g.key_up=function(){var a=event.keyCode==e.KeyUp,b=event.keyCode==e.KeyDown;a?g.set_current(0!=g.current?g.current-1:g.hash_tags.length-1):b&&g.set_current(g.current!=g.hash_tags.length-1?g.current+1:0)},(_init=function(){g.is_new_word_initiation=!0,g.current=0,g.current_interact_book=0,angular.isDefined(a.focused_book)?(g.selected_interact_book=a.focused_book,g.placeholder="Comment on "+a.focused_book.title+" by "+a.focused_book.author_name+"..."):g.placeholder=e.Share,g.user.interact_book="",g.user.interact_books=[],a.user.hash_tagged_comment="",a.user.current_comment=""})()}],templateUrl:"/assets/angular/views/feed/show.html"}}]),websiteApp.directive("tooltip",function(){return{restrict:"E",scope:{text:"=",prependText:"@",appendText:"@",position:"@",pluralize:"@",scroll:"@",addRelative:"@"},link:function(a,b){angular.isDefined(a.addRelative)&&b.parent().css("position","relative"),b.parent().bind("mouseenter",function(){b.children().css("visibility","visible"),b.children().children().css("font-size","12px"),b.children().children().css("text-shadow","none"),b.children().children().css("font-weight","400"),b.children().children().css("letter-spacing","1px"),b.children().children().css("font-family","helvetica neue"),b.children().children().css("color","#333"),b.children().children().css("line-height","17px");var c=b.children()[0].clientWidth,d=b.children()[0].clientHeight;angular.isDefined(a.scroll)&&(d+=25,b.children().css("max-height","35vh"),b.children().css("overflow-y","scroll"));var e="left"==a.position,f="right"==a.position,g="top"==a.position,h="bottom"==a.position;e?(b.children().css("left","-"+c+"px"),b.children().children().css("border-left-color","#fff"),b.children().children(".tooltip_arrow").css("left",c+"px")):f?(b.children().css("right","-"+c+"px"),b.children().children().css("border-right-color","#fff"),b.children().children(".tooltip_arrow").css("right",c+"px")):h?(b.children().css("bottom","-"+d+"px"),b.children().children().css("border-bottom-color","#fff"),b.children().children(".tooltip_arrow").css("bottom",d+"px")):g&&(b.children().css("top","-"+d+"px"),b.children().children().css("border-top-color","#fff"),b.children().children(".tooltip_arrow").css("top",d+"px"))}),b.parent().bind("mouseleave",function(){b.children().css("visibility","hidden")})},controller:["$scope",function(a){a.stop_horizontal_scroll=function(a){a.stopPropagation()}}],templateUrl:"/assets/angular/views/shared/tooltip.html"}}),websiteApp.directive("profileLink",function(){return{restrict:"E",templateUrl:"/assets/angular/views/header/partials/profile_link.html"}}),websiteApp.directive("timestamp",function(){return{restrict:"E",scope:{timestamp:"=data"},templateUrl:"/assets/angular/views/shared/timestamp.html"}}),websiteApp.directive("userAdd",["$rootScope",function(a){return{restrict:"E",controller:["$scope",function(b){b.show_interaction_box=function(c){a.user.interact=!0,delete a.focused_book,a.style={},delete a.ticker_popup,a.user.collapsed_column=!0,a.user.collapsed_trends=!0,a.user.collapsed_left_column=!0,a.popups.left_panel_width={width:"15%"};var d=!1,e=!0;b.$emit("getNotifications",d,c,e)}}],templateUrl:"/assets/angular/views/home/shared/user_add.html"}}]);;var screen_width=window_width,width=screen_width*(1220/1320)-150,height=window_height*(864/1064)-100,page_numbers={content:1,first_sentence:2,characters:3,quotes:4,themes:5,subject_places:6,movies_based:7,tags:8,readers:9,news:10,reviews:11,discussions:12,about_author:13};websiteApp.directive("dock",["$rootScope","$timeout",function(){return{restrict:"E",controller:["$scope",function(a){a.turn_page=function(b){a.$emit("turnPage",b)}}],templateUrl:"/assets/angular/views/unused/dock.html"}}]),websiteApp.directive("flipbook",["$rootScope","$timeout","scroller",function(a,b,c){return{restrict:"E",replace:!0,compile:["tElement","tAttrs","transclude",function(){var a=width*(10/1320),b=height*(20/1064),d=width/2+a,e=height+b;return _set_elements_height=function(){var a=height-7*b;$(".elements").css("height",a)},_set_depth=function(){$(".depth").css("height",e-b/2)},_set_pre_css=function(){$(".own-size").css("width",d),$(".own-size").css("height",e),$(".back-side").addClass("fixed"),$("#backCoverFold").css("width",d),$("#backCoverFold").css("height",e),$(".author_thumb").css("width",width/2-a),$(".author_thumb").css("height",height-6*b),_set_depth(),_set_elements_height()},_set_post_css=function(){$(".front-side").addClass("fixed"),$("#coverImage").css("width",d),$("#coverImage").css("height",e),$("#frontCoverFold").css("width",d),$("#frontCoverFold").css("height",e),$(".detailed_book").css("position","fixed"),_set_depth()},_update_depth=function(a,b){var c=a.turn("page"),d=a.turn("pages"),e=16*Math.min(1,2*c/d);b=b||c,$(".detailed_book .p2 .depth").css(b>3?{width:e,left:20-e}:{width:0}),e=16*Math.min(1,2*(d-c)/d),$(".detailed_book .p17 .depth").css(d-3>b?{width:e,right:20-e}:{width:0})},_add_listeners_to_content_page=function(a){a.on("click","[data-page]",function(b){var c=page_numbers[$(b.target).data("page")];a.turn("page",c)})},_add_listeners_to_comment_box=function(a){a.on("click",".post_comment",function(){var a=$($(this).parent()),b=a.siblings(".comment_big_box");a.hide(),b.show(),b.find("input").focus()})},_add_listeners_to_post_comment_discussion_page=function(a,b){a.on("keypress",".discussions .comment_box",function(a){if(10==a.which||13==a.which){var d=$(this),e=d.parent().parent().parent().parent(),f=(e.parent().scope().$index,{comment:d.val(),timestamp:"Just now",user:{},nested:!0}),g=e.scope().discussion.nested;if(g)var h=e.scope().$parent.$index;else var h=e.scope().$index;var i=b.detailed_book.book.discussions[h].comments,j=null==i;b.$apply(function(){j?b.detailed_book.book.discussions[h].comments=[f]:b.detailed_book.book.discussions[h].comments.push(f)});var k=d.parent().siblings(".footer");if(k.show(),d.val(""),d.parent().hide(),g)var l=d.parent().parent().parent().parent().parent().parent().children().last();else var l=d.parent().parent().parent().parent().parent().children(".nested_comments").children().last();var m=$(".discussions .elements")[0];c.scrollToElement(l,0,4e3,m)}})},_add_listeners_to_post_comment_review_page=function(a,b){a.on("keypress",".reviews .comment_box",function(a){if(10==a.which||13==a.which){var d=$(this),e=d.parent().parent().parent().parent(),f=(e.parent().parent().hasClass("elements"),e.parent().parent().parent().parent().scope()),g=f.$index,h={comment:d.val(),timestamp:"Just now",user:{},nested:!0},i=e.scope().discussion.nested;if(i)var j=e.scope().$parent.$index;else var j=e.scope().$index;var k=b.detailed_book.book.reviews[g].comments[j].comments,l=null==k;b.$apply(function(){l?b.detailed_book.book.reviews[g].comments[j].comments=[h]:b.detailed_book.book.reviews[g].comments[j].comments.push(h)});var m=d.parent().siblings(".footer");if(m.show(),d.val(""),d.parent().hide(),i)var n=d.parent().parent().parent().parent().parent().parent().children().last();else var n=d.parent().parent().parent().parent().parent().children(".nested_comments").children().last();var o=$(".reviews .elements")[0];c.scrollToElement(n,0,4e3,o)}})},_add_listeners_to_review_header=function(a){a.on("click",".review .header",function(){var a=$(this),b=a.siblings(),d=$(".reviews .elements")[0];c.scrollToElement(a,0,3e3,d),"block"==b.css("display")?b.css("display","none"):b.show()})},_add_listeners_to_like_buttons=function(a){a.on("click",".like",function(){var a=$(this);if(a.hasClass("like_selected"))a.removeClass("like_selected");else{var b=a.siblings(".dislike");a.addClass("like_selected"),b.removeClass("dislike_selected")}})},_add_listeners_to_dislike_buttons=function(a){a.on("click",".dislike",function(){var a=$(this);if(a.hasClass("dislike_selected"))a.removeClass("dislike_selected");else{var b=a.siblings(".like");a.addClass("dislike_selected"),b.removeClass("like_selected")}})},_add_listeners_to_close_book=function(a,b){a.on("click",".close_book",function(){b.destroy_book()})},_add_listeners_to_write_review=function(a){a.on("click",".write_review",function(){$(".reviews .elements").hide(),$(".reviews .text_editor").show(),$(".close_review").css("display","block"),$(".write_review").hide()})},_add_listeners_to_close_review=function(a){a.on("click",".close_review",function(){$(".reviews .elements").show(),$(".reviews .text_editor").hide(),$(".close_review").hide(),$(".write_review").css("display","block")})},_add_listeners_to_book_tag=function(a){a.on("click",".book_tag",function(){var a=($(this).children(".tag_quotes"),$(".loading_icon")),b=$(this).find(".loading_icon");a.hide(),$(".tag_quotes").hide(),b.css("display","block")})},_bind_text_editor=function(){var a=$(".text_editor").children();a.jqte({focus:function(){scope.$apply(function(){a.parents(".jqte").find(".jqte_toolbar").show(),a.parents(".jqte").click(function(){a.parents(".jqte").find(".jqte_toolbar").show()})})},blur:function(){scope.$apply(function(){a.parents(".jqte").find(".jqte_toolbar").hide()})},change:function(){scope.$apply(function(){ngModel.$setViewValue(a.parents(".jqte").find(".jqte_editor")[0].innerHTML)})}}),a.parents(".jqte").find(".jqte_toolbar").hide()},_bind_popover_click_handler=function(a){a.on("click",".user_tooltip .footer .follow",function(){event.stopPropagation()})},{pre:function(a,b){_add_listeners_to_content_page(b,a),_add_listeners_to_comment_box(b,a),_add_listeners_to_post_comment_discussion_page(b,a),_add_listeners_to_post_comment_review_page(b,a),_add_listeners_to_review_header(b,a),_add_listeners_to_like_buttons(b,a),_add_listeners_to_dislike_buttons(b,a),_add_listeners_to_close_book(b,a),_add_listeners_to_write_review(b,a),_add_listeners_to_close_review(b,a),_add_listeners_to_book_tag(b,a),_set_pre_css(),_bind_text_editor()},post:function(a,b){b.turn({width:width,height:height,display:"single",when:{turning:function(a,b){{var c=$(this);c.turn("page"),c.turn("pages")}_update_depth(c,b),b>=2?$(".detailed_book .p2").hasClass("fixed")||$(".detailed_book .p2").addClass("fixed"):$(".detailed_book .p2").removeClass("fixed"),b<c.turn("pages")?$(".detailed_book .p17").hasClass("fixed")||$(".detailed_book .p17").addClass("fixed"):$(".detailed_book .p17").removeClass("fixed")},turned:function(a,b){{var c=$(this);c.turn("pages")}_update_depth(c)}}}),_set_post_css()}}}],controller:["$scope",function(c){c.is_even=function(a){var b=!1;return a%2==0&&(b=!0),b},c.is_image=function(a){var b=!1;return"img"==a&&(b=!0),b},c.peel=function(){$(".detailed_book").turn("peel","br")},c.remove_peel=function(){$(".detailed_book").turn("peel",!1)},c.zoom_in=function(){},c.destroy_book=function(){a.show_book=!1},c.share_quote=function(){},_click_outside_close=function(){$(".close_book").click(function(b){$(".detailed_book").hide(),$(".book_footer").hide(),$(".fade_cover").hide(),a.show_book=!1,b.stopPropagation()})},_set_css=function(){var b=$(".detailed_book");b.show();{var c=a.book_x,d=a.screen_x;a.total_x}if(c>d){var e=c-d;b.css("margin-left",e+"px")}},_add_listeners=function(){a.$on("turnPage",function(a,b){var c=page_numbers[b];$(".detailed_book").turn("page",c),a.stopPropagation()})},(_init=function(){_set_css(),_add_listeners(),_click_outside_close(),b(function(){var b=$(".detailed_book"),c=a.initPage;b.turn("page",c),$($(".review .content")[0]).css("display","block")},1e3)})()}],templateUrl:"/assets/angular/views/unused/book.html"}}]),websiteApp.directive("discussion",function(){return{restrict:"E",scope:{discussion:"=data",index:"=index"},compile:["tElement","tAttrs","transclude",function(){show_nested_discussion=function(){scope.discussion.id}}],controller:["$scope",function(a){a.is_even=function(a){var b=!1;return a%2==0&&(b=!0),b}}],templateUrl:"/assets/angular/views/unused/discussion.html"}}),websiteApp.directive("angularte",function(){return{restrict:"A",require:"^ngModel",link:["scope","element","attrs","ngModel",function(a,b,c,d){$(function(){b.jqte({focus:function(){a.$apply(function(){b.parents(".jqte").find(".jqte_toolbar").show(),b.parents(".jqte").click(function(){b.parents(".jqte").find(".jqte_toolbar").show()})})},blur:function(){a.$apply(function(){b.parents(".jqte").find(".jqte_toolbar").hide()})},change:function(){a.$apply(function(){d.$setViewValue(b.parents(".jqte").find(".jqte_editor")[0].innerHTML)})}}),b.parents(".jqte").find(".jqte_toolbar").hide()}),d.$render=function(){b.parents(".jqte").find(".jqte_editor")[0]&&(b.parents(".jqte").find(".jqte_editor")[0].innerHTML=d.$viewValue||"")}}]}}),websiteApp.directive("reviews",function(){return{restrict:"E",templateUrl:"/assets/angular/views/unused/reviews.html"}});;function zoomin_book(a,b,c,d){c.initPage=d,a.zoomin_book=!0;var e=event.currentTarget.offsetParent.offsetLeft+event.currentTarget.offsetWidth,f=event.screenX,g=event.currentTarget.offsetParent.offsetParent.scrollWidth;a.$emit("expandBook",a.book.id,e,f,g);var h=b(function(){a.zoomin_book=!1},3e3);a.$on("destroy",function(){b.cancel(h)})}function add_custom_bookmark(a,b,c){var d=a.book.custom_bookmark;if(d){d=d.trim().toUpperCase();for(var e=a.book.labels,f=!1,g=0;g<e.length;g++){var h=e[g];if(h.name==d){f=!0;var i="ALERT- Tag with the name '"+d+"' is already added in the list";break}}if(!f){a.book.bookmark_status=1,b.labels=b.labels.concat([{name:d}]),a.book.labels=a.book.labels.concat([{name:d,checked:!0}]),b.user.bookmark_count=b.user.bookmark_count+1,a.$emit("gamifyCount",10,!0);var i="SUCCESS-Custom Bookmark "+d+" added to book "+a.book.title}var j=notify(b,i,c);return a.$on("destroy",function(){c.cancel(j)}),f}}websiteApp.directive("book",["websiteService","$rootScope","widgetService",function(a,b){return{restrict:"E",scope:{book:"=data"},controller:["$scope",function(c){c.show_interaction_box=function(){b.user.interact=!0},c.stop_propagation=function(a){a.stopPropagation()},c.show_focused_tooltip=function(a){if(b.focused_book!=c.book){delete b.ticker_popup,b.popups={},b.focused_book=c.book;var d=a.currentTarget.offsetParent.offsetParent.offsetLeft-a.pageX+a.clientX,e=window_width-(d+a.currentTarget.offsetParent.scrollWidth),f=d,g=.8*window_height;e>f?(e>g?(d=d+a.currentTarget.offsetParent.scrollWidth-a.currentTarget.offsetLeft,b.focused_book.reposition_tooltip={left:d+"px"}):b.focused_book.reposition_tooltip={right:"0px"},b.on_left=!0):(f>g?(d=window_width-d,b.focused_book.reposition_tooltip={right:d+"px"}):b.focused_book.reposition_tooltip={left:"0px"},b.on_left=!1),b.popups.left_panel_width={"background-color":"#333"},b.style={},b.style.main_header={"background-color":"#333",color:"white"},b.style.header_icon={color:"white"},b.style.site_logo={color:"white"}}else delete b.focused_book,b.popups.left_panel_width={},b.style={};a.stopPropagation()},(_init=function(){var b=c.book.id;c.book.show_labels=!1,angular.isUndefined(c.book.title)&&a.get_book_details("id="+b).then(function(a){angular.extend(c.book,a),angular.forEach(c.book.labels,function(a){a.checked&&(c.book.bookmark_status=1)}),c.book.data_fetched=!0})})()}],templateUrl:"/assets/angular/views/book_widget/show.html"}}]),websiteApp.directive("labelPopup",["$rootScope","$timeout","widgetService","RecommendationUIConstants","sharedService",function(a,b,c,d,e){return{restrict:"E",controller:["$scope",function(a){a.stop_propagation=function(a){a.stopPropagation()},a.select_label=function(b){e.bookmark_book(a,b,event)},a.stop_horizontal_scroll=function(a){a.stopPropagation()}}],templateUrl:"/assets/angular/views/book_widget/partials/label_popup.html"}}]),websiteApp.directive("bookNavbar",["$rootScope","$timeout",function(a,b){return{restrict:"E",controller:["$scope",function(c){c.show_book=function(d){zoomin_book(c,b,a,d)}}],templateUrl:"/assets/angular/views/unused/book_navbar.html"}}]),websiteApp.directive("listDropdown",function(){return{restrict:"E",controller:function(){},templateUrl:"app/assets/javascripts/angular/widgets/base/book/list_dropdown.html"}}),websiteApp.directive("bookBookmark",["$rootScope","$timeout","widgetService",function(a,b,c){return{restrict:"E",controller:["$scope",function(d){d.toggle_bookmarked=function(e){for(var f=d.book.labels.length,g=a.labels.length,h=f;g>h;h++)d.book.labels.push({name:a.labels[h].name});if(d.book.show_labels){{d.book.bookmark_status,d.book.title,d.book.author_name}if(d.book.custom_bookmark){var i=add_custom_bookmark(d,a,b);if(!i){var j={id:d.book.id,type:"BOOK",name:d.book.custom_bookmark,data:!0};c.bookmark(j)}}else d.book.show_labels=!1}else d.book.show_labels=!0;e.stopPropagation()}}],templateUrl:"/assets/angular/views/book_widget/partials/bookmark.html"}}]),websiteApp.directive("bookInteract",["$rootScope","$timeout","widgetService","WebsiteUIConstants",function(a,b,c,d){return{restrict:"E",scope:{book:"=data"},controller:["$scope",function(e){_init=function(){e.setStatus(),e.label_placeholder="Add to my library"},e.show_bookmark_options=function(b){if(e.book.show_labels)e.book.blur_input=!0,e.book.show_labels=!1;else{for(var c=e.book.labels.length,d=a.labels.length,f=c;d>f;f++)e.book.labels.push({name:a.labels[f].name});e.book.blur_input=!1,e.book.show_labels=!0,e.label_placeholder="Add a new shelf..."}b.stopPropagation()},e.handle_enter=function(f){var g=f.keyCode==d.Enter;if(g){var h=add_custom_bookmark(e,a,b);if(!h){var i={id:e.book.id,type:"BOOK",name:e.book.custom_bookmark,data:!0};c.bookmark(i),e.book.custom_bookmark=""}}},e.stop_propagation=function(a){a.stopPropagation()},e.setStatus=function(a){e.read=1==a?!0:!1},_init()}],templateUrl:"/assets/angular/views/book_widget/footer.html"}}]),websiteApp.directive("bookInfo",["$rootScope","$timeout","widgetService","sharedService","WebsiteUIConstants","$cookieStore",function(a,b,c,d,e,f){return{restrict:"E",controller:["$scope",function(g){g.stop_keyboard_navigation=function(a){var b=a.keyCode==e.KeyLeft,c=a.keyCode==e.KeyUp,d=a.keyCode==e.KeyRight,f=a.keyCode==e.KeyDown;(b||d||c||f)&&a.stopPropagation()},g.handle_enter=function(b,d){var f=b.keyCode==e.Enter;if(f){a.focused_book.add_thumb=!1;var g=a.focused_book.id,h={thumb_url:d,book_id:g};c.add_thumbnail(h)}},g.show_feedback_popup=function(){a.focused_book.show_feedback_popup=a.focused_book.show_feedback_popup?!1:!0},g.get_author_details=function(){g.show_author=!0,g.show_buy=!1,f.put("show_author",!0),f.put("show_buy",!1),angular.isUndefined(a.focused_book.author_details)&&c.get_author_details(a.focused_book.id).then(function(b){angular.isDefined(a.focused_book)&&(a.focused_book.author_details={about:b[0],image_url:b[1],signature_pic:b[2],id:b[3],book_ids:b[4],book_isbns:b[5]})})},g.get_book_from_author=function(){var b={name:a.focused_book.author_name,id:a.focused_book.author_details.id};a.$broadcast("updateFilters","AUTHOR",b)},g.get_buy_links=function(){g.show_author=!1,g.show_buy=!0,f.put("show_author",!1),f.put("show_buy",!0),angular.isUndefined(a.focused_book.bnn_links)&&c.get_affiliate_links(a.focused_book.id).then(function(b){a.focused_book.bnn_links=b.bnn.links})},g.get_book_overview=function(){g.show_buy=!1,g.show_author=!1,f.put("show_author",!1),f.put("show_buy",!1)},g.stop_propagation=function(a){a.stopPropagation()},g.close_focused_tooltip=function(){delete a.focused_book,a.popups.left_panel_width={},a.style={}},g.own_this_book=function(){if(g.have_this_book){g.have_this_book=!1;var d="SUCCESS-Are you sure, you don't have a copy of "+a.focused_book.title+"? <br/>Your friends might be looking for this book."}else{g.have_this_book=!0;var d="SUCCESS-Thanks, Your friends will now know that you own a copy of "+a.focused_book.title}var e=a.focused_book.id,f=notify(a,d,b);c.own_this_book(e,g.have_this_book),g.$on("destroy",function(){b.cancel(f)})},g.record_read_time=function(e,f){var h=angular.isUndefined(a.focused_book.time_index)||null==a.focused_book.time_index;h&&g.$emit("gamifyCount",10,!0),a.focused_book.time_index=e;{var i="SUCCESS-Recorded approximate time to read <br/>.";notify(a,i,b)}switch(a.focused_book.status||d.mark_as_read(a,a.focused_book,f),a.focused_book.time_index){case 0:var j="Tiny Read";break;case 1:var j="Small Read";break;case 2:var j="Normal Read";break;case 3:var j="Long Read"}var k=a.user.email;angular.isDefined(a.user.name)&&(k=a.user.name);var i="<span>described reading length of <span class='site_color'>"+a.focused_book.title+"</span><span>&nbsp; as a&nbsp;'"+j+"'</span>",l={thumb:a.user.thumb,message:i,timestamp:(new Date).getTime(),book:{id:a.focused_book.id,title:a.focused_book.title,author_name:a.focused_book.author_name,isbn:a.focused_book.isbn},user:{id:a.user.id,name:k}};g.$emit("addToNotifications",l),c.record_time(a.focused_book.id,e),g.$on("destroy",function(){b.cancel("timeout_event")})},g.is_timer=function(b){var c=!1;return a.focused_book.time_index==b&&(c=!0),c},g.close_interaction_box=function(){a.focused_book.interact=!1,g.hash_tags=[]},g.stop_horizontal_scroll=function(a){a.stopPropagation()},_display_tweet=function(){a.focused_book.display_profile=a.user.thumb,a.focused_book.display_tweet="Comment on this book..."},_open_tab=function(){g.show_author=angular.isDefined(f.get("show_author"))?f.get("show_author"):!1,g.show_buy=angular.isDefined(f.get("show_buy"))?f.get("show_buy"):!1},g._get_book_feed=function(){angular.isUndefined(a.focused_book.tweets)&&(a.focused_book.tweets=[],c.get_book_feed(a.focused_book.id).then(function(b){null!=a.focused_book&&(a.focused_book.tweets=b,_display_tweet())}))},(_init=function(){_open_tab(),angular.isDefined(a.focused_book)&&(g._get_book_feed(),g.show_author?g.get_author_details():g.show_buy?g.get_buy_links():g.get_book_overview())})()}],templateUrl:"/assets/angular/views/home/shared/book_info.html"}}]),websiteApp.directive("bookTags",["$rootScope","$timeout",function(a,b){return{restrict:"E",controller:["$scope",function(c){c.show_book=function(d){zoomin_book(c,b,a,d)}}],templateUrl:"/assets/angular/views/unused/book_tags.html"}}]),websiteApp.directive("recommend",["$rootScope","$timeout","widgetService","websiteService",function(a,b,c,d){return{restrict:"E",scope:{recommend_object:"=data"},controller:["$scope",function(e){e.select_thumb=function(a,b){var c="true"==a.currentTarget.dataset.selected;c?(e.user.selected_followers.splice(e.user.selected_followers.indexOf(b),1),a.currentTarget.dataset.selected=!1,a.currentTarget.style.border="5px solid transparent"):(e.user.selected_followers.push(b),a.currentTarget.dataset.selected=!0,a.currentTarget.style.border="5px solid #FEBF00")},e.stop_propagation=function(a){a.stopPropagation()},e.recommend=function(){e.recommend_object.title,e.recommend_object.author_name;if(e.recommend_object.recommended){e.recommend_object.recommended=!1;var d="SUCCESS-Recommended to selected friends.",f=notify(a,d,b);e.$on("destroy",function(){b.cancel(f)});var g={friend_ids:e.user.selected_followers,book_id:e.recommend_object.id};c.recommend(g),e.$emit("gamifyCount",10,!0)}else e.recommend_object.recommended=!0},e._init=function(){angular.isUndefined(a.user.followers)?(a.user.selected_followers=[],d.get_followed_by().then(function(b){a.user.followers=[],angular.forEach(b,function(a){var b={name:a[1],id:a[0],thumb:a[2]};this.push(b)},a.user.followers),e.user={},e.user.followers=a.user.followers,e.user.selected_followers=a.user.selected_followers})):(e.user={},e.user.followers=a.user.followers,e.user.selected_followers=a.user.selected_followers)},e._init()}],templateUrl:"/assets/angular/views/home/shared/recommend.html"}}]),websiteApp.directive("markAsRead",["$rootScope","$timeout","widgetService","sharedService","stropheService",function(a,b,c,d,e){return{restrict:"E",controller:["$scope",function(b){b.mark_as_read=function(c){var f=a.user.name,g=f+"added "+b.book.title+" to Books Read.";d.mark_as_read(b,b.book,c),e.send_notification(g)}}],templateUrl:"/assets/angular/views/unused/mark_as_read.html"}}]);var global_display_timer=0;;websiteApp.directive("author",["$rootScope","widgetService",function(a){return{restrict:"E",scope:{author:"=data"},controller:["$scope",function(b){b.hover=function(){b.hovered=!0},b.mouseout=function(){b.hovered=!1},b.show_focused_tooltip=function(c){if(a.focused_author!=b.author){a.focused_author=b.author;var d=c.currentTarget.offsetParent.offsetParent.offsetLeft-c.pageX+c.clientX,e=window_width-(d+c.currentTarget.offsetParent.scrollWidth),f=d;e>f?e>400?(d=d+c.currentTarget.offsetParent.scrollWidth-c.currentTarget.offsetLeft,a.focused_author.reposition_tooltip={left:d+"px",top:"60px"}):a.focused_author.reposition_tooltip={right:"0px",top:"60px"}:f>400?(d=window_width-d,a.focused_author.reposition_tooltip={right:d+"px",top:"60px"}):a.focused_author.reposition_tooltip={left:"0px",top:"60px"}}else delete a.focused_author;c.stopPropagation()},(_init=function(){b.active_author_filter=!0})()}],templateUrl:"/assets/angular/views/unused/author/author_widget.html"}}]),websiteApp.directive("focusedAuthor",["$rootScope","$timeout","widgetService",function(a){return{restrict:"E",controller:["$scope",function(b){b.stop_propagation=function(a){a.stopPropagation()},b.close_focused_tooltip=function(){delete a.focused_author},b.close_interaction_box=function(){b.focused_author.interact=!1,b.hash_tags=[]},b.stop_horizontal_scroll=function(a){a.stopPropagation()}}],templateUrl:"/assets/angular/views/unused/author/focused_author.html"}}]),websiteApp.directive("authorBookmark",["$rootScope","$timeout","widgetService",function(a,b,c){return{restrict:"E",controller:["$scope",function(d){d.toggle_bookmarked=function(e){var f=d.author.bookmark_status,g=d.author.name;if(1==f){d.author.bookmark_status=0;var h="SUCCESS-Author "+g+" has been removed from your bookmark shelf."}else{d.author.bookmark_status=1;var h="SUCCESS-AUTHOR "+g+" has been added to your bookmark shelf.";a.$broadcast("glowBookmark")}var i=notify(a,h,b);d.$on("destroy",function(){b.cancel(i)}),c.bookmark("AUTHOR",d.author.id,d.author.bookmark_status),e.stopPropagation()}}],templateUrl:"/assets/angular/views/unused/author/bookmark.html"}}]),websiteApp.directive("authorInteract",["websiteService","WebsiteUIConstants",function(a,b){return{restrict:"E",controller:["$scope",function(c){_init=function(){c.setStatus()},c.setStatus=function(a){c.read=1==a?!0:!1},c.handle_selection=function(){},c.set_current=function(){},c.handle_backspace=function(a){var d=$(a.currentTarget).val().split(" "),e=$(a.currentTarget).siblings().html().split(" "),f=(String.fromCharCode(a.keyCode),d.length);if(1==f)var g=d.slice(0,f-1).join(" "),h=e.slice(0,f-1).join(" ");else var g=d.slice(0,f-1).join(" ")+" ",h=e.slice(0,f-1).join(" ")+" ";var i=d.pop(),j=e.pop(),k=a.keyCode==b.Backspace,l=c.hash_tagging;if(k){if("#"==i)c.hash_tagging=!1,c.hash_tags=[],$(a.currentTarget).siblings().html(h);else if(l)$(a.currentTarget).siblings().html(h),$(a.currentTarget).val(g),c.hash_tagging=!1,c.hash_tags=[],a.preventDefault();else{var m=">"==j[j.length-1];if(m)$(a.currentTarget).siblings().html(h),$(a.currentTarget).val(g),c.hash_tags=[],a.preventDefault();else{var n=$(a.currentTarget).siblings().html();$(a.currentTarget).siblings().html(n.substring(0,n.length-1))}}$(a.currentTarget).val()&&""!=$(a.currentTarget).val()||$(a.currentTarget).siblings().html("")}a.stopPropagation()},c.handle_hash_tags=function(b){{var d=$(b.currentTarget).val().split(" "),e=String.fromCharCode(b.keyCode),f=d.length,g=(d.slice(0,f-1).join(" "),d.pop()),h=""==g;c.hash_tagging}if(h&&"#"==e){var i="<b>"+e+"</b>";c.hash_tagging=!0,$(b.currentTarget).siblings().append(i)}else if(h&&"+"==e){var i="<b>"+e+"</b>";c.hash_tagging=!0,$(b.currentTarget).siblings().append(i),c.search_for="TAGS"}else if(h&&"@"==e){var i="<b>"+e+"</b>";c.hash_tagging=!0,$(b.currentTarget).siblings().append(i),c.search_for="[AUTHORS, authorS]"}else" "==e?(c.hash_tagging=!1,$(b.currentTarget).siblings().append(e),delete c.search_for):c.hash_tagging?$(b.currentTarget).siblings().find("b:last").append(e):$(b.currentTarget).siblings().append(e);c.search_for&&(string_to_be_searched=g.slice(1,g.length)+""+e,a.search(string_to_be_searched.trim(),c.search_for,3).then(function(a){c.hash_tags=a.results})),b.stopPropagation()}}],templateUrl:"/assets/angular/views/unused/author/author_interact.html"}}]);;websiteApp.directive("reader",["$rootScope","widgetService",function(a){return{restrict:"E",scope:{reader:"=data"},controller:["$scope",function(b){b.hover=function(){b.hovered=!0},b.mouseout=function(){b.hovered=!1},b.show_focused_tooltip=function(c){if(a.focused_reader!=b.reader){a.focused_reader=b.reader;var d=c.currentTarget.offsetParent.offsetParent.offsetLeft-c.pageX+c.clientX,e=window_width-(d+c.currentTarget.offsetParent.scrollWidth),f=d;e>f?e>400?(d=d+c.currentTarget.offsetParent.scrollWidth-c.currentTarget.offsetLeft,a.focused_reader.reposition_tooltip={left:d+"px",top:"60px"}):a.focused_reader.reposition_tooltip={right:"0px",top:"60px"}:f>400?(d=window_width-d,a.focused_reader.reposition_tooltip={right:d+"px",top:"60px"}):a.focused_reader.reposition_tooltip={left:"0px",top:"60px"}}else a.focused_reader=null;c.stopPropagation()},(_init=function(){b.active_reader_filter=!0})()}],templateUrl:"/assets/angular/views/unused/reader/reader_widget.html"}}]),websiteApp.directive("focusedReader",["$rootScope","$timeout","widgetService",function(a){return{restrict:"E",controller:["$scope",function(b){b.stop_propagation=function(a){a.stopPropagation()},b.close_focused_tooltip=function(){a.focused_reader=null},b.close_interaction_box=function(){b.focused_reader.interact=!1,b.hash_tags=[]},b.stop_horizontal_scroll=function(a){a.stopPropagation()}}],templateUrl:"/assets/angular/views/unused/reader/focused_reader.html"}}]),websiteApp.directive("messageBox",function(){return{restrict:"E",controller:["$scope",function(a){a.close_message_box=function(){a.reader.show_message_box=!1}}],templateUrl:"/assets/angular/views/unused/reader/message_box.html"}}),websiteApp.directive("readerInteract",["websiteService",function(){return{restrict:"E",controller:["$scope",function(a){a.toggle_message_box=function(){a.reader.show_message_box=a.reader.show_message_box?!1:!0}}],templateUrl:"/assets/angular/views/unused/reader/reader_interact.html"}}]);;websiteApp.directive("category",function(){return{restrict:"E",scope:{widget:"@"},controller:["$scope",function(a){a.initVerticalText=function(){var b="book"==a.widget,c="reader"==a.widget,d="author"==a.widget;if(b)var e=a.$parent.book;else if(c)var e=a.$parent.reader;else if(d)var e=a.$parent.author;if(e){var f=e.category.name;f&&(a.nameArray=f.split("")),a.rating=e.rating}}}],templateUrl:"/assets/angular/widgets/views/unused/category.html"}}),websiteApp.directive("messageApp",["websiteService",function(){return{restrict:"E",controller:["$scope",function(a){a.send_message=function(){}}],templateUrl:"/assets/angular/views/unused/message_app.html"}}]),websiteApp.directive("follow",["$rootScope","$timeout","widgetService",function(a,b,c){return{restrict:"E",controller:["$scope",function(d){d.toggle_follow=function(){if(d.reader){var e=d.reader.name;if(d.reader.follow){d.reader.follow=!1;var f=a.user.readers.follow.indexOf(data);a.user.readers.follow.splice(f,1);var g="SUCCESS-Reader "+e+" has been removed from your follow list."}else{d.reader.follow=!0,a.user.readers.follow.push(d.reader);var g="SUCCESS-You are now following "+e+"."}var h=notify(a,g,b);c.follow(d.reader.id,"READER",d.reader.follow)}else if(d.author){var i=d.author.name;if(d.author.follow){d.author.follow=!1;var f=a.user.authors.follow.indexOf(data);a.user.authors.follow.splice(f,1),c.follow(d.author.id,"AUTHOR",d.author.follow);var g="SUCCESS-Author "+i+" has been removed from your follow list."}else{d.author.follow=!0,a.user.authors.follow.push(d.author);var g="SUCCESS-You are now following Author "+i+"."}var h=notify(a,g,b);c.follow(d.author.id,"AUTHOR",d.author.follow)}h&&d.$on("destroy",function(){b.cancel(h)})}}],templateUrl:"/assets/angular/views/unused/follow.html"}}]),websiteApp.directive("widgetThumb",["$timeout","$rootScope","$filter","ColorConstants",function(a,b,c,d){return{restrict:"E",controller:["$scope",function(b){b.show_images=function(){if(angular.isDefined(b.book)){var c=b.book;if(angular.isDefined(c.isbn)){var d=_get_thumb(c);angular.isDefined(d)&&(b.thumb_style={background:"url('"+d+"')"})}}else if(angular.isDefined(b.author))var c=b.author;else if(angular.isDefined(b.reader))var c=b.reader;b.$on("destroy",function(){a.cancel(timeout_event)})},_get_obj=function(){if(b.book)var a=b.book;else if(b.author)var a=b.author;else if(b.reader)var a=b.reader;return a},_get_thumb=function(a){var b=angular.isDefined(a.external_thumb)&&null!=a.external_thumb;if(b)var d=a.external_thumb;else var d=c("thumb")(a.isbn);return d},(_init=function(){var a=_get_obj();if(a&&a.isbn){var c=_get_thumb(a);angular.isDefined(c)&&(b.thumb_style={background:"url('"+c+"')"})}var e=d.value[Math.floor(Math.random()*d.value.length)];b.random_background={"background-color":e},b.show_images()})()}],templateUrl:"/assets/angular/views/book_widget/thumb.html"}}]);