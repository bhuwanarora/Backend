websiteApp.directive("moreFilters",["$rootScope","$timeout",function(a,b){return{restrict:"E",controller:["$scope","recommendationService","websiteService",function(c,d,e){_init=function(){c.show_menu=!1,c.countryOptions=[],c.$on("filterChange",function(a,b,d){"country"==d?c.countrySelected=b:"timeGroup"==d?c.timeSelected=b:"readingTime"==d&&(c.readTimeSelected=b),c.advance_filter_changed(b,d)}),d.get_countries().then(function(a){c.countryOptions=_reset_json(),c.countryOptions=c.countryOptions.concat(a.countries)}),d.get_time_groups().then(function(a){c.timeOptions=_reset_json(),angular.forEach(a.times,function(a){var b=a[0].data,c=b.name+" ("+b.range+")",d={name:c};this.push(d)},c.timeOptions)}),d.get_read_times().then(function(a){c.readTimeOptions=_reset_json(),angular.forEach(a.read_times,function(a){var b=a[0].data,c=b.name,d={name:c,custom_option:!0,type:"readingTime"};this.push(d)},c.readTimeOptions)}),_init_dropdown_filters(),_collapse_dropdown_menu()},_reset_json=function(){return[{name:"<span class='icon-loop'></span><span>&nbsp;Reset</span>"}]},_collapse_dropdown_menu=function(){c.filter_expanded=!0;b(function(){c.filter_expanded=!1},3e3)},_country_init=function(){return{name:"<span class='icon-earth filter_icon green'></span><span>&nbsp;&nbsp;&nbsp;Filter by Region</span>"}},_time_init=function(){return{name:"<span class='icon-calendar filter_icon magenta'></span><span>&nbsp;&nbsp;&nbsp;Filter by Era</span>"}},_read_time_init=function(){return{name:"<span class='icon-clock filter_icon cyan'></span><span>&nbsp;&nbsp;&nbsp;Filter by Reading Time</span>"}},_init_dropdown_filters=function(){c.countrySelected=_country_init(),c.timeSelected=_time_init(),c.readTimeSelected=_read_time_init()},c.handle_left_columns=function(){c.column_heights={show_filters:!0,notifications_style:{"max-height":"110px"},friends_grid_style:{height:"75px"}}},c.clear_filter=function(d,e){a.filters.other_filters[e]=null;var f="SUCCESS-"+e+" filter removed",g=notify(a,f,b);c.$on("destroy",function(){b.cancel(g)}),c.$emit("reloadRecommendations")},c.advance_filter_changed=function(d,e){if("<span class='icon-loop'></span><span>&nbsp;Reset</span>"==d.name){var f="SUCCESS-"+e+" filter has been reset.";delete a.filters.other_filters[e],"country"==e?c.countrySelected=_country_init():"timeGroup"==e?c.timeSelected=_time_init():"readingTime"==e&&(c.readTimeSelected=_read_time_init())}else{var f="SUCCESS-"+d.name+" added to filters.";a.filters.other_filters[e]=d.name}var g=notify(a,f,b);c.$on("destroy",function(){b.cancel(g)}),c.$emit("reloadRecommendations")},c.reset_filters=function(){_init_dropdown_filters(),c.$broadcast("resetFilter"),a.filters.more_filters=[],a.filters.other_filters={},c.$emit("reloadRecommendations");var d="SUCCESS-All filters removed.<br/> You can add filters to look for particular books.",e=notify(a,d,b);c.$on("destroy",function(){b.cancel(e)})},c.stop_click_propagation=function(a){a.stopPropagation()},_reload_page=function(){},c.show_genre_options=function(a,b){if(b)var e=b+String.fromCharCode(event.keyCode);else var e=String.fromCharCode(event.keyCode);var a="q="+e+"&filter="+a;d.get_genres(a).then(function(a){c.genres=[],angular.forEach(a.genres.data,function(a){this.push(a[0].data)},c.genres)})},c.on_genre_selection=function(d){c.genre=d,a.filters.other_filters.genre=d;var e="SUCCESS-'"+d+"' added to filters.",f=notify(a,e,b);c.$emit("reloadRecommendations"),c.$on("destroy",function(){b.cancel(f)})},c.show_author_options=function(a,b){if(b)var d=b+String.fromCharCode(event.keyCode);else var d=String.fromCharCode(event.keyCode);e.search(d,"AUTHOR",3).then(function(a){c.authors=[],angular.forEach(a.results.data,function(a){var b={name:a[0]};this.push(b)},c.authors)})},c.on_author_selection=function(d){c.author=d,a.filters.other_filters.author=d;var e="SUCCESS-'"+d+"' added to filters.",f=notify(a,e,b);c.$emit("reloadRecommendations"),c.$on("destroy",function(){b.cancel(f)})},c.toggle_menu=function(){c.show_menu?(c.show_menu=!1,c.filter_expanded=!1):(c.show_menu=!0,c.filter_expanded=!0)},_init()}],templateUrl:"/assets/angular/widgets/partials/more_filters.html"}}]),websiteApp.directive("notificationLink",function(){return{restrict:"E",templateUrl:"/assets/angular/widgets/partials/notification_link.html"}}),websiteApp.directive("tickerPopup",function(){return{restrict:"E",templateUrl:"/assets/angular/widgets/partials/ticker_popup.html"}}),websiteApp.directive("filter",["$rootScope","$timeout","$routeParams",function(a,b,c){return{restrict:"E",scope:{filter:"=data"},controller:["$scope",function(d){_initialise_filters=function(c){if(d.filter){var e=d.filter.id,f=d.filter.name;if(e==parseInt(d.$routeParams.filter_id)){if(d.active=!0,-1==a.filters[c].indexOf(e)){a.filters[c].push(e);var g="SUCCESS-'"+f+"' added to filters.",h=notify(a,g,b);d.$on("destroy",function(){b.cancel(h)})}}else d.active=!1}},_add_listeners=function(){d.$on("resetFilter",function(){d.active&&(d.active=!1)})},(_init=function(){d.$routeParams=c,_initialise_filters("more_filters"),_add_listeners()})()}],templateUrl:"/assets/angular/widgets/partials/filter.html"}}]),websiteApp.directive("mainHeader",[function(){return{restrict:"E",templateUrl:"/assets/angular/widgets/partials/main_header.html"}}]),websiteApp.directive("recommendationFooter",["scroller","$rootScope","websiteService","$timeout",function(a,b,c,d){return{restrict:"E",controller:["$scope",function(e){e.toggle_bookmarked=function(a){e.bookmark_selected||(e.panel_selected="BOOKMARK",e.bookmark_selected=!0,e.read_selected=!1,c.get_books_bookmarked().then(function(a){angular.isArray(a)&&(b.user.books.bookmarked=[],angular.forEach(a,function(a){var c=[];angular.forEach(b.labels,function(b){if(a[2].indexOf(b.name)>=0)var d={name:b.name,checked:!0};else var d={name:b.name,checked:!1};c.push(d)},c);var d={isbn:a[0],id:a[1],bookmark_status:!0,labels:c};this.push(d)},b.user.books.bookmarked))})),a.stopPropagation()},e.toggle_recommendations=function(){(e.bookmark_selected||e.read_selected)&&(e.read_selected=!1,e.bookmark_selected=!1,e.panel_selected="",e.reset())},e.toggle_read=function(){e.read_selected||(e.glowShelf=!1,e.bookmark_selected=!1,e.read_selected=!0,e.panel_selected="READ",c.get_books_read(0).then(function(a){b.user.books.read=[],angular.forEach(a,function(a){var b={isbn:a[0],id:a[1],status:!0};this.push(b)},b.user.books.read)}))},e.reset_filter=function(a,b,c,d){var f="timeGroup"==c||"readingTime"==c||"country"==c;if(b){if(f){var g={name:"<span class='icon-loop'></span><span>&nbsp;Reset</span>"};e.advance_filter_changed(g,c)}else e.clear_filter(d,c),e.genre="";a.stopPropagation()}else f||(e.handle_left_columns(),_handle_filter_selection(c))},_handle_filter_selection=function(a){if("genre"==a){e.show_lists=!1,e.genre_selected=!0;var b=d(function(){e.genre_selected=!1},1e3);e.$on("destroy",function(){d.cancel(b)})}if("author"==a){e.show_lists=!1,e.author_selected=!0;var b=d(function(){e.author_selected=!1},500);e.$on("destroy",function(){d.cancel(b)})}},e.handle_notification_ticker_size=function(a,c){var d=angular.isDefined(a);if(d)var f=a.deltaY>0;else var f=c;e.column_heights=f?{notifications_style:{"max-height":"225px"},friends_grid_style:{height:"75px"},show_filters:!1}:{notifications_style:{"max-height":"110px"},friends_grid_style:{height:"75px"},show_filters:!1},b.ticker_popup=null,d&&a.stopPropagation()},e.goto_info_card=function(){a.scrollTo(0,0,2e3)},e.toggle_footer=function(){e.compact_footer=!0},_init_shelf=function(){e.read_selected=!1,(angular.isUndefined(e.bookmark_selected)||!e.bookmark_selected)&&(e.bookmark_selected=!1)},_add_listeners=function(){open_shelf_event=e.$on("showBookReadShelf",function(){e.read_selected=!0,event.stopPropagation()})},_init_left_column=function(){e.show_lists=!1,e.column_heights={notifications_style:{"max-height":"110px"},friends_grid_style:{height:"75px"},show_filters:!0}},(_init=function(){_init_left_column(),_init_shelf(),e.compact_footer=window.innerWidth<1e3?!0:!1,e.genre_selected=!1,e.author_selected=!1,e.column_heights={show_filters:!1}})()}],templateUrl:"/assets/angular/widgets/partials/recommendation_footer.html"}}]),websiteApp.directive("calendar",function(){return{restrict:"E",scope:{},controller:["$scope",function(a){a.date_check=function(){var b=a.months.indexOf(a.selectedMonth)+1,c=new Date(a.selectedYear,b,0).getDate();a.days=new Array(c).join().split(",").map(function(a,b){return++b})},(_init=function(){a.days=new Array(31).join().split(",").map(function(a,b){return++b}),a.months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],a.years=[];for(var b=(new Date).getFullYear(),c=b;c>1904;c--)a.years.push(c)})()}],templateUrl:"/assets/angular/widgets/partials/calendar.html"}});;websiteApp.directive("siteLogo",[function(){return{restrict:"E",templateUrl:"/assets/angular/widgets/partials/site_logo.html"}}]),websiteApp.directive("userThumb",[function(){return{restrict:"E",templateUrl:"/assets/angular/widgets/partials/user_thumb.html"}}]),websiteApp.directive("infoCard",["$rootScope","$timeout","sharedService",function(a,b,c){return{restrict:"E",controller:["$scope","websiteService",function(d,e){d.mark_as_read=function(a,b){c.mark_as_read(d,a,b)},d.search_books=function(a){var b=38==a.keyCode,c=40==a.keyCode,f=8==a.keyCode,g=13==a.keyCode,h=!(b||c||f||g);if(h){if(d.search_book)var i=d.popular_books.length,j=d.search_book+String.fromCharCode(a.keyCode);else{var i=0;d.popular_books=[];var j=String.fromCharCode(a.keyCode)}d.loading||(d.loading=!0,e.search_books(j,i).then(function(a){a=a.results,0!=a.length&&angular.forEach(a,function(a){var b={isbn:a[0],id:a[1],title:a[2],author_name:a[3],status:!1};this.push(b)},d.popular_books),d.loading=!1}))}},_get_genres=function(){(angular.isUndefined(d.genres)||0==d.genres.length)&&e.get_genres().then(function(a){d.genres=a.genres})},_profile_status_colors=function(){var b=a.user.profile_status;0==b?a.user.profile_status_color="#4374e0":1==b?a.user.profile_status_color="#65b045":2==b?a.user.profile_status_color="#d73d32":3==b?a.user.profile_status_color="#11a9cc":4==b?a.user.profile_status_color="#981b48":5==b?a.user.profile_status_color="#7e3794":6==b?a.user.profile_status_color="#4374e0":7==b?a.user.profile_status_color="#981b48":8==b&&(a.user.profile_status_color="#981b48")},_handle_info_card_bindings=function(b){3==a.user.profile_status?b.get_popular_books():2==a.user.profile_status?_get_genres():4==a.user.profile_status||6==a.user.profile_status&&(navigator.geolocation?navigator.geolocation.getCurrentPosition(function(b){var c=b.coords.latitude,d=b.coords.longitude;a.user.latitude=c,a.user.longitude=d}):x.innerHTML="Geolocation is not supported by this browser.")},_get_info_data=function(){e.get_info_data().then(function(a){d.book_counts=a.reading_count_list,d.user_book_count=d.book_counts[0]})},d.edit_books_read=function(){d.goto_info_card(),a.user.profile_status=3,d.get_popular_books(),d.compressed_info=!1},d.get_popular_books=function(){var a=d.popular_books.length;d.loading||(d.loading=!0,e.get_popular_books(a).then(function(a){angular.forEach(a,function(a){var b={isbn:a[0],id:a[1],title:a[2],author_name:a[3],status:!1};this.push(b)},d.popular_books),d.loading=!1}))},d.prev_profile_state=function(){a.user.profile_status=0!=a.user.profile_status?a.user.profile_status-1:8,_handle_info_card_bindings(d),_profile_status_colors(),_update_user_info()},d.next_profile_state=function(){a.user.profile_status=8!=a.user.profile_status?a.user.profile_status+1:0,_handle_info_card_bindings(d),_profile_status_colors(),_update_user_info()},d.stop_horizontal_scroll=function(a){a.stopPropagation()},d.update_profile=function(){var b=13==event.keyCode;if(b){var c=a.user.profile_status;0==c&&(e.update_profile(a.user),a.user.profile_status=a.user.profile_status+1,_profile_status_colors())}},d.user_profile_changed=function(a){if("Reader"==a.name||"Author"==a.name){d.show_loading_bar=!0;{b(function(){d.show_loading_bar=!1,d.ask_book_count=!0},1e3)}}},d.add_book=function(){},d.add_author=function(){},d.get_search_results=function(a,b,c){c?c+=String.fromCharCode(a.keyCode):c=String.fromCharCode(a.keyCode),e.search(c,b,3).then(function(a){d.search_results=d.search_results.concat(a.results)})},d.set_user_name=function(){},_update_user_info=function(){},(_init=function(){a.user.profile_status=0,_profile_status_colors(),_get_info_data(),d.popular_books=[],d.loading=!1,d.profileOptions=[{name:"Reader"},{name:"Author"},{name:"Publisher"},{name:"Editor"}],d.compressed_info=!1,d.gender="Male",d.profileSelected={name:"Reader"},d.info_card_width=350,d.info_card_ratio=1.34})()}],templateUrl:"/assets/angular/widgets/base/widget/info_card.html"}}]),websiteApp.directive("toggle",function(){return{restrict:"E",scope:{obj:"=data"},controller:["$scope",function(a){a.toggle=function(){a.active=a.active?!1:!0}}],templateUrl:"/assets/angular/widgets/partials/toggle.html"}}),websiteApp.directive("track",["$rootScope",function(a){return{restrict:"A",link:["scope","element","attrs",function(b,c){c.bind("mouseleave",function(a){_record_details(a)}),c.bind("mouseenter",function(a){_record_details(a)}),c.bind("click",function(a){_record_details(a)}),_record_details=function(b){node_name=b.currentTarget.nodeName,time_stamp=b.timeStamp,thousand_milliseconds=1e5,time_stamp=thousand_milliseconds*(time_stamp%thousand_milliseconds/thousand_milliseconds),action_type=b.type,"A"==node_name&&(node_name=b.currentTarget.href),id=b.currentTarget.id,uid=node_name+":"+id,array=id.split("-"),containsCategory=array.length>1,containsCategory?(category=array[0],book_id=array[1]):(category="",book_id=""),data_json=[{time_stamp:time_stamp,action_type:action_type,node_name:node_name,uid:uid,category:category,book_id:book_id}],a.data=a.data.concat(data_json)}}]}}]),websiteApp.directive("horizontalScroller",function(){return{restrict:"E",templateUrl:"/assets/angular/widgets/base/horizontal_scroller.html"}}),websiteApp.directive("setFocus",["$timeout","$parse","$rootScope",function(a,b,c){return{link:function(d,e,f){var g=b(f.setFocus);d.$watch(g,function(b){1==b&&a(function(){c.keyCode&&(e[0].value=String.fromCharCode(c.keyCode)),e[0].focus()})})}}}]),websiteApp.directive("typeAhead",["$timeout","$sce","$document",function(a){return{restrict:"E",scope:{items:"=",prompt:"@",title:"@",id:"@",custom:"@",iconClass:"@",customOptions:"@",focusWhen:"=",subtitle:"@",model:"=",onSelect:"&",autoPopulate:"&",onClear:"&"},link:function(){},controller:["$scope","$sce","recommendationService",function(b,c){b.is_current=function(a,c){return b.current==a&&(b.currentItem=c),b.current==a},b.set_current=function(a){b.current=a},b.navigate_options=function(){var a=13==event.keyCode;a&&b.handle_selection(b.currentItem)},b.key_up=function(){var a=38==event.keyCode,c=40==event.keyCode,d=8==event.keyCode;a?b.set_current(0!=b.current?b.current-1:b.filtered.length-1):c?b.set_current(b.current!=b.filtered.length-1?b.current+1:0):d&&(angular.isUndefined(b.model)||""==b.model)&&b.onClear()},_init=function(){b.current=0,b.selected=!0,b.name=""},b.focus_on_input=function(){},b.auto_populate=function(){b.autoPopulate()},b.highlight=function(a,b){return angular.isDefined(b)&&angular.isDefined(a)?c.trustAsHtml(b.replace(new RegExp(a,"gi"),'<span style="font-weight:bold;">$&</span>')):void 0},b.remove_filter=function(){b.model="",b.onClear()},b.handle_selection=function(c){b.model=c.toUpperCase(),b.current=0,b.selected=!0,a(function(){b.onSelect()},200)},_init()}],templateUrl:"/assets/angular/widgets/partials/type_ahead.html"}}]),websiteApp.directive("message",function(){return{restrict:"E",controller:["$scope",function(a){a.close_message=function(){"Allow your webcam. Swipe Left|Right to look for more books."==a.message?a.message='Just "START TYPING" anytime to search.':a.message_closed=!0},_init_motion_adaption=function(){},(_init=function(){a.message_closed=!0})()}],templateUrl:"/assets/angular/widgets/partials/message.html"}}),websiteApp.directive("notification",["$rootScope","$timeout",function(a,b){return{restrict:"E",scope:{notification:"=data"},controller:["$scope",function(c){c.toggle_ticker_popup=function(d){var e=null==a.ticker_popup;if(e)a.ticker_popup=c.notification.book,a.focused_book=null;else if(a.ticker_popup==c.notification.book)a.ticker_popup=null;else{var f=b(function(){a.ticker_popup=c.notification.book});c.$on("destroy",function(){b.cancel(f)})}d.stopPropagation()},_get_arrow_position=function(a){var b=90,c=17;return a.y>b&&a.y<b+54||(a.y>b+54&&a.y<b+108?c+=54:a.y>b+108&&a.y<b+162?c+=108:a.y>b+162&&a.y<b+216?c+=162:a.y>b+216&&a.y<b+270&&(c+=216)),c},c.show_ticker_popup=function(){a.ticker_popup=c.notification.book}}],templateUrl:"/assets/angular/widgets/partials/notification.html"}}]),websiteApp.directive("compile",["$compile",function(a){return["scope","element","attrs",function(b,c,d){var e=b.$watch(function(a){return a.$eval(d.compile)},function(d){c.html(d),a(c.contents())(b),e()})}]}]),websiteApp.directive("searchBar",function(){return{restrict:"E",templateUrl:"/assets/angular/widgets/partials/search_bar.html"}}),websiteApp.directive("checkScrollBottom",function(){return{restrict:"A",link:function(a,b,c){var d=b[0];b.bind("scroll",function(){d.scrollTop+d.offsetHeight>d.scrollHeight&&a.$apply(c.checkScrollBottom)})}}}),websiteApp.directive("checkScrollUp",function(){return{restrict:"A",link:function(a,b,c){var d=b[0],e=d.scrollTop;b.bind("scroll",function(){d.scrollTop<=e&&a.$apply(c.checkScrollUp),e=d.scrollTop})}}}),websiteApp.directive("checkScrollDown",function(){return{restrict:"A",link:function(a,b,c){var d=b[0],e=d.scrollTop;b.bind("scroll",function(){d.scrollTop>e&&a.$apply(c.checkScrollDown),e=d.scrollTop})}}}),websiteApp.directive("focusOut",function(){return function(a,b,c){b.bind("blur",function(){a.$apply(c.focusOut)})}});;var screen_width=screen.width,width=screen_width*(1220/1320)-150,height=screen.height*(864/1064)-100,page_numbers={content:1,first_sentence:2,characters:3,quotes:4,themes:5,subject_places:6,movies_based:7,tags:8,readers:9,news:10,reviews:11,discussions:12,about_author:13};websiteApp.directive("dock",["$rootScope","$timeout",function(){return{restrict:"E",controller:["$scope",function(a){a.turn_page=function(b){a.$emit("turnPage",b)}}],templateUrl:"/assets/angular/widgets/partials/dock.html"}}]),websiteApp.directive("flipbook",["$rootScope","$timeout","scroller",function(a,b,c){return{restrict:"E",replace:!0,compile:["tElement","tAttrs","transclude",function(){var a=width*(10/1320),b=height*(20/1064),d=width/2+a,e=height+b;return _set_elements_height=function(){var a=height-7*b;$(".elements").css("height",a)},_set_depth=function(){$(".depth").css("height",e-b/2)},_set_pre_css=function(){$(".own-size").css("width",d),$(".own-size").css("height",e),$(".back-side").addClass("fixed"),$("#backCoverFold").css("width",d),$("#backCoverFold").css("height",e),$(".author_thumb").css("width",width/2-a),$(".author_thumb").css("height",height-6*b),_set_depth(),_set_elements_height()},_set_post_css=function(){$(".front-side").addClass("fixed"),$("#coverImage").css("width",d),$("#coverImage").css("height",e),$("#frontCoverFold").css("width",d),$("#frontCoverFold").css("height",e),$(".detailed_book").css("position","fixed"),_set_depth()},_update_depth=function(a,b){var c=a.turn("page"),d=a.turn("pages"),e=16*Math.min(1,2*c/d);b=b||c,$(".detailed_book .p2 .depth").css(b>3?{width:e,left:20-e}:{width:0}),e=16*Math.min(1,2*(d-c)/d),$(".detailed_book .p17 .depth").css(d-3>b?{width:e,right:20-e}:{width:0})},_add_listeners_to_content_page=function(a){a.on("click","[data-page]",function(b){var c=page_numbers[$(b.target).data("page")];a.turn("page",c)})},_add_listeners_to_comment_box=function(a){a.on("click",".post_comment",function(){var a=$($(this).parent()),b=a.siblings(".comment_big_box");a.hide(),b.show(),b.find("input").focus()})},_add_listeners_to_post_comment_discussion_page=function(a,b){a.on("keypress",".discussions .comment_box",function(a){if(10==a.which||13==a.which){var d=$(this),e=d.parent().parent().parent().parent(),f=(e.parent().scope().$index,{comment:d.val(),timestamp:"Just now",user:{},nested:!0}),g=e.scope().discussion.nested;if(g)var h=e.scope().$parent.$index;else var h=e.scope().$index;var i=b.detailed_book.book.discussions[h].comments,j=null==i;b.$apply(function(){j?b.detailed_book.book.discussions[h].comments=[f]:b.detailed_book.book.discussions[h].comments.push(f)});var k=d.parent().siblings(".footer");if(k.show(),d.val(""),d.parent().hide(),g)var l=d.parent().parent().parent().parent().parent().parent().children().last();else var l=d.parent().parent().parent().parent().parent().children(".nested_comments").children().last();var m=$(".discussions .elements")[0];c.scrollToElement(l,0,4e3,m)}})},_add_listeners_to_post_comment_review_page=function(a,b){a.on("keypress",".reviews .comment_box",function(a){if(10==a.which||13==a.which){var d=$(this),e=d.parent().parent().parent().parent(),f=(e.parent().parent().hasClass("elements"),e.parent().parent().parent().parent().scope()),g=f.$index,h={comment:d.val(),timestamp:"Just now",user:{},nested:!0},i=e.scope().discussion.nested;if(i)var j=e.scope().$parent.$index;else var j=e.scope().$index;var k=b.detailed_book.book.reviews[g].comments[j].comments,l=null==k;b.$apply(function(){l?b.detailed_book.book.reviews[g].comments[j].comments=[h]:b.detailed_book.book.reviews[g].comments[j].comments.push(h)});var m=d.parent().siblings(".footer");if(m.show(),d.val(""),d.parent().hide(),i)var n=d.parent().parent().parent().parent().parent().parent().children().last();else var n=d.parent().parent().parent().parent().parent().children(".nested_comments").children().last();var o=$(".reviews .elements")[0];c.scrollToElement(n,0,4e3,o)}})},_add_listeners_to_review_header=function(a){a.on("click",".review .header",function(){var a=$(this),b=a.siblings(),d=$(".reviews .elements")[0];c.scrollToElement(a,0,3e3,d),"block"==b.css("display")?b.css("display","none"):b.show()})},_add_listeners_to_like_buttons=function(a){a.on("click",".like",function(){var a=$(this);if(a.hasClass("like_selected"))a.removeClass("like_selected");else{var b=a.siblings(".dislike");a.addClass("like_selected"),b.removeClass("dislike_selected")}})},_add_listeners_to_dislike_buttons=function(a){a.on("click",".dislike",function(){var a=$(this);if(a.hasClass("dislike_selected"))a.removeClass("dislike_selected");else{var b=a.siblings(".like");a.addClass("dislike_selected"),b.removeClass("like_selected")}})},_add_listeners_to_close_book=function(a,b){a.on("click",".close_book",function(){b.destroy_book()})},_add_listeners_to_write_review=function(a){a.on("click",".write_review",function(){$(".reviews .elements").hide(),$(".reviews .text_editor").show(),$(".close_review").css("display","block"),$(".write_review").hide()})},_add_listeners_to_close_review=function(a){a.on("click",".close_review",function(){$(".reviews .elements").show(),$(".reviews .text_editor").hide(),$(".close_review").hide(),$(".write_review").css("display","block")})},_add_listeners_to_book_tag=function(a){a.on("click",".book_tag",function(){var a=($(this).children(".tag_quotes"),$(".loading_icon")),b=$(this).find(".loading_icon");a.hide(),$(".tag_quotes").hide(),b.css("display","block")})},_bind_text_editor=function(){var a=$(".text_editor").children();a.jqte({focus:function(){scope.$apply(function(){a.parents(".jqte").find(".jqte_toolbar").show(),a.parents(".jqte").click(function(){a.parents(".jqte").find(".jqte_toolbar").show()})})},blur:function(){scope.$apply(function(){a.parents(".jqte").find(".jqte_toolbar").hide()})},change:function(){scope.$apply(function(){ngModel.$setViewValue(a.parents(".jqte").find(".jqte_editor")[0].innerHTML)})}}),a.parents(".jqte").find(".jqte_toolbar").hide()},_bind_popover_click_handler=function(a){a.on("click",".user_tooltip .footer .follow",function(){event.stopPropagation()})},{pre:function(a,b){_add_listeners_to_content_page(b,a),_add_listeners_to_comment_box(b,a),_add_listeners_to_post_comment_discussion_page(b,a),_add_listeners_to_post_comment_review_page(b,a),_add_listeners_to_review_header(b,a),_add_listeners_to_like_buttons(b,a),_add_listeners_to_dislike_buttons(b,a),_add_listeners_to_close_book(b,a),_add_listeners_to_write_review(b,a),_add_listeners_to_close_review(b,a),_add_listeners_to_book_tag(b,a),_set_pre_css(),_bind_text_editor()},post:function(a,b){b.turn({width:width,height:height,display:"single",when:{turning:function(a,b){{var c=$(this);c.turn("page"),c.turn("pages")}_update_depth(c,b),b>=2?$(".detailed_book .p2").hasClass("fixed")||$(".detailed_book .p2").addClass("fixed"):$(".detailed_book .p2").removeClass("fixed"),b<c.turn("pages")?$(".detailed_book .p17").hasClass("fixed")||$(".detailed_book .p17").addClass("fixed"):$(".detailed_book .p17").removeClass("fixed")},turned:function(a,b){{var c=$(this);c.turn("pages")}_update_depth(c)}}}),_set_post_css()}}}],controller:["$scope",function(c){c.is_even=function(a){var b=!1;return a%2==0&&(b=!0),b},c.is_image=function(a){var b=!1;return"img"==a&&(b=!0),b},c.peel=function(){$(".detailed_book").turn("peel","br")},c.remove_peel=function(){$(".detailed_book").turn("peel",!1)},c.zoom_in=function(){},c.destroy_book=function(){a.show_book=!1},c.share_quote=function(){},_click_outside_close=function(){$(".close_book").click(function(b){$(".detailed_book").hide(),$(".book_footer").hide(),$(".fade_cover").hide(),a.show_book=!1,b.stopPropagation()})},_set_css=function(){var b=$(".detailed_book");b.show();{var c=a.book_x,d=a.screen_x;a.total_x}if(c>d){var e=c-d;b.css("margin-left",e+"px")}},_add_listeners=function(){a.$on("turnPage",function(a,b){var c=page_numbers[b];$(".detailed_book").turn("page",c),a.stopPropagation()})},(_init=function(){_set_css(),_add_listeners(),_click_outside_close(),b(function(){var b=$(".detailed_book"),c=a.initPage;b.turn("page",c),$($(".review .content")[0]).css("display","block")},1e3)})()}],templateUrl:"/assets/angular/widgets/partials/book.html"}}]),websiteApp.directive("discussion",function(){return{restrict:"E",scope:{discussion:"=data",index:"=index"},compile:["tElement","tAttrs","transclude",function(){show_nested_discussion=function(){scope.discussion.id}}],controller:["$scope",function(a){a.is_even=function(a){var b=!1;return a%2==0&&(b=!0),b}}],templateUrl:"/assets/angular/widgets/partials/book/discussion.html"}}),websiteApp.directive("angularte",function(){return{restrict:"A",require:"^ngModel",link:["scope","element","attrs","ngModel",function(a,b,c,d){$(function(){b.jqte({focus:function(){a.$apply(function(){b.parents(".jqte").find(".jqte_toolbar").show(),b.parents(".jqte").click(function(){b.parents(".jqte").find(".jqte_toolbar").show()})})},blur:function(){a.$apply(function(){b.parents(".jqte").find(".jqte_toolbar").hide()})},change:function(){a.$apply(function(){d.$setViewValue(b.parents(".jqte").find(".jqte_editor")[0].innerHTML)})}}),b.parents(".jqte").find(".jqte_toolbar").hide()}),d.$render=function(){b.parents(".jqte").find(".jqte_editor")[0]&&(b.parents(".jqte").find(".jqte_editor")[0].innerHTML=d.$viewValue||"")}}]}}),websiteApp.directive("reviews",function(){return{restrict:"E",templateUrl:"/assets/angular/widgets/partials/book/reviews.html"}});;function zoomin_book(a,b,c,d){c.initPage=d,a.zoomin_book=!0;var e=event.currentTarget.offsetParent.offsetLeft+event.currentTarget.offsetWidth,f=event.screenX,g=event.currentTarget.offsetParent.offsetParent.scrollWidth;a.$emit("expandBook",a.book.id,e,f,g);var h=b(function(){a.zoomin_book=!1},3e3);a.$on("destroy",function(){b.cancel(h)})}function add_custom_bookmark(a,b,c){var d=a.book.custom_bookmark;if(d){d=d.trim().toUpperCase();for(var e=a.book.labels,f=!1,g=0;g<e.length;g++){var h=e[g];if(h.name==d){f=!0;var i="ALERT- Bookmark with the name '"+d+"' is already added in the list";break}}if(!f){a.book.bookmark_status=1,b.labels=b.labels.concat([{name:d}]),a.book.labels=a.book.labels.concat([{name:d,checked:!0}]);var i="SUCCESS-Custom Bookmark "+d+" added to book "+a.book.title}var j=notify(b,i,c);return a.$on("destroy",function(){c.cancel(j)}),f}}websiteApp.directive("book",["websiteService","$rootScope","widgetService",function(a,b){return{restrict:"E",scope:{book:"=data"},controller:["$scope",function(c){c.show_focused_tooltip=function(a){if(b.focused_book!=c.book){b.ticker_popup=null,b.focused_book=c.book;var d=a.currentTarget.offsetParent.offsetParent.offsetLeft-a.pageX+a.clientX,e=screen.width-(d+a.currentTarget.offsetParent.scrollWidth),f=d;e>f?(e>400?(d=d+a.currentTarget.offsetParent.scrollWidth-a.currentTarget.offsetLeft,b.focused_book.reposition_tooltip={left:d+"px"}):b.focused_book.reposition_tooltip={right:"0px"},b.on_left=!0):(f>400?(d=screen.width-d,b.focused_book.reposition_tooltip={right:d+"px"}):b.focused_book.reposition_tooltip={left:"0px"},b.on_left=!1)}else b.focused_book=null;a.stopPropagation()},(_init=function(){var b=c.book.id;c.book.tweets=[],c.book.show_labels=!1,a.get_book_details("id="+b).then(function(a){angular.extend(c.book,a)})})()}],templateUrl:"/assets/angular/widgets/base/book/book_widget.html"}}]),websiteApp.directive("labelDropdown",["$rootScope","$timeout","widgetService",function(a,b,c){return{restrict:"E",controller:["$scope",function(d){d.stop_propagation=function(a){a.stopPropagation()},d.select_label=function(e){var f=!1,g=d.book.labels;if(d.book.labels[e].checked=!d.book.labels[e].checked,d.book.labels[e].checked){var h=a.user.email,i="<span><b>"+h+"</b> </span><span>bookmarked&nbsp;</span><span class='site_color'>"+d.book.title+"</span><span> to '"+d.book.labels[e].name+"'</span>",j="assets/profile_pic.jpeg",k={thumb:j,message:i,timestamp:(new Date).getTime(),book:{id:d.book.id,title:d.book.title,author_name:d.book.author_name,isbn:d.book.isbn},user:{id:a.user.id,name:a.user.email}};d.$emit("addToNotifications",k);var i="SUCCESS-Added to "+d.book.labels[e].name+" <span class='icon-bookmarks'></span>."}else var i="SUCCESS-Removed from "+d.book.labels[e].name+" <span class='icon-bookmarks'></span>.";var l=notify(a,i,b),m={id:d.book.id,type:"BOOK",name:d.book.labels[e].name,data:d.book.labels[e].checked};c.bookmark(m),d.$on("destroy",function(){b.cancel(l)});for(var n=0;n<g.length;n++)if(g[n].checked){f=!0;break}d.book.bookmark_status=f?1:0},d.stop_horizontal_scroll=function(a){a.stopPropagation()}}],templateUrl:"/assets/angular/widgets/base/book/label_dropdown.html"}}]),websiteApp.directive("bookNavbar",["$rootScope","$timeout",function(a,b){return{restrict:"E",controller:["$scope",function(c){c.show_book=function(d){zoomin_book(c,b,a,d)}}],templateUrl:"/assets/angular/widgets/base/book/book_navbar.html"}}]),websiteApp.directive("listDropdown",function(){return{restrict:"E",controller:function(){},templateUrl:"app/assets/javascripts/angular/widgets/base/book/list_dropdown.html"}}),websiteApp.directive("bookBookmark",["$rootScope","$timeout","widgetService",function(a,b,c){return{restrict:"E",controller:["$scope",function(d){d.toggle_bookmarked=function(e){for(var f=d.book.labels.length,g=a.labels.length,h=f;g>h;h++)d.book.labels.push({name:a.labels[h].name});if(d.book.show_labels){{d.book.bookmark_status,d.book.title,d.book.author_name}if(d.book.custom_bookmark){var i=add_custom_bookmark(d,a,b);if(!i){var j={id:d.book.id,type:"BOOK",name:d.book.custom_bookmark,data:!0};c.bookmark(j)}}else d.book.show_labels=!1}else d.book.show_labels=!0;e.stopPropagation()}}],templateUrl:"/assets/angular/widgets/base/book/bookmark.html"}}]),websiteApp.directive("bookInteract",["$rootScope","$timeout","widgetService",function(a,b,c){return{restrict:"E",scope:{book:"=data"},controller:["$scope",function(d){_init=function(){d.setStatus()},d.show_bookmark_options=function(b){if(d.book.show_labels)d.book.blur_input=!0,d.book.show_labels=!1;else{for(var c=d.book.labels.length,e=a.labels.length,f=c;e>f;f++)d.book.labels.push({name:a.labels[f].name});d.book.blur_input=!1,d.book.show_labels=!0}b.stopPropagation()},d.handle_enter=function(e){var f=13==e.keyCode;if(f){var g=add_custom_bookmark(d,a,b);if(!g){var h={id:d.book.id,type:"BOOK",name:d.book.custom_bookmark,data:!0};c.bookmark(h),d.book.custom_bookmark=""}}},d.setStatus=function(a){d.read=1==a?!0:!1},_init()}],templateUrl:"/assets/angular/widgets/base/book/interact_widget.html"}}]),websiteApp.directive("rate",["$rootScope","$timeout","widgetService","sharedService",function(a,b,c,d){return{restrict:"E",scope:{rate_object:"=data"},controller:["$scope",function(e){e.show_if_rated=function(a){e.temp_rating=e.rate_object.user_rating,e.rate_object.user_rating=parseInt(a)+1,e.ready_to_rate=!0},e.reset_rating=function(){e.ready_to_rate=!1,e.rate_object.user_rating=e.temp_rating},_add_notification=function(){var b=a.user.email,c="<span><b>"+b+"</b> </span><span>gave "+e.rate_object.user_rating+"/10 stars to&nbsp;</span><span class='site_color'>"+e.rate_object.title+"</span>",d="assets/profile_pic.jpeg",f={thumb:d,message:c,timestamp:(new Date).getTime(),book:{id:e.rate_object.id,title:e.rate_object.title,author_name:e.rate_object.author_name,isbn:e.rate_object.isbn},user:{id:a.user.id,name:a.user.email}};e.$emit("addToNotifications",f)},e.mark_as_rated=function(f,g){e.rate_object.rated=!0,e.rate_object.user_rating=parseInt(f)+1,e.temp_rating=parseInt(f)+1;var h=notify(a,"SUCCESS-Thanks, This will help us to recommend you better books.",b);e.$on("destroy",function(){b.cancel(h)});var i={id:e.rate_object.id,data:e.rate_object.user_rating};(angular.isUndefined(e.rate_object.status)||!e.rate_object.status)&&d.mark_as_read(e,e.rate_object,g),c.rate_this_book(i),_add_notification(),g.stopPropagation()},e.is_active=function(a){var b=!1;if(e.rate_object){var c=parseInt(a)+1;c<=e.rate_object.user_rating&&(b=!0)}return b}}],templateUrl:"/assets/angular/widgets/base/book/rate.html"}}]),websiteApp.directive("focusedBook",["$rootScope","$timeout","widgetService","sharedService",function(a,b,c,d){return{restrict:"E",controller:["$scope",function(e){e.handle_enter=function(b,d){var f=13==b.keyCode;if(f){e.add_thumb=!1;var g=a.focused_book.title,h=a.focused_book.author_name,i="/#/user/1/book/"+g+"/author/"+h,j={thumb_url:d,title:g,book_url:i,username:a.user.name,user_thumb:a.user.thumb,user_link:""};c.add_thumbnail(j).then(function(){})}},e.show_feedback_popup=function(){a.focused_book.show_feedback_popup=a.focused_book.show_feedback_popup?!1:!0},e.get_buy_links=function(){e.show_info=!1,e.show_buy=!0,c.get_affiliate_links(a.focused_book.id).then(function(a){e.bnn_links=a.bnn.links})},e.stop_propagation=function(a){a.stopPropagation()},e.close_focused_tooltip=function(){a.focused_book=null},e.own_this_book=function(){if(e.have_this_book){e.have_this_book=!1;var d="SUCCESS-Are you sure, you don't have a copy of "+a.focused_book.title+"? <br/>Your friends might be looking for this book."}else{e.have_this_book=!0;var d="SUCCESS-Thanks, Your friends will now know that you own a copy of "+a.focused_book.title}var f=a.focused_book.id,g=notify(a,d,b);c.own_this_book(f,e.have_this_book),e.$on("destroy",function(){b.cancel(g)})},e.record_read_time=function(f,g){a.focused_book.time_index=f;{var h="SUCCESS-Thanks we have recorded your approximate time to read "+a.focused_book.title+". <br/> This will help us to recommend you books according to your reading skills.";notify(a,h,b)}switch(a.focused_book.status||d.mark_as_read(a,a.focused_book,g),a.focused_book.time_index){case 0:var i="Tiny Read";break;case 1:var i="Small Read";break;case 2:var i="Normal Read";break;case 3:var i="Long Read"}var j=a.user.email,h="<span><b>"+j+"</b> </span><span>described reading length of <span class='site_color'>"+a.focused_book.title+"</span><span>&nbsp; as a&nbsp;'"+i+"'</span>",k="assets/profile_pic.jpeg",l={thumb:k,message:h,timestamp:(new Date).getTime(),book:{id:a.focused_book.id,title:a.focused_book.title,author_name:a.focused_book.author_name,isbn:a.focused_book.isbn},user:{id:a.user.id,name:a.user.email}};e.$emit("addToNotifications",l),c.record_time(a.focused_book.id,f),e.$on("destroy",function(){b.cancel("timeout_event")})},e.is_timer=function(b){var c=!1;return a.focused_book.time_index==b&&(c=!0),c},e.close_interaction_box=function(){a.focused_book.interact=!1,e.hash_tags=[]},e.stop_horizontal_scroll=function(a){a.stopPropagation()},_display_tweet=function(c){if(angular.isDefined(a.focused_book.tweets)&&a.focused_book.tweets.length>0){var d=a.focused_book.tweets,f=b(function(){c<d.length?(a.focused_book.display_tweet=a.focused_book.tweets[c].message,a.focused_book.display_profile=a.focused_book.tweets[c].message?a.focused_book.tweets[c].thumb:"/assets/profile_pic.jpeg",c++,_display_tweet(c)):_display_tweet(0)},2e3);e.$on("destroy",function(){b.cancel(f)})}else a.focused_book.display_profile=null,a.focused_book.display_tweet="What do you feel about this book?"},_open_tab=function(){e.show_info=!0},(_init=function(){var b=a.focused_book.id;(angular.isUndefined(a.focused_book.tweets)||0==a.focused_book.tweets.length)&&c.get_book_feed(b).then(function(b){a.focused_book.tweets=b}),_display_tweet(0),_open_tab(),e.add_thumb=!1})()}],templateUrl:"/assets/angular/widgets/base/book/focused_book.html"}}]),websiteApp.directive("interactionBox",["$rootScope","$timeout","websiteService","widgetService",function(a,b,c,d){return{restrict:"E",controller:["$scope",function(b){b.update_hashtagged_comment=function(){},b.stop_propagation=function(a){a.stopPropagation()},b.close_interaction_box=function(){a.focused_book.interact=!1,b.hash_tags=[]},b.stop_horizontal_scroll=function(a){a.stopPropagation()},b.handle_selection=function(c){b.current=0;var d=a.focused_book.current_comment.split(" "),e=a.focused_book.hash_tagged_comment.split(" "),f=(String.fromCharCode(event.keyCode),d.length);if(1==f)var g=d.slice(0,f-1).join(" ").trim(),h=e.slice(0,f-1).join(" ").trim();else var g=d.slice(0,f-1).join(" ")+" ",h=e.slice(0,f-1).join(" ")+" ";d.pop(),e.pop(),8==event.keyCode,b.hash_tagging;a.focused_book.hash_tagged_comment=h+"<b>"+c+"</b>",a.focused_book.current_comment=g+c,b.hash_tags=null,event.stopPropagation()},b.handle_backspace=function(c){var d=a.focused_book.current_comment.split(" "),e=a.focused_book.hash_tagged_comment.split(" "),f=(String.fromCharCode(c.keyCode),d.length);if(1==f)var g=d.slice(0,f-1).join(" "),h=e.slice(0,f-1).join(" ");else var g=d.slice(0,f-1).join(" ")+" ",h=e.slice(0,f-1).join(" ")+" ";var i=d.pop(),j=e.pop(),k=8==c.keyCode,l=b.hash_tagging;if(k){if("#"==i)b.hash_tagging=!1,b.hash_tags=[],a.focused_book.hash_tagged_comment=h;else{var m=h.split("<b>").length!=h.split("</b>").length,n=">"==j[j.length-1];if(m&&(e=h.split("<b>"),f=e.length,h=e.slice(0,f-1).join("<b>"),g=h.replace(/<b>/,"").replace(/<\/b>/,"")),l||n)a.focused_book.hash_tagged_comment=h,a.focused_book.current_comment=g,b.is_new_word_initiation=!0,b.hash_tagging=!1,b.hash_tags=[],c.preventDefault();else{var o=a.focused_book.hash_tagged_comment;a.focused_book.hash_tagged_comment=o.substring(0,o.length-1)}}a.focused_book.current_comment&&""!=a.focused_book.current_comment||(a.focused_book.hash_tagged_comment="")}c.stopPropagation()},b.handle_hash_tags=function(d){""==a.focused_book.current_comment.trim()&&(b.is_new_word_initiation=!0);var e=a.focused_book.current_comment.split(" "),f=String.fromCharCode(d.keyCode),g=e.length,h=(e.slice(0,g-1).join(" "),e.pop()),i=b.is_new_word_initiation,j=(b.hash_tagging,13==d.keyCode);if(j&&b.hash_tags)d.preventDefault(),b.handle_selection(b.currentItem);else if(j&&!b.hash_tags){var k=a.focused_book.hash_tagged_comment.replace(/<b>/,"<a>").replace(/<\/b>/,"</a>");if(a.user.thumb)var l=a.user.thumb,m={message:k,thumb:l};else var m={message:k};a.focused_book.current_comment="",a.focused_book.hash_tagged_comment="",a.focused_book.tweets.push(m),_add_comment(m),d.preventDefault()}else{if(i&&"#"==f){var n="<b>"+f+"</b>";b.hash_tagging=!0,a.focused_book.hash_tagged_comment=a.focused_book.hash_tagged_comment+n}else if(i&&"+"==f){var n="<b>"+f+"</b>";b.hash_tagging=!0,a.focused_book.hash_tagged_comment=a.focused_book.hash_tagged_comment+n,b.search_for="TAGS"}else if(i&&"@"==f){var n="<b>"+f+"</b>";b.hash_tagging=!0,a.focused_book.hash_tagged_comment=a.focused_book.hash_tagged_comment+n,b.search_for="[AUTHORS, READERS]"}else if(" "==f)b.hash_tagging=!1,a.focused_book.hash_tagged_comment=a.focused_book.hash_tagged_comment+f,b.search_for=null;else if(b.hash_tagging){var o=a.focused_book.hash_tagged_comment.split("</b>"),p=o.length;if(p>2){var q=o[p-2]+f+"</b>"+o[p-1];a.focused_book.hash_tagged_comment=o.slice(0,p-2).join("</b>")+"</b>"+q}else{var q=o[p-2]+f+"</b>"+o[p-1];a.focused_book.hash_tagged_comment=q}}else a.focused_book.hash_tagged_comment=a.focused_book.hash_tagged_comment+f;b.search_for&&h.length>2&&(string_to_be_searched=h.slice(1,h.length)+""+f,c.search(string_to_be_searched.trim(),b.search_for,3).then(function(a){b.hash_tags=[];for(var c=a.results.data,d=0;d<c.length;d++){var e={name:c[d][0]};b.hash_tags.push(e)}})),b.is_new_word_initiation=" "==f?!0:!1}d.stopPropagation()},_add_comment=function(c){var e={id:a.focused_book.id,message:c};d.comment(e);var f=a.user.email,g="<span><b>"+f+"</b> </span><span class='site_color'>"+c.message+"</span>",h="assets/profile_pic.jpeg",i={thumb:h,message:g,timestamp:(new Date).getTime(),book:{id:a.focused_book.id,title:a.focused_book.title,author_name:a.focused_book.author_name,isbn:a.focused_book.isbn},user:{id:a.user.id,name:a.user.email}};b.$emit("addToNotifications",i)},b.is_current=function(a,c){return b.current==a&&(b.currentItem=c),b.current==a},b.set_current=function(a){b.current=a},b.key_up=function(){var a=38==event.keyCode,c=40==event.keyCode;a?b.set_current(0!=b.current?b.current-1:b.hash_tags.length-1):c&&b.set_current(b.current!=b.hash_tags.length-1?b.current+1:0)},(_init=function(){b.is_new_word_initiation=!0,a.focused_book.current_comment="",a.focused_book.hash_tagged_comment="",b.current=0})()}],templateUrl:"/assets/angular/widgets/base/book/interaction_box.html"}}]),websiteApp.directive("bookTags",["$rootScope","$timeout",function(a,b){return{restrict:"E",controller:["$scope",function(c){c.show_book=function(d){zoomin_book(c,b,a,d)}}],templateUrl:"/assets/angular/widgets/base/book/book_tags.html"}}]),websiteApp.directive("recommend",["$rootScope","$timeout","widgetService",function(a,b,c){return{restrict:"E",scope:{recommend_object:"=data"},controller:["$scope",function(d){d.select_thumb=function(a){var b="true"==a.currentTarget.dataset.selected;b?(a.currentTarget.dataset.selected=!1,a.currentTarget.style.border="2px solid transparent"):(a.currentTarget.dataset.selected=!0,a.currentTarget.style.border="2px solid")},d.stop_horizontal_scroll=function(a){a.stopPropagation()},d.recommend=function(){var e=d.recommend_object.title,f=d.recommend_object.author_name;if(d.recommend_object.recommended){d.recommend_object.recommended=!1;var g="SUCCESS-"+e+" by "+f+" has been recommended to selected friends.",h=notify(a,g,b);d.$on("destroy",function(){b.cancel(h)}),c.recommend("BOOK",d.recommend_object.id,d.recommend_object.recommended)}else d.recommend_object.recommended=!0},(_init=function(){d.user={},d.user.friends=a.user.friends})()}],templateUrl:"/assets/angular/widgets/base/book/recommend.html"}}]),websiteApp.directive("markAsRead",["$rootScope","$timeout","widgetService","sharedService","stropheService",function(a,b,c,d,e){return{restrict:"E",controller:["$scope",function(b){b.mark_as_read=function(c){var f=a.user.name,g=f+"added "+b.book.title+" to Books Read.";d.mark_as_read(b,b.book,c),e.send_notification(g)}}],templateUrl:"/assets/angular/widgets/base/book/mark_as_read.html"}}]);var global_display_timer=0;;websiteApp.directive("author",["$rootScope","widgetService",function(a){return{restrict:"E",scope:{author:"=data"},controller:["$scope",function(b){b.hover=function(){b.hovered=!0},b.mouseout=function(){b.hovered=!1},b.show_focused_tooltip=function(c){if(a.focused_author!=b.author){a.focused_author=b.author;var d=c.currentTarget.offsetParent.offsetParent.offsetLeft-c.pageX+c.clientX,e=screen.width-(d+c.currentTarget.offsetParent.scrollWidth),f=d;e>f?e>400?(d=d+c.currentTarget.offsetParent.scrollWidth-c.currentTarget.offsetLeft,a.focused_author.reposition_tooltip={left:d+"px",top:"60px"}):a.focused_author.reposition_tooltip={right:"0px",top:"60px"}:f>400?(d=screen.width-d,a.focused_author.reposition_tooltip={right:d+"px",top:"60px"}):a.focused_author.reposition_tooltip={left:"0px",top:"60px"}}else a.focused_author=null;c.stopPropagation()},(_init=function(){b.active_author_filter=!0})()}],templateUrl:"/assets/angular/widgets/base/author/author_widget.html"}}]),websiteApp.directive("focusedAuthor",["$rootScope","$timeout","widgetService",function(a){return{restrict:"E",controller:["$scope",function(b){b.stop_propagation=function(a){a.stopPropagation()},b.close_focused_tooltip=function(){a.focused_author=null},b.close_interaction_box=function(){b.focused_author.interact=!1,b.hash_tags=[]},b.stop_horizontal_scroll=function(a){a.stopPropagation()}}],templateUrl:"/assets/angular/widgets/base/author/focused_author.html"}}]),websiteApp.directive("authorBookmark",["$rootScope","$timeout","widgetService",function(a,b,c){return{restrict:"E",controller:["$scope",function(d){d.toggle_bookmarked=function(e){var f=d.author.bookmark_status,g=d.author.name;if(1==f){d.author.bookmark_status=0;var h="SUCCESS-Author "+g+" has been removed from your bookmark shelf."}else{d.author.bookmark_status=1;var h="SUCCESS-AUTHOR "+g+" has been added to your bookmark shelf.";a.$broadcast("glowBookmark")}var i=notify(a,h,b);d.$on("destroy",function(){b.cancel(i)}),c.bookmark("AUTHOR",d.author.id,d.author.bookmark_status),e.stopPropagation()}}],templateUrl:"/assets/angular/widgets/base/author/bookmark.html"}}]),websiteApp.directive("authorInteract",["websiteService",function(a){return{restrict:"E",controller:["$scope",function(b){_init=function(){b.setStatus()},b.setStatus=function(a){b.read=1==a?!0:!1},b.handle_selection=function(){},b.set_current=function(){},b.handle_backspace=function(a){var c=$(a.currentTarget).val().split(" "),d=$(a.currentTarget).siblings().html().split(" "),e=(String.fromCharCode(a.keyCode),c.length);if(1==e)var f=c.slice(0,e-1).join(" "),g=d.slice(0,e-1).join(" ");else var f=c.slice(0,e-1).join(" ")+" ",g=d.slice(0,e-1).join(" ")+" ";var h=c.pop(),i=d.pop(),j=8==a.keyCode,k=b.hash_tagging;if(j){if("#"==h)b.hash_tagging=!1,b.hash_tags=[],$(a.currentTarget).siblings().html(g);else if(k)$(a.currentTarget).siblings().html(g),$(a.currentTarget).val(f),b.hash_tagging=!1,b.hash_tags=[],a.preventDefault();else{var l=">"==i[i.length-1];if(l)$(a.currentTarget).siblings().html(g),$(a.currentTarget).val(f),b.hash_tags=[],a.preventDefault();else{var m=$(a.currentTarget).siblings().html();$(a.currentTarget).siblings().html(m.substring(0,m.length-1))}}$(a.currentTarget).val()&&""!=$(a.currentTarget).val()||$(a.currentTarget).siblings().html("")}a.stopPropagation()},b.handle_hash_tags=function(c){{var d=$(c.currentTarget).val().split(" "),e=String.fromCharCode(c.keyCode),f=d.length,g=(d.slice(0,f-1).join(" "),d.pop()),h=""==g;b.hash_tagging}if(h&&"#"==e){var i="<b>"+e+"</b>";b.hash_tagging=!0,$(c.currentTarget).siblings().append(i)}else if(h&&"+"==e){var i="<b>"+e+"</b>";b.hash_tagging=!0,$(c.currentTarget).siblings().append(i),b.search_for="TAGS"}else if(h&&"@"==e){var i="<b>"+e+"</b>";b.hash_tagging=!0,$(c.currentTarget).siblings().append(i),b.search_for="[AUTHORS, authorS]"}else" "==e?(b.hash_tagging=!1,$(c.currentTarget).siblings().append(e),b.search_for=null):b.hash_tagging?$(c.currentTarget).siblings().find("b:last").append(e):$(c.currentTarget).siblings().append(e);b.search_for&&(string_to_be_searched=g.slice(1,g.length)+""+e,a.search(string_to_be_searched.trim(),b.search_for,3).then(function(a){b.hash_tags=a.results})),c.stopPropagation()}}],templateUrl:"/assets/angular/widgets/base/author/author_interact.html"}}]);;websiteApp.directive("reader",["$rootScope","widgetService",function(a){return{restrict:"E",scope:{reader:"=data"},controller:["$scope",function(b){b.hover=function(){b.hovered=!0},b.mouseout=function(){b.hovered=!1},b.show_focused_tooltip=function(c){if(a.focused_reader!=b.reader){a.focused_reader=b.reader;var d=c.currentTarget.offsetParent.offsetParent.offsetLeft-c.pageX+c.clientX,e=screen.width-(d+c.currentTarget.offsetParent.scrollWidth),f=d;e>f?e>400?(d=d+c.currentTarget.offsetParent.scrollWidth-c.currentTarget.offsetLeft,a.focused_reader.reposition_tooltip={left:d+"px",top:"60px"}):a.focused_reader.reposition_tooltip={right:"0px",top:"60px"}:f>400?(d=screen.width-d,a.focused_reader.reposition_tooltip={right:d+"px",top:"60px"}):a.focused_reader.reposition_tooltip={left:"0px",top:"60px"}}else a.focused_reader=null;c.stopPropagation()},(_init=function(){b.active_reader_filter=!0})()}],templateUrl:"/assets/angular/widgets/base/reader/reader_widget.html"}}]),websiteApp.directive("focusedReader",["$rootScope","$timeout","widgetService",function(a){return{restrict:"E",controller:["$scope",function(b){b.stop_propagation=function(a){a.stopPropagation()},b.close_focused_tooltip=function(){a.focused_reader=null},b.close_interaction_box=function(){b.focused_reader.interact=!1,b.hash_tags=[]},b.stop_horizontal_scroll=function(a){a.stopPropagation()}}],templateUrl:"/assets/angular/widgets/base/reader/focused_reader.html"}}]),websiteApp.directive("messageBox",function(){return{restrict:"E",controller:["$scope",function(a){a.close_message_box=function(){a.reader.show_message_box=!1}}],templateUrl:"/assets/angular/widgets/base/reader/message_box.html"}}),websiteApp.directive("readerInteract",["websiteService",function(){return{restrict:"E",controller:["$scope",function(a){a.toggle_message_box=function(){a.reader.show_message_box=a.reader.show_message_box?!1:!0}}],templateUrl:"/assets/angular/widgets/base/reader/reader_interact.html"}}]);;websiteApp.directive("category",function(){return{restrict:"E",scope:{widget:"@"},controller:["$scope",function(a){a.initVerticalText=function(){var b="book"==a.widget,c="reader"==a.widget,d="author"==a.widget;if(b)var e=a.$parent.book;else if(c)var e=a.$parent.reader;else if(d)var e=a.$parent.author;if(e){var f=e.category.name;f&&(a.nameArray=f.split("")),a.rating=e.rating}}}],templateUrl:"/assets/angular/widgets/base/widget/category.html"}}),websiteApp.directive("messageApp",["websiteService",function(){return{restrict:"E",controller:["$scope",function(a){a.send_message=function(){}}],templateUrl:"/assets/angular/widgets/base/widget/message_app.html"}}]),websiteApp.directive("follow",["$rootScope","$timeout","widgetService",function(a,b,c){return{restrict:"E",controller:["$scope",function(d){d.toggle_follow=function(){if(d.reader){var e=d.reader.name;if(d.reader.follow){d.reader.follow=!1;var f=a.user.readers.follow.indexOf(data);a.user.readers.follow.splice(f,1);var g="SUCCESS-Reader "+e+" has been removed from your follow list."}else{d.reader.follow=!0,a.user.readers.follow.push(d.reader);var g="SUCCESS-You are now following "+e+"."}var h=notify(a,g,b);c.follow(d.reader.id,"READER",d.reader.follow)}else if(d.author){var i=d.author.name;if(d.author.follow){d.author.follow=!1;var f=a.user.authors.follow.indexOf(data);a.user.authors.follow.splice(f,1),c.follow(d.author.id,"AUTHOR",d.author.follow);var g="SUCCESS-Author "+i+" has been removed from your follow list."}else{d.author.follow=!0,a.user.authors.follow.push(d.author);var g="SUCCESS-You are now following Author "+i+"."}var h=notify(a,g,b);c.follow(d.author.id,"AUTHOR",d.author.follow)}h&&d.$on("destroy",function(){b.cancel(h)})}}],templateUrl:"/assets/angular/widgets/base/widget/follow.html"}}]),websiteApp.directive("widgetThumb",["$timeout","$rootScope","$filter",function(a,b,c){return{restrict:"E",controller:["$scope",function(b){b.show_images=function(){var c=500;2500==global_display_timer?global_display_timer=c:global_display_timer+=c;var d=a(function(){if(b.book){var a=b.book;a.isbn&&(b.thumb_style={background:"url('"+_get_thumb(a)+"')"})}else if(b.author)var a=b.author;else if(b.reader)var a=b.reader},global_display_timer);b.$on("destroy",function(){a.cancel(d)})},_get_obj=function(){if(b.book)var a=b.book;else if(b.author)var a=b.author;else if(b.reader)var a=b.reader;return a},_get_thumb=function(a){var b=c("thumb")(a.isbn);return b},(_init=function(){var a=_get_obj();a&&a.isbn&&(b.thumb_style={background:"url('"+_get_thumb(a)+"')"}),b.show_images()})()}],templateUrl:"/assets/angular/widgets/base/widget/widget_thumb.html"}}]);