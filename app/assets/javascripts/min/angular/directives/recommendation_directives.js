websiteApp.directive("moreFilters",["$rootScope","$timeout",function(a,b){return{restrict:"E",controller:["$scope","recommendationService","websiteService","RecommendationUIConstants",function(c,d,e,f){_init=function(){c.show_menu=!1,c.countryOptions=[],c.show_lists=!1,c.handle_left_columns(),c.$on("filterChange",function(a,b,d){"country"==d?c.countrySelected=b:"timeGroup"==d?c.timeSelected=b:"readingTime"==d&&(c.readTimeSelected=b),c.advance_filter_changed(b,d)}),d.get_countries().then(function(a){c.countryOptions=_reset_json(),c.countryOptions=c.countryOptions.concat(a.countries),c.countryOptions=[]}),d.get_time_groups().then(function(a){c.timeOptions=_reset_json(),angular.forEach(a.times,function(a){var b=a[0].data,c=b.name+" ("+b.range+")",d={name:c};this.push(d)},c.timeOptions)}),d.get_read_times().then(function(a){c.readTimeOptions=_reset_json(),angular.forEach(a.read_times,function(a){var b=a[0].data,c=b.name,d={name:c,custom_option:!0,type:"readingTime"};this.push(d)},c.readTimeOptions)}),_init_dropdown_filters(),_collapse_dropdown_menu()},_get_filters=function(){d.get_filters().then(function(a){c.more_filters=c.more_filters.concat(a.filters)})},_reset_json=function(){return[{name:"<span class='icon-loop'></span><span>&nbsp;Reset</span>"}]},_collapse_dropdown_menu=function(){c.filter_expanded=!0;b(function(){c.filter_expanded=!1},3e3)},_country_init=function(){return{name:"<span class='icon-earth filter_icon yellow_color'></span><span>&nbsp;&nbsp;&nbsp;Books by Region (Coming Soon)</span>"}},_time_init=function(){return{name:"<span class='icon-calendar filter_icon'></span><span>&nbsp;&nbsp;&nbsp;Books by Era</span>"}},_read_time_init=function(){return{name:"<span class='icon-clock filter_icon orange_color'></span><span>&nbsp;&nbsp;&nbsp;Books by Reading Time</span>"}},_init_dropdown_filters=function(){c.countrySelected=_country_init(),c.timeSelected=_time_init(),c.readTimeSelected=_read_time_init()},c.handle_left_columns=function(){c.column_heights={show_filters:!0,notifications_style:{"max-height":f.NotificationsMinHeight},friends_grid_style:{height:f.FriendsGridMinHeight}}},c.clear_filter=function(d,e){delete a.filters.other_filters[e];var f="SUCCESS-"+e+" filter removed",g=notify(a,f,b);c.$on("destroy",function(){b.cancel(g)}),c.$emit("reloadRecommendations")},c.advance_filter_changed=function(d,e){if("<span class='icon-loop'></span><span>&nbsp;Reset</span>"==d.name){var f="SUCCESS-"+e+" filter has been reset.";delete a.filters.other_filters[e],"country"==e?c.countrySelected=_country_init():"timeGroup"==e?c.timeSelected=_time_init():"readingTime"==e&&(c.readTimeSelected=_read_time_init())}else{var f="SUCCESS-"+d.name+" added to filters.";a.filters.other_filters[e]=d.name}var g=notify(a,f,b);c.$on("destroy",function(){b.cancel(g)}),c.$emit("reloadRecommendations")},c.reset_filters=function(){_init_dropdown_filters(),c.$broadcast("resetFilter"),a.filters.more_filters=[],a.filters.other_filters={},c.$emit("reloadRecommendations");var d="SUCCESS-All filters removed.<br/> You can add filters to look for particular books.",e=notify(a,d,b);c.$on("destroy",function(){b.cancel(e)})},c.stop_click_propagation=function(a){a.stopPropagation()},_reload_page=function(){},c.show_genre_options=function(a,b){if(b)var b=b+String.fromCharCode(event.keyCode);else var b=String.fromCharCode(event.keyCode);var d=3;""==b&&(d=2);var f="q="+b+"&filter="+a+"&count="+d;e.search_genres(f).then(function(a){c.genres=[],angular.forEach(a,function(a){var b={name:a[0],id:a[1]};this.push(b)},c.genres)})},c.on_genre_selection=function(d){c.genre=d,a.filters.other_filters.genre=d;var e="SUCCESS-'"+d+"' added to filters.",f=notify(a,e,b);c.$emit("reloadRecommendations"),c.$on("destroy",function(){b.cancel(f)})},c.show_author_options=function(a,b){if(b)var d=b+String.fromCharCode(event.keyCode);else var d=String.fromCharCode(event.keyCode);e.search(d,"AUTHOR",3).then(function(a){c.authors=[],angular.forEach(a.results.data,function(a){var b={name:a[0],id:a[1]};this.push(b)},c.authors)})},c.on_author_selection=function(d){c.author=d,a.filters.other_filters.author=d;var e="SUCCESS-'"+d+"' added to filters.",f=notify(a,e,b);c.$emit("reloadRecommendations"),c.$on("destroy",function(){b.cancel(f)})},c.toggle_menu=function(){c.show_menu?(c.show_menu=!1,c.filter_expanded=!1):(c.show_menu=!0,c.filter_expanded=!0)},_init()}],templateUrl:"/assets/angular/widgets/partials/more_filters.html"}}]),websiteApp.directive("notificationLink",function(){return{restrict:"E",templateUrl:"/assets/angular/widgets/partials/notification_link.html"}}),websiteApp.directive("tickerPopup",function(){return{restrict:"E",templateUrl:"/assets/angular/widgets/partials/ticker_popup.html"}}),websiteApp.directive("filter",["$rootScope","$timeout","$routeParams",function(a,b,c){return{restrict:"E",scope:{filter:"=data"},controller:["$scope",function(d){_initialise_filters=function(c){if(d.filter){var e=d.filter.id,f=d.filter.name;if(e==parseInt(d.$routeParams.filter_id)){if(d.active=!0,-1==a.filters[c].indexOf(e)){a.filters[c].push(e);var g="SUCCESS-'"+f+"' added to filters.",h=notify(a,g,b);d.$on("destroy",function(){b.cancel(h)})}}else d.active=!1}},_add_listeners=function(){d.$on("resetFilter",function(){d.active&&(d.active=!1)})},(_init=function(){d.$routeParams=c,_initialise_filters("more_filters"),_add_listeners()})()}],templateUrl:"/assets/angular/widgets/partials/filter.html"}}]),websiteApp.directive("mainHeader",["$timeout","$rootScope",function(a,b){return{restrict:"E",controller:["$scope",function(c){_add_listeners=function(){c.$on("gamifyCount",function(d,e,f){if(c.initiate_counting)c.count=c.count+e;else{c.initiate_counting=!0,c.count=e;var g=a(function(){c.is_additive=f,b.user.total_count=f?b.user.total_count+c.count:b.user.total_count-c.count,c.initiate_counting=!1;var d=a(function(){c.count=!1},3e3);c.$on("destroy",function(){a.cancel(d)})},200);c.$on("destroy",function(){a.cancel(g)})}})},(_init=function(){c.count=!1,_add_listeners()})()}],templateUrl:"/assets/angular/widgets/partials/main_header.html"}}]),websiteApp.directive("recommendationFooter",["scroller","$rootScope","websiteService","$timeout","$cookieStore","RecommendationUIConstants",function(a,b,c,d,e,f){return{restrict:"E",controller:["$scope",function(g){g.toggle_bookmarked=function(a){if(!g.bookmark_selected){g.panel_selected="BOOKMARK",e.put("tab",g.panel_selected),g.bookmark_selected=!0,g.read_selected=!1;var d=0;c.get_books_bookmarked(d).then(function(a){angular.isArray(a)&&(b.user.books.bookmarked=[],angular.forEach(a,function(a){var c=[];angular.forEach(b.labels,function(b){if(a[2].indexOf(b.name)>=0)var d={name:b.name,checked:!0};else var d={name:b.name,checked:!1};c.push(d)},c);var d={isbn:a[0],id:a[1],bookmark_status:!0,labels:c};this.push(d)},b.user.books.bookmarked))})}a.stopPropagation()},g.toggle_recommendations=function(){(g.bookmark_selected||g.read_selected)&&(g.read_selected=!1,g.bookmark_selected=!1,g.panel_selected="",e.put("tab",g.panel_selected),g.reset())},g.toggle_read=function(){if(!g.read_selected){g.glowShelf=!1,g.bookmark_selected=!1,g.read_selected=!0,g.panel_selected="READ",e.put("tab",g.panel_selected);var a=0;c.get_books_read(a).then(function(a){b.user.books.read=[],angular.forEach(a,function(a){var b={isbn:a[0],id:a[1],status:!0};this.push(b)},b.user.books.read)})}},g.reset_filter=function(a,b,c,d){var e="timeGroup"==c||"readingTime"==c||"country"==c;if(b){if(e){var f={name:"<span class='icon-loop'></span><span>&nbsp;Reset</span>"};g.advance_filter_changed(f,c)}else g.clear_filter(d,c),g.genre="";a.stopPropagation()}else e||(g.handle_left_columns(),_handle_filter_selection(c))},_handle_filter_selection=function(a){if("genre"==a){g.show_lists=!1,g.genre_selected=!0;var b=d(function(){g.genre_selected=!1},1e3);g.$on("destroy",function(){d.cancel(b)})}if("author"==a){g.show_lists=!1,g.author_selected=!0;var b=d(function(){g.author_selected=!1},500);g.$on("destroy",function(){d.cancel(b)})}},g.handle_notification_ticker_size=function(a,c){var d=angular.isDefined(a);if(d)var e=a.deltaY>0;else var e=c;e&&(g.column_heights={notifications_style:{"max-height":f.NotificationsMaxHeight},friends_grid_style:{height:f.FriendsGridMinHeight},show_filters:!1}),delete b.ticker_popup,d&&a.stopPropagation()},g.goto_info_card=function(){b.compressed_info=!1,a.scrollTo(0,0,2e3)},g.toggle_footer=function(){g.compact_footer=!0},_init_shelf=function(){g.read_selected=!1,(angular.isUndefined(g.bookmark_selected)||!g.bookmark_selected)&&(g.bookmark_selected=!1)},_add_listeners=function(){open_shelf_event=g.$on("showBookReadShelf",function(){g.read_selected=!0,event.stopPropagation()})},_init_left_column=function(){g.show_lists=!1,g.column_heights={notifications_style:{"max-height":f.NotificationsMinHeight},friends_grid_style:{height:f.FriendsGridMinHeight},show_filters:!0}},(_init=function(){_init_left_column(),_init_shelf(),g.compact_footer=window.innerWidth<1e3?!0:!1,g.genre_selected=!1,g.author_selected=!1,g.column_heights={show_filters:!1}})()}],templateUrl:"/assets/angular/widgets/partials/recommendation_footer.html"}}]),websiteApp.directive("bookGrid",["recommendationService","$rootScope",function(a,b){return{restrict:"E",scope:{grid:"=data"},controller:["$scope",function(a){(_init=function(){a.user_id=b.user.id})()}],templateUrl:"/assets/angular/widgets/partials/book_grid.html"}}]),websiteApp.directive("infoCard",["$rootScope","$timeout","sharedService","websiteService","WebsiteUIConstants",function(a,b,c,d,e){return{restrict:"E",controller:["$scope","websiteService",function(d,f){d.mark_as_read=function(a,b){c.mark_as_read(d,a,b)},d.save_genre=function(a){var b={genre:a.id,status:!0};f.save_user_info(b)},d.remove_genre=function(a){var b={genre:a.id,status:!1};f.save_user_info(b)},d.search_info_card=function(a,c){var f=a.keyCode==e.KeyUp,g=a.keyCode==e.KeyDown,h=a.keyCode==e.Enter,i=a.keyCode==e.Backspace,j=!(f||g||h);if(j){if("BOOK"==c)var k=d.info.search_book.length>3;else var k=d.info.search_author.length>3;k?search_input_timeout=b(function(){d.handle_search_input(c)},500):i&&("BOOK"==c?(d.popular_books=[],d.get_popular_books()):(d.popular_authors=[],d.get_popular_authors()))}},d.handle_search_input=function(a){d.loading=!0,"BOOK"==a?f.search_books(d.info.search_book).then(function(a){d.popular_books=[],a=a.results,0!=a.length?angular.forEach(a,function(a){var b=null!=a[4],c={isbn:a[0],id:a[1],title:a[2],author_name:a[3],status:b};this.push(c)},d.popular_books):d.popular_books=[{title:"No results found..."}],d.loading=!1,b.cancel(search_input_timeout)}):f.search_authors(d.info.search_author).then(function(a){d.popular_authors=[],0!=a.length?angular.forEach(a,function(a){var b={name:a[0]};this.push(b)},d.popular_authors):d.popular_authors=[{title:"No results found..."}],d.loading=!1,b.cancel(search_input_timeout)})},_get_genres=function(){(angular.isUndefined(d.info.genres)||0==d.info.genres.length)&&(d.info.genres=[],f.get_genres().then(function(a){angular.forEach(a,function(a){var b=null!=a[3],c={name:a[0],id:a[1],icon:a[2],status:b};this.push(c)},d.info.genres)}))},_profile_status_colors=function(){var b=a.user.profile_status;0==b?a.user.profile_status_color="#4374e0":1==b?a.user.profile_status_color="#65b045":2==b?a.user.profile_status_color="#d73d32":3==b?a.user.profile_status_color="#11a9cc":4==b?a.user.profile_status_color="#981b48":5==b?a.user.profile_status_color="#7e3794":6==b?a.user.profile_status_color="#4374e0":7==b?a.user.profile_status_color="#981b48":8==b&&(a.user.profile_status_color="#981b48")},_handle_info_card_bindings=function(b){3==a.user.profile_status?b.get_popular_books():2==a.user.profile_status?_get_genres():4==a.user.profile_status?b.get_popular_authors():6==a.user.profile_status&&(navigator.geolocation?navigator.geolocation.getCurrentPosition(function(c){var d=c.coords.latitude,e=c.coords.longitude;a.user.latitude=d,a.user.longitude=e,b.set_location()}):x.innerHTML="Geolocation is not supported by this browser.")},_get_info_data=function(){f.get_info_data().then(function(a){d.book_counts=a.reading_count_list,d.user_book_count=d.book_counts[0]})},d.edit_books_read=function(){d.goto_info_card(),a.user.profile_status=3,d.get_popular_books()},d.edit_authors_read=function(){d.goto_info_card(),a.user.profile_status=4,d.get_popular_authors()},d.get_popular_authors=function(){var a=d.popular_authors.length,b=!d.loading;b&&(d.loading=!0,f.get_popular_authors(a).then(function(a){angular.forEach(a,function(a){var b={name:a[0]};this.push(b)},d.popular_authors),d.loading=!1}))},d.get_popular_books=function(){var a=d.popular_books.length,b=!d.loading;b&&(d.loading=!0,f.get_popular_books(a).then(function(a){angular.forEach(a,function(a){var b=null!=a[4],c={isbn:a[0],id:a[1],title:a[2],author_name:a[3],status:b};this.push(c)},d.popular_books),d.loading=!1}))},d.prev_profile_state=function(){a.user.profile_status=0!=a.user.profile_status?a.user.profile_status-1:8,_handle_info_card_bindings(d),_profile_status_colors()},d.next_profile_state=function(){a.user.profile_status=8!=a.user.profile_status?a.user.profile_status+1:0,_handle_info_card_bindings(d),_profile_status_colors()},d.stop_horizontal_scroll=function(a){a.stopPropagation()},d.update_profile=function(){var b=event.keyCode==e.Enter;if(b){var c=a.user.profile_status;0==c&&(f.update_profile(a.user),a.user.profile_status=a.user.profile_status+1,_profile_status_colors())}},d.user_profile_changed=function(a){var b={profile:a.name};f.save_user_info(b)},d.add_book=function(){},d.add_author=function(){},d.set_user_name=function(){if(a.user.name.length>0){var b={name:a.user.name};f.save_user_info(b)}},d.set_gender=function(){if(a.user.gender){var b={gender:a.user.gender};f.save_user_info(b)}},d.set_init_book_read_count=function(){if(a.user.init_book_read_count){var b={init_book_read_count:a.user.init_book_read_count};f.save_user_info(b)}},d.set_init_book_written_count=function(){if(a.user.init_book_written_count){var b={init_book_written_count:a.user.init_book_written_count};f.save_user_info(b)}},d.set_location=function(){if(a.user.latitude){var b={latitude:a.user.latitude,longitude:a.user.longitude};f.save_user_info(b)}},d.set_date_of_birth=function(){var b={selectedYear:a.user.selectedYear,selectedMonth:a.user.selectedMonth,selectedDay:a.user.selectedDay};f.save_user_info(b)},(_init=function(){a.user.profile_status=0,_profile_status_colors(),_get_info_data(),d.popular_books=[],d.popular_authors=[],d.loading=!1,d.info={search_book:"",search_author:"",genres:[]},d.profileOptions=[{name:"Reader"},{name:"Author"},{name:"Publisher"},{name:"Editor"}],a.compressed_info=!1,d.profileSelected={name:"Reader"},d.info_card_width=350,d.info_card_ratio=1.34,d.$on("cropme:done",function(a,b){var c={blob:b};f.save_user_info(c)})})()}],templateUrl:"/assets/angular/widgets/base/widget/info_card.html"}}]);