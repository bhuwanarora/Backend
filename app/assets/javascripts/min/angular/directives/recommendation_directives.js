websiteApp.directive("moreFilters",["$rootScope","$timeout",function(a,b){return{restrict:"E",controller:["$scope","recommendationService","websiteService",function(c,d,e){_init=function(){c.show_menu=!1,c.countryOptions=[],c.$on("filterChange",function(a,b,d){"country"==d?c.countrySelected=b:"timeGroup"==d?c.timeSelected=b:"readingTime"==d&&(c.readTimeSelected=b),c.advance_filter_changed(b,d)}),d.get_countries().then(function(a){c.countryOptions=_reset_json(),c.countryOptions=c.countryOptions.concat(a.countries)}),d.get_time_groups().then(function(a){c.timeOptions=_reset_json(),angular.forEach(a.times,function(a){var b=a[0].data,c=b.name+" ("+b.range+")",d={name:c};this.push(d)},c.timeOptions)}),d.get_read_times().then(function(a){c.readTimeOptions=_reset_json(),angular.forEach(a.read_times,function(a){var b=a[0].data,c=b.name,d={name:c,custom_option:!0,type:"readingTime"};this.push(d)},c.readTimeOptions)}),_init_dropdown_filters(),_collapse_dropdown_menu()},_reset_json=function(){return[{name:"<span class='icon-loop'></span><span>&nbsp;Reset</span>"}]},_collapse_dropdown_menu=function(){c.filter_expanded=!0;b(function(){c.filter_expanded=!1},3e3)},_country_init=function(){return{name:"<span class='icon-earth filter_icon green'></span><span>&nbsp;&nbsp;&nbsp;Filter by Region</span>"}},_time_init=function(){return{name:"<span class='icon-calendar filter_icon magenta'></span><span>&nbsp;&nbsp;&nbsp;Filter by Era</span>"}},_read_time_init=function(){return{name:"<span class='icon-clock filter_icon cyan'></span><span>&nbsp;&nbsp;&nbsp;Filter by Reading Time</span>"}},_init_dropdown_filters=function(){c.countrySelected=_country_init(),c.timeSelected=_time_init(),c.readTimeSelected=_read_time_init()},c.handle_left_columns=function(){c.column_heights={show_filters:!0,notifications_style:{"max-height":"110px"},friends_grid_style:{height:"75px"}}},c.clear_filter=function(d,e){a.filters.other_filters[e]=null;var f="SUCCESS-"+e+" filter removed",g=notify(a,f,b);c.$on("destroy",function(){b.cancel(g)}),c.$emit("reloadRecommendations")},c.advance_filter_changed=function(d,e){if("<span class='icon-loop'></span><span>&nbsp;Reset</span>"==d.name){var f="SUCCESS-"+e+" filter has been reset.";delete a.filters.other_filters[e],"country"==e?c.countrySelected=_country_init():"timeGroup"==e?c.timeSelected=_time_init():"readingTime"==e&&(c.readTimeSelected=_read_time_init())}else{var f="SUCCESS-"+d.name+" added to filters.";a.filters.other_filters[e]=d.name}var g=notify(a,f,b);c.$on("destroy",function(){b.cancel(g)}),c.$emit("reloadRecommendations")},c.reset_filters=function(){_init_dropdown_filters(),c.$broadcast("resetFilter"),a.filters.more_filters=[],a.filters.other_filters={},c.$emit("reloadRecommendations");var d="SUCCESS-All filters removed.<br/> You can add filters to look for particular books.",e=notify(a,d,b);c.$on("destroy",function(){b.cancel(e)})},c.stop_click_propagation=function(a){a.stopPropagation()},_reload_page=function(){},c.show_genre_options=function(a,b){if(b)var e=b+String.fromCharCode(event.keyCode);else var e=String.fromCharCode(event.keyCode);var a="q="+e+"&filter="+a;d.get_genres(a).then(function(a){c.genres=[],angular.forEach(a.genres.data,function(a){this.push(a[0].data)},c.genres)})},c.on_genre_selection=function(d){c.genre=d,a.filters.other_filters.genre=d;var e="SUCCESS-'"+d+"' added to filters.",f=notify(a,e,b);c.$emit("reloadRecommendations"),c.$on("destroy",function(){b.cancel(f)})},c.show_author_options=function(a,b){if(b)var d=b+String.fromCharCode(event.keyCode);else var d=String.fromCharCode(event.keyCode);e.search(d,"AUTHOR",3).then(function(a){c.authors=[],angular.forEach(a.results.data,function(a){var b={name:a[0]};this.push(b)},c.authors)})},c.on_author_selection=function(d){c.author=d,a.filters.other_filters.author=d;var e="SUCCESS-'"+d+"' added to filters.",f=notify(a,e,b);c.$emit("reloadRecommendations"),c.$on("destroy",function(){b.cancel(f)})},c.toggle_menu=function(){c.show_menu?(c.show_menu=!1,c.filter_expanded=!1):(c.show_menu=!0,c.filter_expanded=!0)},_init()}],templateUrl:"/assets/angular/widgets/partials/more_filters.html"}}]),websiteApp.directive("notificationLink",function(){return{restrict:"E",templateUrl:"/assets/angular/widgets/partials/notification_link.html"}}),websiteApp.directive("tickerPopup",function(){return{restrict:"E",templateUrl:"/assets/angular/widgets/partials/ticker_popup.html"}}),websiteApp.directive("filter",["$rootScope","$timeout","$routeParams",function(a,b,c){return{restrict:"E",scope:{filter:"=data"},controller:["$scope",function(d){_initialise_filters=function(c){if(d.filter){var e=d.filter.id,f=d.filter.name;if(e==parseInt(d.$routeParams.filter_id)){if(d.active=!0,-1==a.filters[c].indexOf(e)){a.filters[c].push(e);var g="SUCCESS-'"+f+"' added to filters.",h=notify(a,g,b);d.$on("destroy",function(){b.cancel(h)})}}else d.active=!1}},_add_listeners=function(){d.$on("resetFilter",function(){d.active&&(d.active=!1)})},(_init=function(){d.$routeParams=c,_initialise_filters("more_filters"),_add_listeners()})()}],templateUrl:"/assets/angular/widgets/partials/filter.html"}}]),websiteApp.directive("mainHeader",[function(){return{restrict:"E",templateUrl:"/assets/angular/widgets/partials/main_header.html"}}]),websiteApp.directive("recommendationFooter",["scroller","$rootScope","websiteService","$timeout",function(a,b,c,d){return{restrict:"E",controller:["$scope",function(e){e.toggle_bookmarked=function(a){e.bookmark_selected||(e.panel_selected="BOOKMARK",e.bookmark_selected=!0,e.read_selected=!1,c.get_books_bookmarked().then(function(a){b.user.books.bookmarked=[],angular.forEach(a,function(a){var b=(a[2],{isbn:a[0],id:a[1],bookmark_status:!0,"labels[label_name]['checked']":!0});this.push(b)},b.user.books.bookmarked)})),a.stopPropagation()},e.toggle_recommendations=function(){(e.bookmark_selected||e.read_selected)&&(e.read_selected=!1,e.bookmark_selected=!1,e.panel_selected="",e.reset())},e.toggle_more_filters=function(a){e.show_more_filters=1==e.show_more_filters?!1:!0,a.stopPropagation()},e.toggle_read=function(){e.read_selected||(e.glowShelf=!1,e.bookmark_selected=!1,e.read_selected=!0,e.panel_selected="READ",c.get_books_read(0).then(function(a){b.user.books.read=[],angular.forEach(a,function(a){var b={isbn:a[0],id:a[1],status:!0};this.push(b)},b.user.books.read)}))},e.reset_filter=function(a,b,c,d){var f="timeGroup"==c||"readingTime"==c||"country"==c;if(b){if(f){var g={name:"<span class='icon-loop'></span><span>&nbsp;Reset</span>"};e.advance_filter_changed(g,c)}else e.clear_filter(d,c),e.genre="";a.stopPropagation()}else f||(e.show_more_filters&&e.column_heights.show_filters?e.show_more_filters=!1:(e.show_more_filters=!0,e.handle_left_columns(),_handle_filter_selection(c)))},_handle_filter_selection=function(){if("genre"==type){e.genre_selected=!0;var a=d(function(){e.genre_selected=!1},200);e.$on("destroy",function(){d.cancel(a)})}if("author"==type){e.author_selected=!0;var a=d(function(){e.author_selected=!1},200);e.$on("destroy",function(){d.cancel(a)})}},e.handle_notification_ticker_size=function(a,c){var d=angular.isDefined(a);if(d)var f=a.deltaY>0;else var f=c;e.column_heights=f?{notifications_style:{"max-height":"225px"},friends_grid_style:{height:"75px"},show_filters:!1}:{notifications_style:{"max-height":"110px"},friends_grid_style:{height:"75px"},show_filters:!1},b.ticker_popup=null,d&&a.stopPropagation()},e.goto_info_card=function(){a.scrollTo(0,0,2e3)},e.toggle_footer=function(){e.compact_footer=!0},_init_shelf=function(){e.read_selected=!1,e.bookmark_selected=!1},_add_listeners=function(){open_shelf_event=e.$on("showBookReadShelf",function(){e.read_selected=!0,event.stopPropagation()})},_init_left_column=function(){e.show_lists=!1,e.column_heights={notifications_style:{"max-height":"110px"},friends_grid_style:{height:"75px"},show_filters:!0}},(_init=function(){_init_left_column(),_init_shelf(),e.compact_footer=window.innerWidth<1e3?!0:!1,e.genre_selected=!1,e.author_selected=!1,e.column_heights={show_filters:!1}})()}],templateUrl:"/assets/angular/widgets/partials/recommendation_footer.html"}}]),websiteApp.directive("calendar",function(){return{restrict:"E",scope:{},controller:["$scope",function(a){a.date_check=function(){var b=a.months.indexOf(a.selectedMonth)+1,c=new Date(a.selectedYear,b,0).getDate();a.days=new Array(c).join().split(",").map(function(a,b){return++b})},(_init=function(){a.days=new Array(31).join().split(",").map(function(a,b){return++b}),a.months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],a.years=[];for(var b=(new Date).getFullYear(),c=b;c>1904;c--)a.years.push(c)})()}],templateUrl:"/assets/angular/widgets/partials/calendar.html"}});