var screen_width=screen.width,width=screen_width*(1220/1320)-150,height=screen.height*(864/1064)-100,page_numbers={content:1,first_sentence:2,characters:3,quotes:4,themes:5,subject_places:6,movies_based:7,tags:8,readers:9,news:10,reviews:11,discussions:12,about_author:13};websiteApp.directive("dock",["$rootScope","$timeout",function(){return{restrict:"E",controller:["$scope",function(a){a.turn_page=function(b){a.$emit("turnPage",b)}}],templateUrl:"/assets/angular/widgets/partials/dock.html"}}]),websiteApp.directive("flipbook",["$rootScope","$timeout","scroller",function(a,b,c){return{restrict:"E",replace:!0,compile:["tElement","tAttrs","transclude",function(){var a=width*(10/1320),b=height*(20/1064),d=width/2+a,e=height+b;return _set_elements_height=function(){var a=height-7*b;$(".elements").css("height",a)},_set_depth=function(){$(".depth").css("height",e-b/2)},_set_pre_css=function(){$(".own-size").css("width",d),$(".own-size").css("height",e),$(".back-side").addClass("fixed"),$("#backCoverFold").css("width",d),$("#backCoverFold").css("height",e),$(".author_thumb").css("width",width/2-a),$(".author_thumb").css("height",height-6*b),_set_depth(),_set_elements_height()},_set_post_css=function(){$(".front-side").addClass("fixed"),$("#coverImage").css("width",d),$("#coverImage").css("height",e),$("#frontCoverFold").css("width",d),$("#frontCoverFold").css("height",e),$(".detailed_book").css("position","fixed"),_set_depth()},_update_depth=function(a,b){var c=a.turn("page"),d=a.turn("pages"),e=16*Math.min(1,2*c/d);b=b||c,$(".detailed_book .p2 .depth").css(b>3?{width:e,left:20-e}:{width:0}),e=16*Math.min(1,2*(d-c)/d),$(".detailed_book .p17 .depth").css(d-3>b?{width:e,right:20-e}:{width:0})},_add_listeners_to_content_page=function(a){a.on("click","[data-page]",function(b){var c=page_numbers[$(b.target).data("page")];a.turn("page",c)})},_add_listeners_to_comment_box=function(a){a.on("click",".post_comment",function(){var a=$($(this).parent()),b=a.siblings(".comment_big_box");a.hide(),b.show(),b.find("input").focus()})},_add_listeners_to_post_comment_discussion_page=function(a,b){a.on("keypress",".discussions .comment_box",function(a){if(10==a.which||13==a.which){var d=$(this),e=d.parent().parent().parent().parent(),f=(e.parent().scope().$index,{comment:d.val(),timestamp:"Just now",user:{},nested:!0}),g=e.scope().discussion.nested;if(g)var h=e.scope().$parent.$index;else var h=e.scope().$index;var i=b.detailed_book.book.discussions[h].comments,j=null==i;b.$apply(function(){j?b.detailed_book.book.discussions[h].comments=[f]:b.detailed_book.book.discussions[h].comments.push(f)});var k=d.parent().siblings(".footer");if(k.show(),d.val(""),d.parent().hide(),g)var l=d.parent().parent().parent().parent().parent().parent().children().last();else var l=d.parent().parent().parent().parent().parent().children(".nested_comments").children().last();var m=$(".discussions .elements")[0];c.scrollToElement(l,0,4e3,m)}})},_add_listeners_to_post_comment_review_page=function(a,b){a.on("keypress",".reviews .comment_box",function(a){if(10==a.which||13==a.which){var d=$(this),e=d.parent().parent().parent().parent(),f=(e.parent().parent().hasClass("elements"),e.parent().parent().parent().parent().scope()),g=f.$index,h={comment:d.val(),timestamp:"Just now",user:{},nested:!0},i=e.scope().discussion.nested;if(i)var j=e.scope().$parent.$index;else var j=e.scope().$index;var k=b.detailed_book.book.reviews[g].comments[j].comments,l=null==k;b.$apply(function(){l?b.detailed_book.book.reviews[g].comments[j].comments=[h]:b.detailed_book.book.reviews[g].comments[j].comments.push(h)});var m=d.parent().siblings(".footer");if(m.show(),d.val(""),d.parent().hide(),i)var n=d.parent().parent().parent().parent().parent().parent().children().last();else var n=d.parent().parent().parent().parent().parent().children(".nested_comments").children().last();var o=$(".reviews .elements")[0];c.scrollToElement(n,0,4e3,o)}})},_add_listeners_to_review_header=function(a){a.on("click",".review .header",function(){var a=$(this),b=a.siblings(),d=$(".reviews .elements")[0];c.scrollToElement(a,0,3e3,d),"block"==b.css("display")?b.css("display","none"):b.show()})},_add_listeners_to_like_buttons=function(a){a.on("click",".like",function(){var a=$(this);if(a.hasClass("like_selected"))a.removeClass("like_selected");else{var b=a.siblings(".dislike");a.addClass("like_selected"),b.removeClass("dislike_selected")}})},_add_listeners_to_dislike_buttons=function(a){a.on("click",".dislike",function(){var a=$(this);if(a.hasClass("dislike_selected"))a.removeClass("dislike_selected");else{var b=a.siblings(".like");a.addClass("dislike_selected"),b.removeClass("like_selected")}})},_add_listeners_to_close_book=function(a,b){a.on("click",".close_book",function(){b.destroy_book()})},_add_listeners_to_write_review=function(a){a.on("click",".write_review",function(){$(".reviews .elements").hide(),$(".reviews .text_editor").show(),$(".close_review").css("display","block"),$(".write_review").hide()})},_add_listeners_to_close_review=function(a){a.on("click",".close_review",function(){$(".reviews .elements").show(),$(".reviews .text_editor").hide(),$(".close_review").hide(),$(".write_review").css("display","block")})},_add_listeners_to_book_tag=function(a){a.on("click",".book_tag",function(){var a=($(this).children(".tag_quotes"),$(".loading_icon")),b=$(this).find(".loading_icon");a.hide(),$(".tag_quotes").hide(),b.css("display","block")})},_bind_text_editor=function(){var a=$(".text_editor").children();a.jqte({focus:function(){scope.$apply(function(){a.parents(".jqte").find(".jqte_toolbar").show(),a.parents(".jqte").click(function(){a.parents(".jqte").find(".jqte_toolbar").show()})})},blur:function(){scope.$apply(function(){a.parents(".jqte").find(".jqte_toolbar").hide()})},change:function(){scope.$apply(function(){ngModel.$setViewValue(a.parents(".jqte").find(".jqte_editor")[0].innerHTML)})}}),a.parents(".jqte").find(".jqte_toolbar").hide()},_bind_popover_click_handler=function(a){a.on("click",".user_tooltip .footer .follow",function(){event.stopPropagation()})},{pre:function(a,b){_add_listeners_to_content_page(b,a),_add_listeners_to_comment_box(b,a),_add_listeners_to_post_comment_discussion_page(b,a),_add_listeners_to_post_comment_review_page(b,a),_add_listeners_to_review_header(b,a),_add_listeners_to_like_buttons(b,a),_add_listeners_to_dislike_buttons(b,a),_add_listeners_to_close_book(b,a),_add_listeners_to_write_review(b,a),_add_listeners_to_close_review(b,a),_add_listeners_to_book_tag(b,a),_set_pre_css(),_bind_text_editor()},post:function(a,b){b.turn({width:width,height:height,display:"single",when:{turning:function(a,b){{var c=$(this);c.turn("page"),c.turn("pages")}_update_depth(c,b),b>=2?$(".detailed_book .p2").hasClass("fixed")||$(".detailed_book .p2").addClass("fixed"):$(".detailed_book .p2").removeClass("fixed"),b<c.turn("pages")?$(".detailed_book .p17").hasClass("fixed")||$(".detailed_book .p17").addClass("fixed"):$(".detailed_book .p17").removeClass("fixed")},turned:function(a,b){{var c=$(this);c.turn("pages")}_update_depth(c)}}}),_set_post_css()}}}],controller:["$scope",function(c){c.is_even=function(a){var b=!1;return a%2==0&&(b=!0),b},c.is_image=function(a){var b=!1;return"img"==a&&(b=!0),b},c.peel=function(){$(".detailed_book").turn("peel","br")},c.remove_peel=function(){$(".detailed_book").turn("peel",!1)},c.zoom_in=function(){},c.destroy_book=function(){a.show_book=!1},c.share_quote=function(){},_click_outside_close=function(){$(".close_book").click(function(b){$(".detailed_book").hide(),$(".book_footer").hide(),$(".fade_cover").hide(),a.show_book=!1,b.stopPropagation()})},_set_css=function(){var b=$(".detailed_book");b.show();{var c=a.book_x,d=a.screen_x;a.total_x}if(c>d){var e=c-d;b.css("margin-left",e+"px")}},_add_listeners=function(){a.$on("turnPage",function(a,b){var c=page_numbers[b];$(".detailed_book").turn("page",c),a.stopPropagation()})},(_init=function(){_set_css(),_add_listeners(),_click_outside_close(),b(function(){var b=$(".detailed_book"),c=a.initPage;b.turn("page",c),$($(".review .content")[0]).css("display","block")},1e3)})()}],templateUrl:"/assets/angular/widgets/partials/book.html"}}]),websiteApp.directive("discussion",function(){return{restrict:"E",scope:{discussion:"=data",index:"=index"},compile:["tElement","tAttrs","transclude",function(){show_nested_discussion=function(){scope.discussion.id}}],controller:["$scope",function(a){a.is_even=function(a){var b=!1;return a%2==0&&(b=!0),b}}],templateUrl:"/assets/angular/widgets/partials/book/discussion.html"}}),websiteApp.directive("angularte",function(){return{restrict:"A",require:"^ngModel",link:["scope","element","attrs","ngModel",function(a,b,c,d){$(function(){b.jqte({focus:function(){a.$apply(function(){b.parents(".jqte").find(".jqte_toolbar").show(),b.parents(".jqte").click(function(){b.parents(".jqte").find(".jqte_toolbar").show()})})},blur:function(){a.$apply(function(){b.parents(".jqte").find(".jqte_toolbar").hide()})},change:function(){a.$apply(function(){d.$setViewValue(b.parents(".jqte").find(".jqte_editor")[0].innerHTML)})}}),b.parents(".jqte").find(".jqte_toolbar").hide()}),d.$render=function(){b.parents(".jqte").find(".jqte_editor")[0]&&(b.parents(".jqte").find(".jqte_editor")[0].innerHTML=d.$viewValue||"")}}]}}),websiteApp.directive("reviews",function(){return{restrict:"E",templateUrl:"assets/angular/widgets/partials/book/reviews.html"}});