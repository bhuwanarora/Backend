homeApp.service("sharedService",["$timeout","$rootScope","ColorConstants","$location","bookService","shelfService","$mdToast",function(a,b,c,d,e,f,g){this.get_popular_books=function(a){var b=!(a.info.loading||a.constant.show_book||a.info.author_filter||a.info.group_by_alphabet||a.info.reading_time_filter||a.info.published_era_filter||a.info.custom_loading||a.info.subject_filter||!a.info.infinity);b&&(a.info.loading=!0,this.load_popular_books(a))},this.toggle_bookmark=function(a,c){var d={bottom:!1,top:!0,left:!1,right:!0},e=function(){return Object.keys(d).filter(function(a){return d[a]}).join(" ")};if(angular.isUndefined(c)||!c)var h=!0;else var h=!1;var i=b.bookmark_object.id,j=b.bookmark_object.type,k=a.label_key,l={id:i,type:j,shelf:k,status:h};f.bookmark(l),g.show({controller:"toastController",templateUrl:"assets/angular/html/shared/toast/bookmark_action.html",hideDelay:6e3,position:e()})},this.load_popular_books=function(a){if(angular.isDefined(a.info.books))var b=a.info.books.length;else{a.info.books=[];var b=0}var d=angular.extend(a.filters,{skip_count:b});d=angular.toJson(d);var f=function(b){var c=!1;return angular.forEach(a.info.categories,function(a){angular.equals(a,b)&&(c=!0)}),!c};e.get_popular_books(d).then(function(b){var d=function(a){if(a.pages_count<50)var b="For a flight journey";else if(a.pages_count<100)var b="For a weekend getaway";else if(a.pages_count<=250)var b="For a week holiday";else if(a.pages_count>250)var b="For a month vacation";else var b="Dont Know";return b},e=function(a){if(a.published_year>2e3)var b="Contemporary";else if(a.published_year>=1939&&a.published_year<2e3)var b="Post Modern Literature";else if(a.published_year>=1900&&a.published_year<1939)var b="Modernism";else if(a.published_year>=1837&&a.published_year<1901)var b="Victorian Literature";else if(a.published_year>=1900&&a.published_year<1939)var b="Romanticism";else if(a.published_year>=1798&&a.published_year<1837)var b="Neo Classical Period";else if(a.published_year>=1900&&a.published_year<1939)var b="English Renaissance";else if(a.published_year>=1660&&a.published_year<1798)var b="Middle English Literature";else if(a.published_year>=1900&&a.published_year<1939)var b="Old English Literature";else var b="Don't Know";return b};angular.forEach(b,function(b){angular.forEach(b.root_category,function(b){0==a.info.categories.length?null!=b.name&&a.info.categories.push(b):angular.forEach(a.info.categories,function(a){!angular.equals(b,a)&&f(b)&&null!=b.name&&this.push(b)},a.info.categories)});var g=Math.floor(Math.random()*c.value.length),h=null!=b.status,i=d(b),j=e(b),k={published_era:j,reading_time:i,status:h,isBook:!0,colspan:1,color:c.value[g],rowspan:1,alphabet:b.title[0]};k=angular.extend(b,k),this.push(k)},a.info.books),a.info.loading=!1})}}]);;homeApp.service("timeGroupService",["$http","$q","$rootScope","WebsiteUIConstants",function(a,b,c,d){var e=function(c){var e=b.defer(),f=function(a){return e.resolve(a.data)},g=function(a){500==a.status&&alert(d.ServerError)};return a.get(c).then(f,g),e.promise};this.get_time_groups=function(){return e("/api/v0/times")}}]);;homeApp.service("readingTimeService",["$http","$q","$rootScope","WebsiteUIConstants",function(a,b,c,d){var e=function(c){var e=b.defer(),f=function(a){return e.resolve(a.data)},g=function(a){500==a.status&&alert(d.ServerError)};return a.get(c).then(f,g),e.promise};this.get_read_times=function(){return e("/api/v0/read_times")}}]);;homeApp.service("infinityService",["$http","$q","$rootScope","WebsiteUIConstants",function(a,b,c,d){var e=function(c){var e=b.defer(),f=function(a){return e.resolve(a.data)},g=function(a){500==a.status&&alert(d.ServerError)};return a.get(c).then(f,g),e.promise};this.get_books=function(a){b=angular.extend(c.filters,{skip_count:a});var b=angular.toJson(b);return e("/api/v0/get_filtered_books?q="+b)},this.get_small_reads=function(){return e("/api/v0/small_reads")},this.get_books_from_favourite_author=function(){return e("/api/v0/books_from_favourite_author")},this.get_books_from_favourite_category=function(){return e("/api/v0/books_from_favourite_category")},this.get_books_from_favourite_era=function(){return e("/api/v0/books_from_favourite_era")},this.get_books_on_friends_shelves=function(){return e("/api/v0/books_on_friends_shelves")},this.get_books_from_unexplored_subjects=function(){return e("/api/v0/books_from_unexplored_subjects")}}]);;homeApp.controller("libraryController",["$scope","$rootScope","$timeout","WebsiteUIConstants","SearchUIConstants","bookService","$routeParams","$location","ColorConstants","$mdToast","infinityService","$mdBottomSheet","$mdSidenav","sharedService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){a.get_popular_books=function(){n.get_popular_books(a)},a.init_book=function(b){var c=a.info.books[b];f.get_basic_details(c).then(function(c){a.info.books[b]=angular.extend(a.info.books[b],c)})},a.ungroup=function(){a.info.author_filter=!1,a.info.group_by_alphabet=!1,a.info.reading_time_filter=!1,a.info.published_era_filter=!1,a.info.subject_filter=!1},a.group_by_author=function(){a.info.author_filter=!0,a.info.group_by_alphabet=!1,a.info.reading_time_filter=!1,a.info.published_era_filter=!1,a.info.subject_filter=!1},a.group_by_alphabet=function(){a.info.author_filter=!1,a.info.group_by_alphabet=!0,a.info.reading_time_filter=!1,a.info.published_era_filter=!1,a.info.subject_filter=!1},a.group_by_reading_time=function(){a.info.author_filter=!1,a.info.group_by_alphabet=!1,a.info.reading_time_filter=!0,a.info.published_era_filter=!1,a.info.subject_filter=!1},a.group_by_published_era=function(){a.info.author_filter=!1,a.info.group_by_alphabet=!1,a.info.reading_time_filter=!1,a.info.published_era_filter=!0,a.info.subject_filter=!1},a.group_by_subject=function(){a.info.author_filter=!1,a.info.group_by_alphabet=!1,a.info.reading_time_filter=!1,a.info.published_era_filter=!1,a.info.subject_filter=!0},a.select_read_time=function(){delete a.info.books,a.info.custom_loading=!0},a.select_genre=function(b){delete a.info.books,a.info.custom_loading=!0,a.filters.other=angular.extend(a.filters.other,{genre:b.id}),a._get_popular_books()},a.select_author=function(){delete a.info.books,a.info.custom_loading=!0},a.select_time_group=function(){delete a.info.books,a.info.custom_loading=!0},a._get_popular_books=function(){n.load_popular_books(a)},a.show_grid=function(){a.constant.show_book&&(a.grid_style={height:"initial","padding-bottom":"100px"},a.constant={show_book:!1})},a.show_book=function(c,d){a.grid_style={height:"35px","overflow-y":"hidden","padding-bottom":"0px"},a.constant={show_book:!0},b.active_book=d,c.stopPropagation()},a.toggle_infinity_content=function(){a.info.loading=!0,angular.isDefined(a.info.infinity)&&a.info.infinity?a._get_personalised_suggestions():a._get_popular_books()},a._get_personalised_suggestions=function(){var b=function(a,b){angular.forEach(a,function(a){var b=Math.floor(Math.random()*i.value.length),c={colspan:1,color:i.value[b],rowspan:1};a=angular.extend(a,c),this.push(a)},b)};k.get_small_reads().then(function(c){a.small_reads=[],b(c,a.small_reads)}),k.get_books_from_favourite_author().then(function(c){a.books_from_favourite_author=[],b(c.books,a.books_from_favourite_author),delete c.books,a.likeable_author=c}),k.get_books_from_favourite_category().then(function(b){a.books_from_favourite_category=b.books,a.likeable_category=b.info}),k.get_books_from_favourite_era().then(function(b){a.books_from_favourite_era=b.books,a.likeable_era=b.info}),k.get_books_on_friends_shelves().then(function(b){a.books_on_friends_shelves=b}),k.get_books_from_unexplored_subjects().then(function(b){a.books_from_unexplored_subjects=b.books,a.unexplored_subject=b.info,a.info.loading=!1})};!function(){a.$routeParams=g,a.filters={other:{}},a.grid={},a.active_endorse=!1,a.active_bookmark=!0,a.active_share=!0,a._get_personalised_suggestions(),a.constant={show_book:!1},a.info.books=[],a.search_tag={},a.active_tab={},a.info.categories=[],a.info.loading=!0}();a.show_right_nav=function(a){m("alphabets_sidenav").toggle(),a.stopPropagation()},a.show_left_nav=function(a){m("sort_by_sidenav").toggle(),a.stopPropagation()},a.show_bottom_filters=function(b){l.show({templateUrl:"/assets/angular/html/library/bottom_sheet_filters.html",targetEvent:b,scope:a,preserveScope:!0,controller:"filtersController"})}}]);;homeApp.controller("filtersController",["$scope","$rootScope","$timeout","genreService","authorService","WebsiteUIConstants","SearchUIConstants","timeGroupService","readingTimeService","infinityService","ColorConstants","sharedService","$mdBottomSheet",function(a,b,c,d,e,f,g,h,i,j,k,l,m){a._get_genres=function(){(angular.isUndefined(a.info.genres)||0==a.info.genres.length)&&(a.info.genres=[],d.get_genres().then(function(b){angular.forEach(b,function(a){var b=null!=a.status,c=angular.extend(a,{status:b});this.push(c)},a.info.genres)}))},a.close_filters=function(){m.hide()},a._get_authors=function(){a.info.authors=[];var b=0;e.get_popular_authors(b).then(function(b){angular.forEach(b,function(a){this.push(a)},a.info.authors)})},a.reset_filter=function(){delete a.info.selected_genre,delete a.info.selected_author,delete a.info.selected_year,delete a.info.selected_duration,delete a.search_tag.genre,delete a.search_tag.time_group,delete a.search_tag.author,delete a.search_tag.read_time,b.filters={},n()};var n=function(){a.info.infinity=!0,0==Object.keys(b.filters).length?(a.info.books=[],l.get_popular_books(a)):j.get_books(0).then(function(b){a.info.books=[],angular.forEach(b.book,function(a){var b=Math.floor(Math.random()*k.value.length),c=angular.extend(a,{color:k.value[b]});this.push(c)},a.info.books),a.info.loading=!1,delete b.book,a.info.other_info=b})},o=function(){var c=b.filters.skip_count;delete b.filters.skip_count,Object.keys(b.filters).length>0?(b.filters.skip_count=c,n()):(b.filters.skip_count=c,l.get_popular_books(a))};a.select_genre=function(a){angular.isUndefined(a)?(delete b.filters.category_id,o()):(b.filters.category_id=a.id,n())},a.select_author=function(a){angular.isUndefined(a)?(delete b.filters.author_id,o()):(b.filters.author_id=a.id,n())},a.select_reading_time=function(a){angular.isUndefined(a)?(delete b.filters.reading_time_id,o()):(b.filters.reading_time_id=a.id,n())},a.select_publishing_year=function(a){angular.isUndefined(a)?(delete b.filters.era_id,o()):(b.filters.era_id=a.id,n())},a.search_genres=function(b){a.info.loading=!0,d.search_genres(b).then(function(b){a.info.loading=!1,b.length>0&&(a.info.genres=[],angular.forEach(b,function(a){var b={type:g.Genre,custom_option:!0,icon2:"icon-tag",name:a.category_name,id:a.category_id};this.push(b)},a.info.genres))})},a.search_authors=function(b){a.info.loading=!0,e.search_authors(b).then(function(b){a.info.loading=!1,b.length>0&&(a.info.authors=[],angular.forEach(b,function(a){var b={icon2:"icon-pen",type:g.AuthorSearch,custom_option:!0};b=angular.extend(b,a),this.push(b)},a.info.authors))})},a._get_time_groups=function(){h.get_time_groups().then(function(b){a.info.time_groups=[],angular.forEach(b,function(a){var b={icon2:"icon-calendar",type:g.Year,custom_option:!0};b=angular.extend(b,a),this.push(b)},a.info.time_groups)})},a._get_reading_times=function(){i.get_read_times().then(function(b){a.info.read_times=[],angular.forEach(b,function(a){var b={icon2:"icon-clock",type:g.Time,custom_option:!0};b=angular.extend(b,a),this.push(b)},a.info.read_times)})},a._detect_key=function(a){var b=a.keyCode==f.Backspace||a.keyCode==f.Delete,c=a.keyCode==f.KeyUp,d=a.keyCode==f.KeyDown,e=a.keyCode==f.KeyLeft,g=a.keyCode==f.KeyRight,h=a.keyCode==f.Enter;return{backspace_or_delete:b,keyUp:c,keyDown:d,keyLeft:e,keyRight:g,keyEnter:h}};!function(){a.search_tag={},a.info.genres=[],a.info.authors=[],a.info.time_groups=[],a.info.read_times=[],a._get_time_groups(),a._get_reading_times(),angular.isUndefined(b.filters)&&(b.filters={})}()}]);;homeApp.controller("specificBookController",["$scope","$rootScope","$timeout","bookService","$mdToast","$location","$mdBottomSheet","ColorConstants",function(a,b,c,d,e,f,g,h){a.toggle_endorse=function(){a.book.endorse_status=a.book.endorse_status?!1:!0,d.endorse_book(b.active_book.book_id,a.book.endorse_status),e.show({controller:"toastController",templateUrl:"assets/angular/html/shared/toast/endorse_action.html",hideDelay:6e3,position:a.getToastPosition()})},a.show_shelf_bottom_sheet=function(a,c){b.bookmark_object={type:c,id:a},g.show({templateUrl:"assets/angular/html/shared/shelf_bottom_sheet.html",controller:"shelfController"})},a.getToastPosition=function(){return Object.keys(a.toast_position).filter(function(b){return a.toast_position[b]}).join(" ")},a.rate_book=function(a){d.rate_book(a.book_id,a.user_rating)};var i=function(){var c=/[?&]([^=#]+)=([^&#]*)/g,e=c.exec(f.absUrl());if(null!=e)var g=e[2];if(angular.isDefined(b.active_book))if(angular.isDefined(b.active_book.id))var i=b.active_book.id;else var i=b.active_book.book_id;else var i=g;var j="id="+i;d.get_book_details(j).then(function(c){var d=null!=c.endorse_status,e=null!=c.status,f=Math.floor(Math.random()*h.value.length),g={endorse_status:d,status:e,color:h.value[f]};a.book=angular.isDefined(b.active_book)?angular.extend(b.active_book,c):c,a.book=angular.extend(a.book,g),b.active_book=a.book}),d.update_visited(i),a.toast_position={bottom:!1,top:!0,left:!1,right:!0},a.constant={show_book:!0}};i()}]);;homeApp.controller("timelineController",["$scope","$rootScope","bookService","$location","userService",function(a,b,c,d,e){a.write_reading_journey_for=function(){a.info.book=b.active_book,a.info.show_share=!0,a.info.show_book_share=!0},a.get_feed=function(){angular.isUndefined(a.book_feed)&&(a.book_feed=[]);var b=a.book_feed.length,d=function(a){var b="";switch(a.label){case"BookmarkNode":b="Added to "+a.node.key;break;case"Listopia":break;case"CommunityNode":break;case"BlogNode":break;case"StatusNode":b=a.node.wrapper_content;break;case"EndorseNode":b="Endorsed this book.";break;case"RatingNode":b="Gave "+a.node.content+" rating on 10."}return b},f=function(){var b=[],c=function(a,b){var c=!1,d=0;return a.length>0&&angular.forEach(a,function(a,e){angular.isDefined(a.user)&&a.user.id==b&&(c=!0,d=e)}),{status:c,index:d}};angular.forEach(a.book_feed,function(a){if(angular.isDefined(a.user)){var d=c(b,a.user.id);d.status?(delete a.user,b[d.index].data.push(a)):(angular.isDefined(a.user)&&(d={user:a.user},delete a.user,a=angular.extend(d,{data:[a]})),this.push(a))}else this.push(a)},b),a.book_feed=b};c.get_feed(a.book_id,b).then(function(b){a.book_feed=b,f(),angular.forEach(a.book_feed,function(a){if(angular.isDefined(a.user))e.get_user_details(a.user.id).then(function(b){a.user=angular.extend(a.user,b),angular.forEach(a.data,function(a){var b=d(a);a=angular.extend(a,{message:b})})});else{var b=d(a),c=angular.extend(a,{message:b});a.data=[c]}})})};!function(){var c=/[?&]([^=#]+)=([^&#]*)/g,e=c.exec(d.absUrl());if(null!=e)var f=e[2];if(angular.isDefined(f))var g=f;else var g=b.active_book.book_id;a.book_id=g,a.get_feed()}()}]);;homeApp.controller("realVirtualityController",["$scope","$rootScope","bookService",function(a,b,c){a.change_news=function(){};!function(){var d=b.active_book.book_id;c.get_real_news(d).then(function(b){a.communities=b,a.active_community=b[0]})}()}]);;homeApp.controller("buyController",["$scope","$rootScope","bookService",function(a,b,c){!function(){var d=b.active_book.id||b.active_book.book_id;c.get_borrow_users(d).then(function(b){a.borrow_users=b})}()}]);