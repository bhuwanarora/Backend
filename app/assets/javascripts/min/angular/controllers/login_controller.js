websiteApp.controller("loginController",["$scope","$rootScope","websiteService","Facebook","stropheService","$timeout","$cookieStore",function(a,b,c,d,e,f,g){a.submit=function(b){var c=13==b.keyCode;c&&a.authenticate(!0)},a.authenticate=function(d){var g=b.user.email,h=b.user.password,i=new RegExp("^.{8,}$"),j=new RegExp("^(.)\\1{7,16}$"),k=new RegExp("^.{100,}$");a.error_message="";var l={email:g,password:h,old_user:d};a.loading_icon=!1;var m=function(c){a.error_message=c.message,b.user.profile_status=c.profile_status,b.user.logged=!0,b.user.id=c.user_id,a.loading_icon=!1;var d="INFO- Welcome back "+b.user.name,e=notify(b,d,f);a.$on("destroy",function(){f.cancel(e)}),_is_logged_in()},n=function(c){a.loading_icon=!1,a.error_message=c.data.message,b.user.password=null};b.user.email?b.user.password?i.test(b.user.password)||d?j.test(b.user.password)&&!d?a.error_message="Choose a more secure password":k.test(b.user.password)&&!d?a.error_message="Maximum password length is 100":(a.loading_icon=!0,c.authenticate(l).then(m,n),e.start_connection()):a.error_message="Minimum password length is 8":a.error_message="Enter your password":a.error_message="Enter your email address"},_bind_auth_listeners=function(){a.$on("event:google-plus-signin-success",function(){}),a.$on("event:google-plus-signin-failure",function(){}),a.$on("Facebook:statusChange",function(b,c){"connected"==c.status&&a.$apply(function(){})}),a.$watch(function(){return d.isReady()},function(b){b&&(a.facebookReady=!0)})},a.intent_login=function(){d.getLoginStatus(function(c){"connected"==c.status?(b.logged=!0,a.me()):a.login()})},a.login=function(){d.login(function(c){"connected"==c.status&&(b.logged=!0,a.me())})},a.me=function(){d.api("/me",function(d){c.handle_facebook_user(d),a.$apply(function(){b.user=d,b.user.profile_status=0,b.user.thumb=d.thumb,b.user.logged=!0})})},a.logout=function(){d.logout(function(){a.$apply(function(){b.user={},b.logged=!1})})},_is_logged_in=function(){c.get_user().then(function(d){d.logged_in&&(b.user.logged=!0,b.user.id=d.id,a.$emit("getNotifications"),c.get_user_details().then(function(a){angular.extend(b.user,a)}),g.put("logged",!0),e.start_connection())})},(_init=function(){g.remove("tab"),_is_logged_in(),_bind_auth_listeners()})()}]);