websiteApp.controller("loginController",["$scope","$rootScope","websiteService","Facebook","stropheService","$timeout","$cookieStore","LoginConstants",function(a,b,c,d,e,f,g,h){a.submit=function(b){var c=13==b.keyCode;c&&a.authenticate(!0)},a.authenticate=function(d){var g=b.user.email,i=b.user.password,j=new RegExp("^.{8,}$"),k=new RegExp("^(.)\\1{7,16}$"),l=new RegExp("^.{100,}$");a.error_message="";var m={email:g,password:i,old_user:d};a.loading_icon=!1;var n=function(c){a.error_message=c.message,b.user.profile_status=c.profile_status,b.user.logged=!0,b.user.id=c.user_id,a.loading_icon=!1;var d="INFO- Welcome back "+b.user.name,e=notify(b,d,f);a.$on("destroy",function(){f.cancel(e)}),_is_logged_in()},o=function(c){a.loading_icon=!1,a.error_message=c.data.message,b.user.password=null};b.user.email?b.user.password?j.test(b.user.password)||d?k.test(b.user.password)&&!d?a.error_message=h.ChooseAMoreSecurePassword:l.test(b.user.password)&&!d?a.error_message=h.MaximumPasswordLengthError:(a.loading_icon=!0,c.authenticate(m).then(n,o),e.start_connection()):a.error_message=h.PasswordLengthError:a.error_message=h.PasswordNotPresent:a.error_message=h.EmailNotPresent},_bind_auth_listeners=function(){a.$on("event:google-plus-signin-success",function(){}),a.$on("event:google-plus-signin-failure",function(){}),a.$on("Facebook:statusChange",function(b,c){c.status==h.FacebookLoginStatusCheck&&a.$apply(function(){})}),a.$watch(function(){return d.isReady()},function(b){b&&(a.facebookReady=!0)})},a.intent_login=function(){d.getLoginStatus(function(c){c.status==h.FacebookLoginStatusCheck?(b.logged=!0,a.me()):a.login()})},a.login=function(){d.login(function(c){c.status==h.FacebookLoginStatusCheck&&(b.logged=!0,a.me())})},a.me=function(){d.api("/me",function(d){c.handle_facebook_user(d),a.$apply(function(){b.user=d,b.user.profile_status=0,b.user.thumb=d.thumb,b.user.logged=!0})})},a.logout=function(){d.logout(function(){a.$apply(function(){b.user={},b.logged=!1})})},_is_logged_in=function(){c.get_user().then(function(d){d.logged_in&&(b.user.logged=!0,b.user.id=d.id,a.$emit("getNotifications"),c.get_user_details().then(function(a){angular.extend(b.user,a)}),g.put("logged",!0),e.start_connection())})},(_init=function(){g.remove("tab"),_is_logged_in(),_bind_auth_listeners()})()}]);