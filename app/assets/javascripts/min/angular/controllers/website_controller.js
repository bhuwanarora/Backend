websiteApp.controller("websiteAppController",["$scope","$rootScope","$timeout","websiteService","$document","scroller","$window","WebsiteUIConstants",function(a,b,c,d,e,f,g,h){a.bindHorizontalScroll=function(b,c){b.preventDefault(),c>0?a.move_left(b):a.move_right(b),b.stopPropagation()},_hide_popups=function(){delete b.focused_book,delete b.ticker_popup},a.move_left=function(a){_hide_popups();var b=2e3,c=document.body.scrollWidth;if(a)if("keydown"==a.type||"wheel"==a.type){var d=g.pageXOffset;d*screen.width/c}else var d=a.pageX-a.screenX;else{var d=g.pageXOffset;b=1e3}var e=.35*screen.width;f.scrollTo(d-e,0,b)},a.move_right=function(a){_hide_popups();var c=2e3,d=document.body.scrollWidth;if(a){var e=a.pageX;if("keydown"==a.type||"wheel"==a.type){var h=g.pageXOffset,i=h+2.5*screen.width>d;h*screen.width/d}else var h=a.pageX-(a.screenX-a.offsetX),i=e+screen.width>d}else{var h=g.pageXOffset,i=h+2.5*screen.width>d;c=1e3}i&&(b.loading||(b.loading=!0,b.$broadcast("loadRecommendations")));var j=.35*screen.width;f.scrollTo(h+j,0,c)},a.scroll_one_page_right=function(a){var c=document.body.scrollWidth;if(a)var d=a.pageX-screen.width/2,e=a.pageX+screen.width>c;else{var d=g.pageXOffset;-screen.width/2;var e=g.pageXOffset;+screen.width>c}e&&b.$broadcast("loadRecommendations");var h=screen.width;f.scrollTo(d+h,0,2e3)},a.scroll_one_page_left=function(a){if(a)var b=a.pageX-screen.width/2;else var b=g.pageXOffset-screen.width/2;var c=screen.width;f.scrollTo(b-c,0,2e3)},a.showFeebackForm=function(){},a.show_uploader=function(){a.uploader=!0},_bind_feedback_form=function(){g.onmouseleave=function(){}},_load_recommendations=function(){var a=document.body.scrollWidth,c=event.pageX+screen.width>a;c&&b.$broadcast("loadRecommendations")},_get_book_details=function(c){filter="id="+c,d.get_book_details(filter).then(function(c){a.detailed_book.book=c,b.show_book=!0})},_bind_emit=function(){show_book_event=a.$on("expandBook",function(a,c,d,e,f){b.book_x=d,b.screen_x=e,b.total_x=f,_get_book_details(c),a.stopPropagation()})},_add_listeners=function(){j=a.$on("moveRight",function(){i=c(function(){a.move_right()},1e3)}),add_to_notifications=a.$on("addToNotifications",function(b,c){angular.isUndefined(a.notifications)&&(a.notifications=[]),a.notifications.push(c),b.stopPropagation()}),get_notifications_event=a.$on("getNotifications",function(){d.get_notifications().then(function(b){a.notifications=b.notifications})}),k=a.$on("getLatestNotification",function(){d.get_latest_notification().then(function(b){a.notifications.push(b.notification)})})},a.toggle_login_panel=function(){a.show_login_form=a.show_login_form?!1:!0},_initiate_loading_page=function(){a.loading=!0,a.drop_icon=!1,a.show_login_form=!1,c(function(){a.loading=!1},3e3),c(function(){a.drop_icon=!0},1e3)},a.toggle_notifications=function(){a.show_notifications?(a.show_notifications=!1,a.notifications_seen=!0):a.show_notifications=!0},a.handle_keyboard_bindings=function(c){a.show_book?c.keyCode==h.KeyRight?(c.preventDefault(),$(".detailed_book").turn("next")):c.keyCode==h.KeyLeft?(c.preventDefault(),$(".detailed_book").turn("previous")):c.keyCode==h.Escape&&(c.preventDefault(),b.show_book=!1):c.keyCode==h.KeyRight?(c.preventDefault(),a.move_right(c)):c.keyCode==h.KeyLeft&&(c.preventDefault(),a.move_left(c)),c.stopPropagation();c.keyCode==h.Backspace},a.search=function(){var c=event.currentTarget==event.srcElement&&!b.show_book;c&&($("body").css("white-space","normal"),a.website.searching=!0,b.keyCode=event.keyCode)},_handle_socket_error=function(){},_init_notifications=function(){b.notification_active=!1},_init=function(){_initiate_loading_page(),a.more_filters=[],a.show_notifications=!0,a.notifications_seen=!1,angular.isDefined(b.focused_book)&&(b.focused_book.level2_option=""),a.website={},a.website.searching=!1,a.website.show_search_page=!0,_bind_emit(),_bind_feedback_form(),_add_listeners(),_handle_socket_error(),_init_notifications(),b.user={books:{bookmarked:[],read:[]},authors:{bookmarked:[],follow:[]},readers:{follow:[]},logged:!1},_detect_browser()},_detect_browser=function(){var a,b,c,d=(navigator.appVersion,navigator.userAgent),e=navigator.appName,f=""+parseFloat(navigator.appVersion),g=parseInt(navigator.appVersion,10),i=h.BrowserIncompatible;-1!=(b=d.indexOf("Opera"))?(alert(i),e="Opera",f=d.substring(b+6),-1!=(b=d.indexOf("Version"))&&(f=d.substring(b+8))):-1!=(b=d.indexOf("MSIE"))?(alert(i),e="Microsoft Internet Explorer",f=d.substring(b+5)):-1!=(b=d.indexOf("Chrome"))?(e="Chrome",f=d.substring(b+7)):-1!=(b=d.indexOf("Safari"))?(alert(i),e="Safari",f=d.substring(b+7),-1!=(b=d.indexOf("Version"))&&(f=d.substring(b+8))):-1!=(b=d.indexOf("Firefox"))?(alert(i),e="Firefox",f=d.substring(b+8)):(a=d.lastIndexOf(" ")+1)<(b=d.lastIndexOf("/"))&&(alert(i),e=d.substring(a,b),f=d.substring(b+1),e.toLowerCase()==e.toUpperCase()&&(e=navigator.appName)),-1!=(c=f.indexOf(";"))&&(f=f.substring(0,c)),-1!=(c=f.indexOf(" "))&&(f=f.substring(0,c)),g=parseInt(""+f,10),isNaN(g)&&(f=""+parseFloat(navigator.appVersion),g=parseInt(navigator.appVersion,10))};var i="",j="",k="";_init()}]);