homeApp.directive("communityInfo",["$rootScope","newsService","ColorConstants","$mdDialog","sharedService",function(a,b,c,d,e){return{restrict:"E",scope:{community:"=",info:"="},controller:["$scope",function(d){d.show_book_dialog=function(b,c){e.show_book_dialog(a,d,b,c)};var f=function(){angular.isDefined(d.community)&&(d.community_loading=!0,b.get_feed_info(d.community.id).then(function(a){d.community=angular.extend(d.community,a),angular.forEach(d.community.books,function(a){var b=Math.floor(Math.random()*c.value.length),d=c.value[b];a.color=d}),d.community_loading=!1}))};f()}],templateUrl:"/assets/angular/html/shared/partials/community_info.html"}}]);;homeApp.service("newsService",["$http","$q","$rootScope","WebsiteUIConstants",function(a,b,c,d){this.get_news_info=function(c,d){return angular.isDefined(d)&&""!=d?_deferred_request("/api/v0/news_info?id="+c+"&tag_id="+d,b,a):_deferred_request("/api/v0/news_info?id="+c,b,a)},this.get_chronological_news=function(c){return _deferred_request("/api/v0/chronological_news?id="+c,b,a)},this.get_community_details=function(c){return _deferred_request("/api/v0/basic_community_info?id="+c,b,a)},this.get_metadata=function(c){return _deferred_request("/api/v0/metadata?url="+c,b,a)},this.get_detailed_community_info=function(c){return _deferred_request("/api/v0/detailed_community_info?id="+c,b,a)},this.follow=function(c,d){return _deferred_request("/api/v0/follow_community?id="+c+"&status="+d,b,a)},this.get_feed_info=function(c){return _deferred_request("/api/v0/feed_community_info?id="+c,b,a)},this.news_visited=function(c){return _deferred_request("/api/v0/news_visited?id="+c,b,a)}}]);;homeApp.controller("profileController",["$scope","userService","$rootScope","WebsiteUIConstants","ColorConstants","$location","bookService","newsService","$mdDialog","infinityService","$timeout","sharedService","$mdSidenav",function(a,b,c,d,e,f,g,h,i,j,k,l,m){a.get_feed=function(){if(a.info.selectedIndex=1,!a.info.loading){var c=a.active_user_id;a.info.loading=!0;var d=function(a){var b="";switch(a.label){case"BookmarkNode":b="Added to "+a.node.key;break;case"Listopia":break;case"CommunityNode":break;case"BlogNode":break;case"StatusNode":b=a.node.wrapper_content;break;case"EndorseNode":b="Endorsed this book.";break;case"RatingNode":b="Gave "+a.node.content+" rating on 10.";break;case"FollowsNode":b="Joined room.";break;case"RecommendNode":b="Recommended this book."}return b};angular.isUndefined(a.personal_feed)&&(a.personal_feed=[]);var e=a.personal_feed.length;b.get_personal_feed(c,e).then(function(b){b.length>0&&angular.forEach(b,function(a){if(angular.isDefined(a.book)){var b=d(a);a=angular.extend(a,{message:b})}else if(angular.isDefined(a.community)){var b=d(a);a=angular.extend(a,{message:b})}else{var b=d(a);a=angular.extend(a,{message:b})}}),a.info.loading=!1,a.personal_feed=a.personal_feed.concat(b)})}};var n=function(){return""==getCookie("logged")||null==getCookie("logged")};a.follow_user=function(){n()?m("signup").toggle():(a.profile_user.status=!a.profile_user.status,b.follow(a.profile_user.id,a.profile_user.status))};a.show_book_dialog=function(b,d){l.show_book_dialog(c,a,b,d)};var o=function(){var b=!1;return a.active_user_id==c.user.id?(b=!0,a.info.my_profile=!0,a.hide_follow_links=!1):(a.info.my_profile=!1,a.hide_follow_links=!0),b},p=function(){var c=o();c?r():b.get_user_details(a.active_user_id).then(function(b){a.profile_user=b})},q=function(d){a.active_user_id=d[2],angular.isDefined(c.user)?p():b.get_user_details().then(function(a){c.user=a,p()})},r=function(){a.profile_user=c.user,a.active_user_id=a.profile_user.id},s=function(){if(a.info.my_profile=!0,a.hide_follow_links=!1,angular.isUndefined(c.user)){var d=k(function(){b.get_user_details().then(function(a){c.user=a,r()})},100);a.$on("destroy",function(){k.cancel(d)})}else r()},t=function(){var b=k(function(){a.get_feed()},100);a.$on("destroy",function(){k.cancel(b)})};(function(){a.profile_user={},a.info.embed_share=!0;var b=/[?&]([^=#]+)=([^&#]*)/g,c=b.exec(f.absUrl());angular.isDefined(c)&&null!=c?q(c):s(),t()})()}]);