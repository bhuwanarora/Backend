homeApp.directive("bookInfo",["$rootScope","bookService","$mdDialog",function(a,b,c){return{restrict:"E",scope:{book:"=",info:"="},controller:["$scope",function(d){d.show_book_dialog=function(b,e){a.active_book=b,a.active_book.show_info_only=!0,c.show({templateUrl:"/assets/angular/html/news/book.html",scope:d,preserveScope:!0,targetEvent:e,clickOutsideToClose:!0}),e.stopPropagation()};var e=function(){d.book_loading=!0,b.get_basic_book_details(d.book.id).then(function(a){d.book=angular.extend(d.book,a),d.book_loading=!1})};e()}],templateUrl:"/assets/angular/html/shared/partials/book_info.html"}}]),homeApp.directive("communityInfo",["$rootScope","newsService","ColorConstants","$mdDialog",function(a,b,c,d){return{restrict:"E",scope:{community:"=",info:"="},controller:["$scope",function(e){e.show_book_dialog=function(b,c){a.active_book=b,a.active_book.show_info_only=!0,d.show({templateUrl:"/assets/angular/html/news/book.html",scope:e,preserveScope:!0,clickOutsideToClose:!0,targetEvent:c}),c.stopPropagation()};var f=function(){e.community_loading=!0,b.get_feed_info(e.community.id).then(function(a){e.community=angular.extend(e.community,a),angular.forEach(e.community.books,function(a){var b=Math.floor(Math.random()*c.value.length),d=c.value[b];a.color=d}),e.community_loading=!1})};f()}],templateUrl:"/assets/angular/html/shared/partials/community_info.html"}}]);;homeApp.service("newsService",["$http","$q","$rootScope","WebsiteUIConstants",function(a,b,c,d){this.get_news_info=function(c,d){return angular.isDefined(d)&&""!=d?_deferred_request("/api/v0/news_info?id="+c+"&tag_id="+d,b,a):_deferred_request("/api/v0/news_info?id="+c,b,a)},this.get_chronological_news=function(c){return _deferred_request("/api/v0/chronological_news?id="+c,b,a)},this.get_community_details=function(c){return _deferred_request("/api/v0/basic_community_info?id="+c,b,a)},this.get_metadata=function(c){return _deferred_request("/api/v0/metadata?url="+c,b,a)},this.get_detailed_community_info=function(c){return _deferred_request("/api/v0/detailed_community_info?id="+c,b,a)},this.follow=function(c,d){return _deferred_request("/api/v0/follow_community?id="+c+"&status="+d,b,a)},this.get_feed_info=function(c){return _deferred_request("/api/v0/feed_community_info?id="+c,b,a)}}]);;homeApp.controller("profileController",["$scope","userService","$rootScope","WebsiteUIConstants","ColorConstants","$location","bookService","newsService","$mdDialog",function(a,b,c,d,e,f,g,h,i){var j=function(){b.get_user_details(a.active_user_id).then(function(b){a.profile_user=b})};a.get_feed=function(){if(!a.info.loading){var c=[],d=a.active_user_id;a.info.loading=!0;var f=function(a){var b="";switch(a.label){case"BookmarkNode":b="Added to "+a.node.key;break;case"Listopia":break;case"CommunityNode":break;case"BlogNode":break;case"StatusNode":b=a.node.wrapper_content;break;case"EndorseNode":b="Endorsed this book.";break;case"RatingNode":b="Gave "+a.node.content+" rating on 10.";break;case"FollowsNode":b="Joined community."}return b},g=function(){var a=[],b=function(a,b){var c=!1,d=0;return a.length>0&&angular.forEach(a,function(a,e){angular.isDefined(a.book)&&a.book.id==b&&(c=!0,d=e)}),{status:c,index:d}};angular.forEach(c,function(c){if(angular.isDefined(c.book)){var d=b(a,c.book.id);d.status?(delete c.book,a[d.index].data.push(c)):(angular.isDefined(c.book)&&(d={book:c.book},delete c.book,c=angular.extend(d,{data:[c]})),this.push(c))}else this.push(c)},a),c=a};angular.isUndefined(a.personal_feed)&&(a.personal_feed=[]);var h=a.personal_feed.length;b.get_personal_feed(d,h).then(function(b){b.length>0&&(angular.forEach(b,function(a){var b=Math.floor(Math.random()*e.value.length);angular.isDefined(a.book)&&(a.book=angular.extend(a.book,{color:e.value[b]})),this.push(a)},c),g(),angular.forEach(c,function(a){if(angular.isDefined(a.book))angular.forEach(a.data,function(a){var b=f(a);a=angular.extend(a,{message:b})});else if(angular.isDefined(a.community)){var b=f(a);c=angular.extend(a,{message:b})}else{var b=f(a),c=angular.extend(a,{message:b});a.data=[c]}})),a.info.loading=!1,a.personal_feed=a.personal_feed.concat(c)})}},a.write_reading_journey=function(b){a.info.show_share=!0},a.search_book=function(a){},a.follow_user=function(){a.profile_user.status=!a.profile_user.status,b.follow(a.profile_user.id,a.profile_user.status)};(function(){a.profile_user={};var d=/[?&]([^=#]+)=([^&#]*)/g,e=d.exec(f.absUrl());angular.isDefined(e)&&null!=e?(a.active_user_id=e[2],angular.isDefined(c.user)?(a.profile_user={id:a.active_user_id},c.user.id==a.active_user_id?a.info.my_profile=!0:(a.info.my_profile=!1,a.hide_follow_links=!0)):(a.info.my_profile=!1,a.hide_follow_links=!0),j()):(a.info.my_profile=!0,angular.isUndefined(c.user)?b.get_user_details().then(function(b){c.user=b,a.profile_user=c.user,a.active_user_id=a.profile_user.id}):(a.profile_user=c.user,a.active_user_id=a.profile_user.id)),a.get_feed()})()}]);