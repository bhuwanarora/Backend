homeApp.service("communityService",["$http","$q","$rootScope","WebsiteUIConstants",function(a,b,c,d){var e=function(e){var f=b.defer(),g=function(a){return f.resolve(a.data)},h=function(a){c.user.loading=!1,500==a.status&&alert(d.ServerError)};return a.get(e).then(g,h),f.promise};this.get_news_info=function(a){return e("/api/v0/news_info?id="+a)},this.get_chronological_news=function(a){return e("/api/v0/chronological_news?id="+a)},this.get_community_details=function(a){return e("/api/v0/basic_community_info?id="+a)},this.get_metadata=function(a){return e("/api/v0/metadata?url="+a)},this.get_detailed_community_info=function(a){return e("/api/v0/detailed_community_info?id="+a)},this.follow=function(a,b){return e("/api/v0/follow_community?id="+a+"&status="+b)}}]);;homeApp.controller("profileController",["$scope","userService","$rootScope","WebsiteUIConstants","ColorConstants","$location","bookService","communityService","$mdDialog",function(a,b,c,d,e,f,g,h,i){var j=function(){var c=a.active_user_id;b.get_detailed_info(c).then(function(b){if(0!=b.length){b=b[0];var c=[];angular.forEach(b.categories_id,function(a,c){var e=d.GenreAWS+b.categories_aws_key[c],f={root_category_id:a,root_category_name:b.categories_name[c],url:e,status:!0};this.push(f)},c);var f=[];angular.forEach(b.books_id,function(a,c){var d=Math.floor(Math.random()*e.value.length),f=e.value[d],g={color:f,book_id:a,title:b.books_title[c],author_name:b.books_author_name[c],isbn:b.books_isbn[c],random_style:{"background-color":f}};this.push(g)},f),a.profile_user=angular.extend(a.profile_user,b),a.profile_user=angular.extend(a.profile_user,{favourite_categories:c}),a.profile_user=angular.extend(a.profile_user,{influential_books:f})}})};a.get_feed=function(){if(!a.info.loading){var c=a.active_user_id;a.info.loading=!0;var d=function(a){var b="";switch(a.label){case"BookmarkNode":b="Added to "+a.node.key;break;case"Listopia":break;case"CommunityNode":break;case"BlogNode":break;case"StatusNode":b=a.node.wrapper_content;break;case"EndorseNode":b="Endorsed this book.";break;case"RatingNode":b="Gave "+a.node.content+" rating on 10.";break;case"FollowNode":b="Followed "+a.community.name}return b},f=function(){var b=[],c=function(a,b){var c=!1,d=0;return a.length>0&&angular.forEach(a,function(a,e){angular.isDefined(a.book)&&a.book.id==b&&(c=!0,d=e)}),{status:c,index:d}};angular.forEach(a.personal_feed,function(a){if(angular.isDefined(a.book)){var d=c(b,a.book.id);d.status?(delete a.book,b[d.index].data.push(a)):(angular.isDefined(a.book)&&(d={book:a.book},delete a.book,a=angular.extend(d,{data:[a]})),this.push(a))}else this.push(a)},b),a.personal_feed=b};angular.isUndefined(a.personal_feed)&&(a.personal_feed=[]);var i=a.personal_feed.length;b.get_personal_feed(c,i).then(function(b){b.length>0&&(angular.forEach(b,function(a){var b=Math.floor(Math.random()*e.value.length);angular.isDefined(a.book)&&(a.book=angular.extend(a.book,{color:e.value[b]})),this.push(a)},a.personal_feed),f(),angular.forEach(a.personal_feed,function(a){if(angular.isDefined(a.book))g.get_basic_book_details(a.book.id).then(function(b){a.book=angular.extend(a.book,b),angular.forEach(a.data,function(a){var b=d(a);a=angular.extend(a,{message:b})})});else if(angular.isDefined(a.community))h.get_community_details(a.community.id).then(function(b){b=b[0].most_important_tag[0],a.community=angular.extend(a.community,b),angular.forEach(a.community.books,function(a){var b=Math.floor(Math.random()*e.value.length),c=e.value[b];a.color=c});var f=d(a);c=angular.extend(a,{message:f})});else{var b=d(a),c=angular.extend(a,{message:b});a.data=[c]}})),a.info.loading=!1})}},a.write_reading_journey=function(){a.info.show_share=!0,a.info.show_book_share=!0},a.search_book=function(){},a.follow_user=function(){a.profile_user.status=!a.profile_user.status,b.follow(a.profile_user.id,a.profile_user.status)},a.show_book_dialog=function(a,b){c.active_book=a,c.active_book.show_info_only=!0,i.show({templateUrl:"/assets/angular/html/community/book.html",targetEvent:b}),b.stopPropagation()};!function(){a.profile_user={};var b=/[?&]([^=#]+)=([^&#]*)/g,d=b.exec(f.absUrl());angular.isDefined(d)&&null!=d?(a.active_user_id=d[2],a.info.my_profile=angular.isDefined(c.user)&&c.user.id==a.active_user_id?!0:!1):(a.info.my_profile=!0,a.profile_user=c.user,a.active_user_id=a.profile_user.id),j(),a.get_feed()}()}]);;homeApp.controller("specificBookController",["$scope","$rootScope","$timeout","bookService","$mdToast","$location","$mdBottomSheet","ColorConstants",function(a,b,c,d,e,f,g,h){a.toggle_endorse=function(){a.book.endorse_status=a.book.endorse_status?!1:!0,d.endorse_book(b.active_book.book_id,a.book.endorse_status),e.show({controller:"toastController",templateUrl:"assets/angular/html/shared/toast/endorse_action.html",hideDelay:6e3,position:a.getToastPosition()})},a.show_shelf_bottom_sheet=function(a,c){b.bookmark_object={type:c,id:a},g.show({templateUrl:"assets/angular/html/shared/shelf_bottom_sheet.html",controller:"shelfController"})},a.getToastPosition=function(){return Object.keys(a.toast_position).filter(function(b){return a.toast_position[b]}).join(" ")},a.rate_book=function(a){d.rate_book(a.book_id,a.user_rating)};var i=function(){var c=/[?&]([^=#]+)=([^&#]*)/g,e=c.exec(f.absUrl());if(null!=e)var g=e[2];if(angular.isDefined(b.active_book))if(angular.isDefined(b.active_book.id))var i=b.active_book.id;else var i=b.active_book.book_id;else var i=g;var j="id="+i;a.book_loading=!0,d.get_book_details(j).then(function(c){var d=null!=c.endorse_status,e=null!=c.status,f=Math.floor(Math.random()*h.value.length),g={endorse_status:d,status:e,color:h.value[f]};a.book=angular.isDefined(b.active_book)?angular.extend(b.active_book,c):c,a.book=angular.extend(a.book,g),b.active_book=a.book,a.book_loading=!1}),d.update_visited(i),a.toast_position={bottom:!1,top:!0,left:!1,right:!0},a.constant={show_book:!0}};i()}]);