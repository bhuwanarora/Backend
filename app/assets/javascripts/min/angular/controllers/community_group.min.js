homeApp.controller("specificBookController",["$scope","$rootScope","$timeout","bookService","$mdToast","$location","$mdBottomSheet","ColorConstants",function(a,b,c,d,e,f,g,h){a.toggle_endorse=function(){a.book.endorse_status=a.book.endorse_status?!1:!0,d.endorse_book(b.active_book.book_id,a.book.endorse_status),e.show({controller:"toastController",templateUrl:"assets/angular/html/shared/toast/endorse_action.html",hideDelay:6e3,position:a.getToastPosition()})},a.show_shelf_bottom_sheet=function(a,c){b.bookmark_object={type:c,id:a},g.show({templateUrl:"assets/angular/html/shared/shelf_bottom_sheet.html",controller:"shelfController"})},a.getToastPosition=function(){return Object.keys(a.toast_position).filter(function(b){return a.toast_position[b]}).join(" ")},a.rate_book=function(a){d.rate_book(a.book_id,a.user_rating)},a.load_sample_read=function(){};var i=function(){var c=/[?&]([^=#]+)=([^&#]*)/g,e=c.exec(f.absUrl());if(null!=e)var g=e[2];if(angular.isDefined(b.active_book))if(angular.isDefined(b.active_book.id))var i=b.active_book.id;else var i=b.active_book.book_id;else var i=g;var j="id="+i;a.book_loading=!0,d.get_book_details(j).then(function(c){var d=null!=c.endorse_status,e=null!=c.status,f=Math.floor(Math.random()*h.value.length),g={endorse_status:d,status:e,color:h.value[f]};a.book=angular.isDefined(b.active_book)?angular.extend(b.active_book,c):c,a.book=angular.extend(a.book,g),b.active_book=a.book,a.book_loading=!1}),d.update_visited(i),a.toast_position={bottom:!1,top:!0,left:!1,right:!0},a.constant={show_book:!0}};i()}]);;homeApp.controller("timelineController",["$scope","$rootScope","bookService","$location","userService",function(a,b,c,d,e){a.write_reading_journey_for=function(){a.info.book=b.active_book,a.info.show_share=!0,a.info.show_book_share=!0},a.get_feed=function(){a.book_loading=!0,angular.isUndefined(a.book_feed)&&(a.book_feed=[]);var b=a.book_feed.length,d=function(a){var b="";switch(a.label){case"BookmarkNode":b="Added to "+a.node.key;break;case"Listopia":break;case"CommunityNode":break;case"BlogNode":break;case"StatusNode":b=a.node.wrapper_content;break;case"EndorseNode":b="Endorsed this book.";break;case"RatingNode":b="Gave "+a.node.content+" rating on 10."}return b},f=function(){var b=[],c=function(a,b){var c=!1,d=0;return a.length>0&&angular.forEach(a,function(a,e){angular.isDefined(a.user)&&a.user.id==b&&(c=!0,d=e)}),{status:c,index:d}};angular.forEach(a.book_feed,function(a){if(angular.isDefined(a.user)){var d=c(b,a.user.id);d.status?(delete a.user,b[d.index].data.push(a)):(angular.isDefined(a.user)&&(d={user:a.user},delete a.user,a=angular.extend(d,{data:[a]})),this.push(a))}else this.push(a)},b),a.book_feed=b};c.get_feed(a.book_id,b).then(function(b){a.book_feed=b,f(),angular.forEach(a.book_feed,function(a){if(angular.isDefined(a.user))e.get_user_details(a.user.id).then(function(b){a.user=angular.extend(a.user,b),angular.forEach(a.data,function(a){var b=d(a);a=angular.extend(a,{message:b})})});else{var b=d(a),c=angular.extend(a,{message:b});a.data=[c]}}),a.book_loading=!1})};!function(){var c=/[?&]([^=#]+)=([^&#]*)/g,e=c.exec(d.absUrl());if(null!=e)var f=e[2];if(angular.isDefined(f))var g=f;else var g=b.active_book.book_id;a.book_id=g,a.get_feed()}()}]);;homeApp.controller("realVirtualityController",["$scope","$rootScope","bookService",function(a,b,c){a.change_news=function(){};!function(){var d=b.active_book.book_id;a.book_loading=!0,c.get_real_news(d).then(function(b){a.book_loading=!1,a.communities=b,a.active_community=b[0]})}()}]);;homeApp.service("communityService",["$http","$q","$rootScope","WebsiteUIConstants",function(a,b){this.get_news_info=function(c){return _deferred_request("/api/v0/news_info?id="+c,b,a)},this.get_chronological_news=function(c){return _deferred_request("/api/v0/chronological_news?id="+c,b,a)},this.get_community_details=function(c){return _deferred_request("/api/v0/basic_community_info?id="+c,b,a)},this.get_metadata=function(c){return _deferred_request("/api/v0/metadata?url="+c,b,a)},this.get_detailed_community_info=function(c){return _deferred_request("/api/v0/detailed_community_info?id="+c,b,a)},this.follow=function(c,d){return _deferred_request("/api/v0/follow_community?id="+c+"&status="+d,b,a)}}]);;homeApp.controller("communityController",["$scope","$mdSidenav","communityService","$location","$rootScope","$mdDialog","ColorConstants",function(a,b,c,d,e,f,g){a.toggle_details=function(){b("right").toggle()},a.get_detailed_community_info=function(){c.get_detailed_community_info(a.active_tag.id).then(function(b){a.active_tag=angular.extend(a.active_tag,b);var c=a.active_tag.follow_node;angular.isDefined(c)&&null!=c&&(a.active_tag.status=!0)})},a.toggle_follow=function(){a.active_tag.status=!a.active_tag.status,c.follow(a.active_tag.id,a.active_tag.status)},a.show_book_dialog=function(a,b){e.active_book=a,e.active_book.show_info_only=!0,f.show({templateUrl:"/assets/angular/html/community/book.html",targetEvent:b}),b.stopPropagation()},a.refresh_data=function(b){a.active_tag=b,c.get_community_details(a.active_tag.id).then(function(b){a.active_tag=b[0].most_important_tag[0],angular.forEach(a.active_tag.books,function(a){var b=Math.floor(Math.random()*g.value.length),c=g.value[b];a.color=c})}),a.get_detailed_community_info()};!function(){var b=/[?&]([^=#]+)=([^&#]*)/g,f=b.exec(d.absUrl());if(null!=f)var h=f[2];if(angular.isDefined(h))var i=h;else var i=e.active_community.news_id;a.newsTags=[],a.info.active_tag=a.active_tag,a.info.loading=!0,c.get_news_info(i).then(function(b){a.info.loading=!1,b=b[0],a.active_tag=b.most_important_tag[0];var c={name:a.active_tag.name,view_count:a.active_tag.view_count,id:a.active_tag.id,image_url:a.active_tag.image_url};a.newsTags.push(c),b.other_tags.shift(),a.newsTags=a.newsTags.concat(b.other_tags),angular.forEach(a.newsTags,function(a){a.view_count=Math.floor(100*Math.random()+50)}),angular.forEach(a.active_tag.books,function(a){var b=Math.floor(Math.random()*g.value.length),c=g.value[b];a.color=c}),a.get_detailed_community_info()}),c.get_chronological_news(i).then(function(b){a.news=b,angular.forEach(a.news,function(b,c){b.community_info.name==a.active_tag.name&&(a.selectedIndex=c)})})}()}]);