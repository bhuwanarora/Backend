(function(){angular.module("cropme",["ngSanitize"]).directive("cropme",["$window","$timeout","$rootScope",function(a,b,c){var d,e,f,g;return f=100,d=8,e=function(a){return a.destinationHeight?a.ratio?a.error="You can't specify both destinationHeight and ratio, destinationHeight = destinationWidth * ratio":a.ratio=a.destinationHeight/a.destinationWidth:a.ratio&&(a.destinationHeight=a.destinationWidth*a.ratio),a.ratio&&a.height&&a.destinationHeight>a.height&&(a.error="Can't initialize cropme: destinationWidth x ratio needs to be lower than height"),a.destinationWidth>a.width&&(a.error="Can't initialize cropme: destinationWidth x ratio needs to be lower than height"),a.destinationWidth>a.width&&(a.error="Can't initialize cropme: destinationWidth needs to be lower than width"),a.ratio&&!a.height&&(a.height=a.destinationHeight),a.type||(a.type="png")},g=function(a){var b,c;for(c=0,b=0;a;)c+=a.offsetTop,b+=a.offsetLeft,a=a.offsetParent;return{top:c,left:b}},{templateUrl:"/assets/angular/views/getting_started/shared/cropme.html",restrict:"E",scope:{width:"=",maxHeight:"=",destinationWidth:"=",height:"=?",destinationHeight:"=?",iconClass:"=?",ratio:"=?",type:"=?"},link:function(a,h,i){var j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B;return a.dropText="Drop picture here",a.showButton=!0,a.error=null,p=null,r=null,s=null,B=null,q=null,u=h.find("img")[0],k=h.find("canvas")[0],o=k.getContext("2d"),A=function(c,d){return B=a.width/c,s=d*B,a.img_width=a.width,s>a.maxHeight&&(s=a.maxHeight,B=s/d,a.img_width=c*B),a.widthCropZone=Math.round(a.destinationWidth*B),a.heightCropZone=Math.round((a.destinationHeight||f)*B),a.xCropZone=Math.round((a.img_width-a.widthCropZone)/2),a.yCropZone=Math.round((s-a.heightCropZone)/2),b(function(){return q=g(t)})},t=h[0].getElementsByClassName("step-2")[0],e(a),a.width_vh=100*a.destinationWidth/document.documentElement.clientHeight,a.height_vh=100*a.destinationHeight/document.documentElement.clientHeight,j=h.find("input"),j.bind("change",function(){var b;return b=this.files[0],a.$apply(function(){return a.setFiles(b)})}),j.bind("click",function(a){return a.stopPropagation(),j.val("")}),a.browseFiles=function(){return a.error=null,j[0].click()},a.setFiles=function(b){var d;return b.type.match(/^image\//)?(a.dropError="",d=new FileReader,d.onload=function(b){return u.onload=function(){var b,d,e;return e=u.naturalWidth,d=u.naturalHeight,b=[],e<a.width&&(a.error="Please choose an image with minimum size "+a.width+" x "+Math.round(a.destinationHeight)+" px.",b.push("The image you dropped has a width of "+e+",px but the minimum is "+a.width+".")),a.height&&d<a.height&&(a.error="Please choose an image with minimum size "+a.width+" x "+Math.round(a.destinationHeight)+" px.",b.push("The image you dropped has a height of "+d+", but the minimum is "+a.height+".")),a.ratio&&a.destinationHeight>d&&(a.error="Please choose an image with minimum size "+a.width+" x "+Math.round(a.destinationHeight)+" px.",b.push("The image you dropped has a height of "+d+", but the minimum is "+a.destinationHeight+".")),a.$apply(function(){return b.length?a.dropError=b.join("<br/>"):(c.$broadcast("cropme:loaded",e,d),a.showButton=!1,A(e,d))})},a.$apply(function(){return a.imgSrc=b.target.result})},d.readAsDataURL(b)):(a.error="Wrong file type, please select an image.",a.dropError="Wrong file type, please select an image.")},x=function(b){return a.xCropZone=b.clientX-q.left-a.widthCropZone/2,a.yCropZone=b.clientY-q.top-a.heightCropZone/2,l()},w={top:function(b){var c;return c=b.clientY-q.top,a.heightCropZone+=a.yCropZone-c,a.yCropZone=c,n(),l()},right:function(b){var c;return c=b.clientX-q.left,a.widthCropZone=c-a.xCropZone,m(),l()},bottom:function(b){var c;return c=b.clientY-q.top,a.heightCropZone=c-a.yCropZone,n(),l()},left:function(b){var c;return c=b.clientX-q.left,a.widthCropZone+=a.xCropZone-c,a.xCropZone=c,m(),l()}},m=function(){return a.ratio?a.heightCropZone=a.widthCropZone*a.ratio:void 0},n=function(){return a.ratio?a.widthCropZone=a.heightCropZone/a.ratio:void 0},l=function(){return a.xCropZone<0&&(a.xCropZone=0),a.yCropZone<0&&(a.yCropZone=0),a.widthCropZone<a.destinationWidth*B?(a.widthCropZone=a.destinationWidth*B,m()):a.destinationHeight&&a.heightCropZone<a.destinationHeight*B&&(a.heightCropZone=a.destinationHeight*B,n()),a.xCropZone+a.widthCropZone>a.img_width&&(a.xCropZone=a.img_width-a.widthCropZone,a.xCropZone<0&&(a.widthCropZone=a.img_width,a.xCropZone=0,m())),a.yCropZone+a.heightCropZone>s&&(a.yCropZone=s-a.heightCropZone,a.yCropZone<0)?(a.heightCropZone=s,a.yCropZone=0,n()):void 0},v=function(b){var c,d,e,f,g,h,i,j;return i=a.xCropZone+q.left,j=a.yCropZone+q.top,h=a.widthCropZone,e=a.heightCropZone,f={x:i,y:j},g={x:i+h,y:j},c={x:i,y:j+e},d={x:i+h,y:j+e},y(b,i,h,j,"top")||z(b,j,e,i+h,"right")||y(b,i,h,j+e,"bottom")||z(b,j,e,i,"left")},y=function(a,b,c,e,f){return a.clientX>=b&&a.clientX<=b+c&&Math.abs(a.clientY-e)<=d?f:void 0},z=function(a,b,c,e,f){return a.clientY>=b&&a.clientY<=b+c&&Math.abs(a.clientX-e)<=d?f:void 0},a.mousedown=function(a){return r=v(a),(p=r?w[r]:x)(a)},a.mouseup=function(a){return p&&p(a),p=null},a.mousemove=function(b){return p&&p(b),a.colResizePointer=v(b)},a.deselect=function(){return p=null},a.cancel=function(){return a.dropText="Drop files here",a.dropClass="",a.showButton=!0},a.ok=function(){return a.croppedWidth=a.widthCropZone/B,a.croppedHeight=a.heightCropZone/B,a.set=!0,b(function(){var b;b=a.destinationHeight||a.destinationWidth*a.croppedHeight/a.croppedWidth,o.drawImage(u,a.xCropZone/B,a.yCropZone/B,a.croppedWidth,a.croppedHeight,0,0,a.destinationWidth,a.destinationHeight);var d=k.toDataURL();return k.toBlob(function(b){return c.$broadcast("cropme:done",d)&&(a.showButton=!0)},"image/"+a.type)})},a.$on("cropme:cancel",a.cancel),a.$on("cropme:ok",a.ok)}}}]),angular.module("cropme").directive("dropbox",function(){return{restrict:"E",link:function(a,b,c){var d,e;return d=function(b){return b.stopPropagation(),b.preventDefault(),a.$apply(function(){return a.dropText="Drop files here",a.dropClass=""})},e=b[0],a.dropText="Drop files here",e.addEventListener("dragenter",d,!1),e.addEventListener("dragleave",d,!1),e.addEventListener("dragover",function(b){var c;return b.stopPropagation(),b.preventDefault(),c=b.dataTransfer&&b.dataTransfer.types&&b.dataTransfer.types.indexOf("Files")>=0,a.$apply(function(){return a.dropText=c?"Drop now":"Only files are allowed",a.dropClass=c?"over":"not-available"})},!1),e.addEventListener("drop",function(b){var c;return b.stopPropagation(),b.preventDefault(),a.$apply(function(){return a.dropText="Drop files here",a.dropClass=""}),c=b.dataTransfer.files,a.$apply(function(){var b,d,e;if(c.length>0)for(d=0,e=c.length;e>d;d++){if(b=c[d],b.type.match(/^image\//))return a.dropText="Loading image...",a.dropClass="loading",a.setFiles(b);a.dropError="Wrong file type, please drop at least an image."}})},!1)}}}),function(a){"use strict";var b,c,d,e,f;return c=a.Uint8Array,b=a.HTMLCanvasElement,f=/\s*;\s*base64\s*(?:;|$)/i,d=void 0,e=function(a){var b,e,f,g,h,i,j,k,l,m;for(h=a.length,b=new c(h/4*3|0),f=0,i=0,g=[0,0],l=0,k=0,j=void 0,e=void 0,m=void 0;h--;)e=a.charCodeAt(f++),j=d[e-43],255!==j&&j!==m&&(g[1]=g[0],g[0]=e,k=k<<6|j,l++,4===l&&(b[i++]=k>>>16,61!==g[1]&&(b[i++]=k>>>8),61!==g[0]&&(b[i++]=k),l=0));return b},c&&(d=new c([62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51])),b&&!b.prototype.toBlob?b.prototype.toBlob=function(a,b){var d,g,h,i,j,k;return b||(b="image/png"),this.mozGetAsFile?void a(this.mozGetAsFile("canvas",b)):(d=Array.prototype.slice.call(arguments,1),i=this.toDataURL.apply(this,d),j=i.indexOf(","),h=i.substring(j+1),k=f.test(i.substring(0,j)),g=void 0,Blob.fake?(g=new Blob,k?g.encoding="base64":g.encoding="URI",g.data=h,g.size=h.length):c&&(g=k?new Blob([e(h)],{type:b}):new Blob([decodeURIComponent(h)],{type:b})),a(g))}:void 0}(self)}).call(this);