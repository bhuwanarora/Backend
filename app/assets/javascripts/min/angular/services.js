websiteApp.service("recommendationService",["$http","$q","$rootScope","WebsiteUIConstants",function(a,b,c,d){var e=function(e){var f=b.defer(),g=function(a){return f.resolve(a.data)},h=function(a){c.user.loading=!1,500==a.status&&alert(d.ServerError)};return a.get(e).then(g,h),f.promise};this.get_recommendations=function(){var a=angular.toJson(c.filters);return e("/api/v0/recommendations?count=5&id="+c.user.id+"&q="+a)},this.get_random_books=function(){return e("/api/v0/random_books")},this.get_grid_books=function(){return e("/api/v0/grid")},this.get_book_lists=function(){return e("/api/v0/book_lists")},this.push_recommendations=function(){return e("/api/v0/push_recommendations")},this.get_filters=function(){return e("/api/v0/filters")},this.get_genres=function(a){return e("/api/v0/genres?"+a)},this.get_countries=function(a){return e("/api/v0/countries?"+a)},this.get_time_groups=function(){return e("/api/v0/times")},this.get_read_times=function(){return e("/api/v0/read_times")},this.get_labels=function(a){return e(angular.isDefined(a)?"/api/v0/labels?id="+a:"/api/v0/labels")}}]);;websiteApp.service("sharedService",["$timeout","$rootScope","widgetService","websiteService","stropheService","$location","RecommendationUIConstants","$cookieStore","recommendationService",function(a,b,c,d,e,f,g,h,i){this.is_logged_in=function(){d.get_user().then(function(a){a.logged_in&&(b.user.logged=!0,b.user.id=a.id,d.get_user_details().then(function(a){angular.extend(b.user,a)}))})},this.get_books_bookmarked=function(c){var e=0;d.get_books_bookmarked(e).then(function(d){if(angular.isArray(d)){b.user.books={},b.user.books.bookmarked=[];var e=500;angular.forEach(d,function(d){var f=[];angular.forEach(b.labels,function(a){if(d[2].indexOf(a.name)>=0)var b={name:a.name,checked:!0};else var b={name:a.name,checked:!1};f.push(b)},f);var g={isbn:d[0],id:d[1],bookmark_status:!0,labels:f};e+=500;var h=a(function(){b.user.books.bookmarked.push(g)},e);c.$on("destroy",function(){a.cancel(h)})})}})},this.get_news_feed=function(a){if(a.show_feed={news:!0},angular.isDefined(a.news_feed))var b=a.news_feed.length;else{a.news_feed=[];var b=0}d.get_notifications(b).then(function(b){angular.isUndefined(a.news_feed)&&(a.news_feed=[]),a.news_feed=b.notifications.concat(a.news_feed)})},this.set_friends=function(){var a=angular.isDefined(b.user.friends)?b.user.friends.length:0,d=12;if(angular.isUndefined(b.user.friends)||!b.user.all_friends_shown){var e=function(a,b){angular.forEach(b,function(a){thumb=null==a[2]?"/assets/profile_pic.jpeg":a[2];var b={id:a[0],name:a[1],thumb:thumb,init_book_read_count:a[3],total_count:a[4],book_read_count:a[5],bookmark_count:a[6],fav_categories:a[7]};this.push(b)},a)};c.get_friends(b.user.id,d,a).then(function(a){d>a.length&&(b.user.all_friends_shown=!0),angular.isUndefined(b.user.friends)&&(b.user.friends=[]),e(b.user.friends,a)})}},this.set_labels=function(a){(angular.isUndefined(a)||null==a)&&(a=b.user.id),i.get_labels(a).then(function(a){b.labels=[],angular.isArray(a)&&a.length>0&&angular.forEach(a,function(a){null!=a[0]&&this.push({name:a[0].replace('"',""),id:a[1]})},b.labels)})},this.get_trends=function(){if(angular.isUndefined(b.trending_feed)){b.trending_feed=[];var a=0}else var a=b.trending_feed.length;d.get_trending_topics(a).then(function(a){angular.forEach(a,function(a){var b={name:a[0],id:a[1],message:a[2],url:a[3],title:a[4],thumb:a[7],large_image:a[5],keywords:a[8],timestamp:a[9],book_isbns:a[10]};this.splice(0,0,b)},b.trending_feed)})},this.get_user=function(a){d.get_user_details(a).then(function(a){b.reader=angular.extend(b.reader,a),angular.isDefined(b.reader.gender)&&("Male"==b.reader.gender?(b.reader.gender_prefix="His",b.reader.gender_suffix="him"):(b.reader.gender_prefix="Her",b.reader.gender_suffix="her"))})},this.logout=function(){d.logout().then(function(){b.user={books:{bookmarked:[],read:[]},authors:{bookmarked:[],follow:[]},readers:{follow:[]},logged:!1},h.remove("logged"),f.path("/search")})},this.bookmark_book=function(d,e,f,h){if(angular.isUndefined(d.book))var i=d.selected_book;else var i=d.book;var j=!1,k=function(){var c=i.labels;if(i.labels[e].checked=!i.labels[e].checked,i.labels[e].checked){var h=b.user.email;angular.isDefined(b.user.name)&&(h=b.user.name);var k="<span>saved&nbsp;</span><span class='site_color'>"+i.title+"</span><span> to '"+i.labels[e].name+"'</span>",l={thumb:b.user.thumb,message:k,timestamp:(new Date).getTime(),book:{id:i.id,title:i.title,author_name:i.author_name,isbn:i.isbn},user:{id:b.user.id,name:h}};b.user.bookmark_count=b.user.bookmark_count+1,d.$emit("gamifyCount",10,!0),d.$emit("addToNotifications",l);var k="SUCCESS-Added to "+i.labels[e].name+" <span class='icon-tags'></span>."}else{b.user.bookmark_count=b.user.bookmark_count-1,d.$emit("gamifyCount",10,!1);var k="SUCCESS-Removed from "+i.labels[e].name+" <span class='icon-tags'></span>."}i.labels[e].name==g.MarkAsRead&&this.mark_as_read(d,i,f);for(var m=(notify(b,k,a),{id:i.id,type:"BOOK",name:i.labels[e].name,data:i.labels[e].checked}),n=0;n<c.length;n++)if(c[n].checked){j=!0;break}return i.bookmark_status=j?1:0,m};if(_influential_book_bookmarked=function(){var c=e;if(c.status){b.user.bookmark_count=b.user.bookmark_count-1,d.$emit("gamifyCount",10,!1);var f="SUCCESS-Removed from "+h+" <span class='icon-tags'></span>."}else{var g=b.user.email;angular.isDefined(b.user.name)&&(g=b.user.name);var f="<span>saved&nbsp;</span><span class='site_color'>"+c.title+"</span><span> to '"+h+"'</span>",i={thumb:b.user.thumb,message:f,timestamp:(new Date).getTime(),book:{id:c.id,title:c.title,author_name:c.author_name,isbn:c.isbn},user:{id:b.user.id,name:g}};b.user.bookmark_count=b.user.bookmark_count+1,d.$emit("gamifyCount",10,!0),d.$emit("addToNotifications",i);var f="SUCCESS-Added to "+h+" <span class='icon-tags'></span>."}var j=(notify(b,f,a),{id:c.id,type:"BOOK",name:h,data:!c.status});return j},angular.isUndefined(h))var l=k();else var l=_influential_book_bookmarked();c.bookmark(l),d.$on("destroy",function(){a.cancel(timeout_event)})},this.mark_as_read=function(d,e,f){var g=e.title,h=e.author_name,i=function(){if(b.user.name)var a=b.user.name;else var a=b.user.email;var c="<span> added </span><span class='site_color'>"+g+"</span>&nbsp;to&nbsp;<span class='icon-books'></span><span>&nbsp;books read.</span>",f={thumb:b.user.thumb,message:c,timestamp:(new Date).getTime(),book:{id:e.id,title:g,author_name:h,isbn:e.isbn},user:{id:b.user.id,name:a}};return b.$broadcast("gamifyCount",5,!0),b.user.book_read_count=b.user.book_read_count+1,d.$emit("addToNotifications",f),e.status=!0,b.user.books.read.push(e),c="SUCCESS-Added to <span class='icon-books'></span> Books Read. "},j=function(){e.status=!1;var a=b.user.books.read.indexOf(e);b.user.books.read.splice(a,1);var c="SUCCESS-Removed from <span class='icon-books'></span> Books Read. ";b.user.book_read_count=b.user.book_read_count-1;var d=5,f=angular.isDefined(e.user_rating)&&null!=e.user_rating,g=angular.isDefined(e.time_index)&&null!=e.time_index;return f&&(delete e.user_rating,d+=10),g&&(delete e.time_index,d+=10),b.$broadcast("gamifyCount",d,!1),c};if(e.status)var k=j();else var k=i();c.mark_as_read(e.id,e.status);var l=notify(b,k,a);d.$on("destroy",function(){a.cancel(l)}),f.stopPropagation()}}]);;websiteApp.factory("appSocket",["socketFactory",function(a){var b=a();return b.forward("error"),b}]);;websiteApp.service("stropheService",["$rootScope",function(){}]);;app.service("websiteService",["$http","$q","$rootScope","WebsiteUIConstants",function(a,b,c,d){var e=function(c){var e=b.defer(),f=function(a){return e.resolve(a.data)},g=function(a){500==a.status&&alert(d.ServerError)};return a.get(c).then(f,g),e.promise},f=function(c,e){var f=b.defer(),g=function(a){return f.resolve(a.data)},h=function(a){if(500==a.status)alert(d.ServerError);else if(403==a.status)return f.reject(a)};return a.post(c,e).then(g,h),f.promise};this.recover_password=function(a){return e("/api/v0/recover_password?"+a)},this.fb_books_map=function(a){return e("/api/v0/fb_books_map?id="+a)},this.handle_facebook_books=function(a){return f("/api/v0/fb_books",a)},this.get_user=function(){return e("/api/v0/user")},this.logout=function(){return e("/api/v0/logout")},this.save_user_info=function(a){return f("/api/v0/save_info",a)},this.handle_facebook_user=function(a){return f("/api/v0/fb",a)},this.handle_google_user=function(a){return f("/api/v0/google",a)},this.authenticate=function(a){return f("/api/v0/authenticate",a)},this.get_user_details=function(a){return e(angular.isDefined(a)?"/api/v0/user_details?id="+a:"/api/v0/user_details")},this.get_personal_notifications=function(){return e("/api/v0/personal_notifications")}}]);;websiteApp.service("widgetService",["$http","$q","$rootScope","WebsiteUIConstants",function(a,b,c,d){var e=function(c){var e=b.defer(),f=function(a){return e.resolve(a.data)},g=function(a){500==a.status&&alert(d.ServerError)};return a.get(c).then(f,g),e.promise},f=function(c,e){var f=b.defer(),g=function(a){return f.resolve(a.data)},h=function(a){500==a.status&&alert(d.ServerError)};return a.post(c,e).then(g,h),f.promise};this.get_book_feed=function(a){return e("/api/v0/book_feed?id="+a)},this.save_genre=function(a){return f("/api/v0/save_genre",a)},this.populate_tooltips=function(a){return e("/api/v0/tooltip?id="+a)},this.mark_as_read=function(a,b){return f("/api/v0/mar",{book_id:a,data:b})},this.recommend=function(a){return f("/api/v0/recommend",a)},this.bookmark=function(a){return f("/api/v0/bookmark",a)},this.comment=function(a){return f("/api/v0/comment",a)},this.what_do_you_feel=function(a,b,c){return f("/api/v0/wdyf",{id:a,type:b,data:c})},this.record_time=function(a,b){return f("/api/v0/time",{id:a,data:b})},this.rate_this_book=function(a){return f("/api/v0/rate",a)},this.own_this_book=function(a,b){return f("/api/v0/own",{book_id:a,data:b})},this.like=function(a,b){return f("/api/v0/like",{id:a,type:b})},this.dislike=function(a,b){return f("/api/v0/dislike",{id:a,type:b})},this.post_a_review=function(a,b){return f("/api/v0/post_review",{book_id:id,data:b})},this.follow=function(a){return f("/api/v0/follow",a)},this.get_moments=function(){return e("/api/v0/moments?id=1")},this.get_friends=function(a,b,c){return e("/api/v0/friends?id="+a+"&count="+b+"&skip="+c)},this.get_labels=function(){return e("/api/v0/labels")},this.get_affiliate_links=function(a){return e("/api/v0/affiliate_links?id="+a)},this.add_thumbnail=function(a){return f("/api/v0/add_thumbnail",a)},this.get_author_details=function(a){return e("/api/v0/author_details?book_id="+a)}}]);