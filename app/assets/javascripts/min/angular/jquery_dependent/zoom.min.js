!function(a){function b(a,c){return a[0]==c[0]?!1:a.attr("page")?!0:a.parent()[0]?b(a.parent(),c):!1}function c(a){function b(a){this.name="TurnJsError",this.message=a}return b.prototype=Error(),b.prototype.constructor=b,new b(a)}function d(a,b,c){return h&&c?" translate3d("+a+"px,"+b+"px, 0px) ":" translate("+a+"px, "+b+"px) "}function e(a,b){return h&&b?" scale3d("+a+", "+a+", 1) ":" scale("+a+") "}function f(a,b){return{x:a,y:b}}function g(a,b){return function(){return a.apply(b,arguments)}}var h,i={max:2,flipbook:null,easeFunction:"ease-in-out",duration:500,when:{}},j={init:function(b){var d=this,e=this.data(),b=a.extend({},i,b);if(!b.flipbook||!b.flipbook.turn("is"))throw c("options.flipbook is required");if(h="WebKitCSSMatrix"in window||"MozPerspective"in document.body.style,"function"!=typeof b.max){var k=b.max;b.max=function(){return k}}e.zoom={opts:b,axis:f(0,0),scrollPos:f(0,0),eventQueue:[],mouseupEvent:function(){return j._eMouseUp.apply(d,arguments)},eventTouchStart:g(j._eTouchStart,d),eventTouchMove:g(j._eTouchMove,d),eventTouchEnd:g(j._eTouchEnd,d),flipbookEvents:{zooming:g(j._eZoom,d),pressed:g(j._ePressed,d),released:g(j._eReleased,d),start:g(j._eStart,d),turning:g(j._eTurning,d),turned:g(j._eTurned,d),destroying:g(j._eDestroying,d)}};for(var l in b.when)Object.prototype.hasOwnProperty.call(b.when,l)&&this.bind("zoom."+l,b.when[l]);for(l in e.zoom.flipbookEvents)Object.prototype.hasOwnProperty.call(e.zoom.flipbookEvents,l)&&b.flipbook.bind(l,e.zoom.flipbookEvents[l]);this.css({position:"relative",overflow:"hidden"}),a.isTouch?(b.flipbook.bind("touchstart",e.zoom.eventTouchStart).bind("touchmove",e.zoom.eventTouchMove).bind("touchend",e.zoom.eventTouchEnd),this.bind("touchstart",j._tap)):this.mousedown(j._mousedown).click(j._tap)},_tap:function(c){var d=a(this),e=d.data().zoom;!e.draggingCorner&&!e.dragging&&b(a(c.target),d)&&(j._addEvent.call(d,"tap",c),(c=j._eventSeq.call(d))&&d.trigger(c))},_addEvent:function(a,b){var c=this.data().zoom,d=(new Date).getTime();c.eventQueue.push({name:a,timestamp:d,event:b}),10<c.eventQueue.length&&c.eventQueue.splice(0,1)},_eventSeq:function(){var b=this.data().zoom.eventQueue,c=b.length-1;return c>0&&"tap"==b[c].name&&"tap"==b[c-1].name&&b[c].event.pageX==b[c-1].event.pageX&&b[c].event.pageY==b[c-1].event.pageY&&200>b[c].timestamp-b[c-1].timestamp&&50<b[c].timestamp-b[c-1].timestamp?a.extend(b[c].event,{type:"zoom.doubleTap"}):"tap"==b[c].name?a.extend(b[c].event,{type:"zoom.tap"}):void 0},_prepareZoom:function(){var b,c=0,d=this.data().zoom,e=1/this.zoom("value");b=d.opts.flipbook;var g=b.turn("direction"),h=b.data(),i=b.offset(),j=this.offset(),k={height:b.height()},l=b.turn("view");if("double"==b.turn("display")&&b.data().opts.autoCenter?l[0]?l[1]?(k.width=b.width(),b=f(i.left-j.left,i.top-j.top)):(k.width=b.width()/2,c="ltr"==g?0:k.width,b=f("ltr"==g?i.left-j.left:i.left-j.left+k.width,i.top-j.top)):(k.width=b.width()/2,c="ltr"==g?k.width:0,b=f("ltr"==g?i.left-j.left+k.width:i.left-j.left,i.top-j.top)):(k.width=b.width(),b=f(i.left-j.left,i.top-j.top)),d.zoomer||(d.zoomer=a("<div />",{"class":"zoomer",css:{overflow:"hidden",position:"absolute",zIndex:"1000000"}}).mousedown(function(){return!1}).appendTo(this)),d.zoomer.css({top:b.y,left:b.x,width:k.width,height:k.height}),g=l.join(","),g!=d.zoomerView)for(d.zoomerView=g,d.zoomer.find("*").remove(),g=0;g<l.length;g++)if(l[g]){var j=h.pageObjs[l[g]].offset(),m=a(h.pageObjs[l[g]]);m.clone().transform("").css({width:m.width()*e,height:m.height()*e,position:"absolute",display:"",top:(j.top-i.top)*e,left:(j.left-i.left-c)*e}).appendTo(d.zoomer)}return{pos:b,size:k}},value:function(){return this.data().zoom.opts.flipbook.turn("zoom")},zoomIn:function(b){var c=this,g=this.data().zoom,h=g.opts.flipbook,i=g.opts.max();h.offset();var k=this.offset();if(g.zoomIn)return this;h.turn("stop");var l=a.Event("zoom.change");if(this.trigger(l,[i]),l.isDefaultPrevented())return this;var m=j._prepareZoom.call(this),n=m.pos,o=f(m.size.width/2,m.size.height/2),l=a.cssPrefix(),p=a.cssTransitionEnd(),q=h.data().opts.autoCenter;g.scale=i,h.data().noCenter=!0,b="undefined"!=typeof b?"x"in b&&"y"in b?f(b.x-n.x,b.y-n.y):a.isTouch?f(b.originalEvent.touches[0].pageX-n.x-k.left,b.originalEvent.touches[0].pageY-n.y-k.top):f(b.pageX-n.x-k.left,b.pageY-n.y-k.top):f(o.x,o.y),(0>b.x||0>b.y||b.x>m.width||b.y>m.height)&&(b.x=o.x,b.y=o.y);var r=f((b.x-o.x)*i+o.x,(b.y-o.y)*i+o.y),b=f(m.size.width*i>this.width()?b.x-r.x:0,m.size.height*i>this.height()?b.y-r.y:0),r=f(Math.abs(m.size.width*i-this.width()),Math.abs(m.size.height*i-this.height())),m=f(Math.min(0,m.size.width*i-this.width()),Math.min(0,m.size.height*i-this.height())),s=f(o.x*i-o.x-n.x-b.x,o.y*i-o.y-n.y-b.y);s.y>r.y?b.y=s.y-r.y+b.y:s.y<m.y&&(b.y=s.y-m.y+b.y),s.x>r.x?b.x=s.x-r.x+b.x:s.x<m.x&&(b.x=s.x-m.x+b.x),s=f(o.x*i-o.x-n.x-b.x,o.y*i-o.y-n.y-b.y),n={},n[l+"transition"]=l+"transform "+g.opts.easeFunction+" "+g.opts.duration+"ms";var t=function(){c.trigger("zoom.zoomIn"),g.zoomIn=!0,g.flipPosition=f(h.css("left"),h.css("top")),h.turn("zoom",i).css({position:"absolute",margin:"",top:0,left:0});var b=h.offset();g.axis=f(b.left-k.left,b.top-k.top),q&&"double"==h.turn("display")&&("ltr"==h.turn("direction")&&!h.turn("view")[0]||"rtl"==h.turn("direction")&&!h.turn("view")[1])&&(g.axis.x=g.axis.x+h.width()/2),c.zoom("scroll",s),c.bind(a.mouseEvents.down,j._eMouseDown),c.bind(a.mouseEvents.move,j._eMouseMove),a(document).bind(a.mouseEvents.up,g.mouseupEvent),c.bind("mousewheel",j._eMouseWheel),setTimeout(function(){g.zoomer.hide(),g.zoomer.remove(),g.zoomer=null,g.zoomerView=null},50)};return g.zoomer.css(n).show(),p?g.zoomer.bind(p,function(){a(this).unbind(p),t()}):setTimeout(t,g.opts.duration),g.zoomer.transform(d(b.x,b.y,!0)+e(i,!0)),this},zoomOut:function(b){var c,g=this,h=this.data().zoom,i=h.opts.flipbook,k=1/h.scale,l=a.cssPrefix(),m=a.cssTransitionEnd();if(c=this.offset(),b="undefined"!=typeof b?b:h.opts.duration,h.zoomIn){var n=a.Event("zoom.change");if(this.trigger(n,[1]),n.isDefaultPrevented())return this;h.zoomIn=!1,h.scale=1,i.data().noCenter=!1,g.unbind(a.mouseEvents.down,j._eMouseDown),g.unbind(a.mouseEvents.move,j._eMouseMove),a(document).unbind(a.mouseEvents.up,h.mouseupEvent),g.unbind("mousewheel",j._eMouseWheel),n={},n[l+"transition"]=l+"transform "+h.opts.easeFunction+" "+b+"ms",i.css(n);var o=a("<div />",{css:{position:"relative",top:h.flipPosition.y,left:h.flipPosition.x,width:i.width()*k,height:i.height()*k,background:"blue"}}).appendTo(i.parent()),n=f(o.offset().left-c.left,o.offset().top-c.top);o.remove();var p=i.data().opts.autoCenter;p&&"double"==i.turn("display")&&(i.turn("view")[0]?i.turn("view")[1]||(n.x="ltr"==i.turn("direction")?n.x+o.width()/4:n.x-o.width()/4):n.x="ltr"==i.turn("direction")?n.x-o.width()/4:n.x+o.width()/4);var q=a.findPos(i[0]);c=f(-i.width()/2-q.left+o.width()/2+n.x+c.left,-i.height()/2-q.top+o.height()/2+n.y+c.top);var r=function(){i[0].style.removeProperty?(i[0].style.removeProperty(l+"transition"),i.transform(i.turn("options").acceleration?d(0,0,!0):"").turn("zoom",1),i[0].style.removeProperty("margin"),i.css({position:"relative",top:h.flipPosition.y,left:h.flipPosition.x})):i.transform("none").turn("zoom",1).css({margin:"",top:h.flipPosition.y,left:h.flipPosition.x,position:"relative"}),p&&i.turn("center"),g.trigger("zoom.zoomOut")};return 0===b?r():(m?i.bind(m,function(){a(this).unbind(m),r()}):setTimeout(r,b),i.transform(d(c.x,c.y,!0)+e(k,!0))),this}},flipbookWidth:function(){var a=this.data().zoom.opts.flipbook,b=a.turn("view");return"double"!=a.turn("display")||b[0]&&b[1]?a.width():a.width()/2},scroll:function(b,c,e){var g=this.data().zoom,i=g.opts.flipbook,j=this.zoom("flipbookWidth"),k=a.cssPrefix();if(h){var l={};l[k+"transition"]=e?k+"transform 200ms":"none",i.css(l),i.transform(d(-g.axis.x-b.x,-g.axis.y-b.y,!0))}else i.css({top:-g.axis.y-b.y,left:-g.axis.x-b.x});if(!c){var m,c=f(Math.min(0,(j-this.width())/2),Math.min(0,(i.height()-this.height())/2)),i=f(j>this.width()?j-this.width():(j-this.width())/2,i.height()>this.height()?i.height()-this.height():(i.height()-this.height())/2);b.y<c.y?(b.y=c.y,m=!0):b.y>i.y&&(b.y=i.y,m=!0),b.x<c.x?(b.x=c.x,m=!0):b.x>i.x&&(b.x=i.x,m=!0),m&&this.zoom("scroll",b,!0,!0)}g.scrollPos=f(b.x,b.y)},resize:function(){var a=this.data().zoom,b=a.opts.flipbook;if(1<this.zoom("value")){var c=b.offset(),d=this.offset();a.axis=f(c.left-d.left+(a.axis.x+a.scrollPos.x),c.top-d.top+(a.axis.y+a.scrollPos.y)),"double"==b.turn("display")&&"ltr"==b.turn("direction")&&!b.turn("view")[0]&&(a.axis.x+=b.width()/2),this.zoom("scroll",a.scrollPos)}},_eZoom:function(){for(var a=this.data().zoom,b=a.opts.flipbook,c=b.turn("view"),d=0;d<c.length;d++)c[d]&&this.trigger("zoom.resize",[a.scale,c[d],b.data().pageObjs[c[d]]])},_eStart:function(a){1!=this.zoom("value")&&a.preventDefault()},_eTurning:function(a,b,c){var d=this,a=this.zoom("value"),e=this.data().zoom,b=e.opts.flipbook;if(e.page=b.turn("page"),1!=a){for(e=0;e<c.length;e++)c[e]&&this.trigger("zoom.resize",[a,c[e],b.data().pageObjs[c[e]]]);setTimeout(function(){d.zoom("resize")},0)}},_eTurned:function(a,b){if(1!=this.zoom("value")){var c=this.data().zoom,d=c.opts.flipbook;b>c.page?this.zoom("scroll",f(0,c.scrollPos.y),!1,!0):b<c.page&&this.zoom("scroll",f(d.width(),c.scrollPos.y),!1,!0)}},_ePressed:function(){a(this).data().zoom.draggingCorner=!0},_eReleased:function(){var b=a(this).data().zoom;setTimeout(function(){b.draggingCorner=!1},1)},_eMouseDown:function(b){return a(this).data().zoom.draggingCur=a.isTouch?f(b.originalEvent.touches[0].pageX,b.originalEvent.touches[0].pageY):f(b.pageX,b.pageY),!1},_eMouseMove:function(b){var c=a(this).data().zoom;if(c.draggingCur){c.dragging=!0;var b=a.isTouch?f(b.originalEvent.touches[0].pageX,b.originalEvent.touches[0].pageY):f(b.pageX,b.pageY),d=f(b.x-c.draggingCur.x,b.y-c.draggingCur.y);return a(this).zoom("scroll",f(c.scrollPos.x-d.x,c.scrollPos.y-d.y),!0),c.draggingCur=b,!1}},_eMouseUp:function(){var b=a(this).data().zoom;b.dragging&&a(this).zoom("scroll",b.scrollPos),b.draggingCur=null,setTimeout(function(){b.dragging=!1},1)},_eMouseWheel:function(b,c,d,e){b=a(this).data().zoom,d=f(b.scrollPos.x+10*d,b.scrollPos.y-10*e),a(this).zoom("scroll",d,!1,!0)},_eTouchStart:function(b){var c=a(this).data().zoom,b=f(b.originalEvent.touches[0].pageX,b.originalEvent.touches[0].pageY);c.touch={},c.touch.initial=b,c.touch.last=b,c.touch.timestamp=(new Date).getTime(),c.touch.speed=f(0,0)},_eTouchMove:function(b){var c=a(this).data().zoom,d=a(this).zoom("value"),e=c.opts.flipbook,g=(new Date).getTime(),b=f(b.originalEvent.touches[0].pageX,b.originalEvent.touches[0].pageY);c.touch&&1==d&&!e.data().mouseAction&&(c.touch.motion=f(b.x-c.touch.last.x,b.y-c.touch.last.y),c.touch.speed.x=0===c.touch.speed.x?c.touch.motion.x/(g-c.touch.timestamp):(c.touch.speed.x+c.touch.motion.x/(g-c.touch.timestamp))/2,c.touch.last=b,c.touch.timestamp=g)},_eTouchEnd:function(){var b=a(this).data().zoom;if(b.touch&&1==a(this).zoom("value")){var c=Math.abs(b.touch.initial.y-b.touch.last.y);50>c&&(-1>b.touch.speed.x||-100>b.touch.last.x-b.touch.initial.x)?this.trigger("zoom.swipeLeft"):50>c&&(1<b.touch.speed.x||100<b.touch.last.x-b.touch.initial.x)&&this.trigger("zoom.swipeRight")}},_eDestroying:function(){var b=this,c=this.data().zoom,d=c.opts.flipbook;this.zoom("zoomOut",0),a.each("tap doubleTap resize zoomIn zoomOut swipeLeft swipeRight".split(" "),function(a,c){b.unbind("zoom."+c)});for(var e in c.flipbookEvents)Object.prototype.hasOwnProperty.call(c.flipbookEvents,e)&&d.unbind(e,c.flipbookEvents[e]);d.unbind("touchstart",c.eventTouchStart).unbind("touchmove",c.eventTouchMove).unbind("touchend",c.eventTouchEnd),this.unbind("touchstart",j._tap).unbind("click",j._tap),c=null,this.data().zoom=null}};a.extend(a.fn,{zoom:function(){var b=arguments;if(!b[0]||"object"==typeof b[0])return j.init.apply(a(this[0]),b);if(j[b[0]])return j[b[0]].apply(a(this[0]),Array.prototype.slice.call(b,1));throw c(b[0]+" is not a method")}})}(jQuery);