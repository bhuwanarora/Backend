!function(a){a.fn.jqte=function(b){function c(a,b,c,d,e){var f=k.length+1;return k.push({name:a,cls:f,command:b,key:c,tag:d,emphasis:e})}var d=[{title:"Text Format"},{title:"Font Size"},{title:"Color"},{title:"Bold",hotkey:"B"},{title:"Italic",hotkey:"I"},{title:"Underline",hotkey:"U"},{title:"Ordered List",hotkey:"."},{title:"Unordered List",hotkey:","},{title:"Subscript",hotkey:"down arrow"},{title:"Superscript",hotkey:"up arrow"},{title:"Outdent",hotkey:"left arrow"},{title:"Indent",hotkey:"right arrow"},{title:"Justify Left"},{title:"Justify Center"},{title:"Justify Right"},{title:"Strike Through",hotkey:"K"},{title:"Add Link",hotkey:"L"},{title:"Remove Link"},{title:"Cleaner Style",hotkey:"Delete"},{title:"Horizontal Rule",hotkey:"H"},{title:"Source"}],e=[["p","Normal"],["h1","Header 1"],["h2","Header 2"],["h3","Header 3"],["h4","Header 4"],["h5","Header 5"],["h6","Header 6"],["pre","Preformatted"]],f=["10","12","16","18","20","24","28"],g=["0,0,0","68,68,68","102,102,102","153,153,153","204,204,204","238,238,238","243,243,243","255,255,255",null,"255,0,0","255,153,0","255,255,0","0,255,0","0,255,255","0,0,255","153,0,255","255,0,255",null,"244,204,204","252,229,205","255,242,204","217,234,211","208,224,227","207,226,243","217,210,233","234,209,220","234,153,153","249,203,156","255,229,153","182,215,168","162,196,201","159,197,232","180,167,214","213,166,189","224,102,102","246,178,107","255,217,102","147,196,125","118,165,175","111,168,220","142,124,195","194,123,160","204,0,0","230,145,56","241,194,50","106,168,79","69,129,142","61,133,198","103,78,167","166,77,121","153,0,0","180,95,6","191,144,0","56,118,29","19,79,92","11,83,148","53,28,117","116,27,71","102,0,0","120,63,4","127,96,0","39,78,19","12,52,61","7,55,99","32,18,77","76,17,48"],h=["Web Address","E-mail Address","Picture URL"],i=a.extend({status:!0,css:"jqte",title:!0,titletext:d,button:"OK",format:!0,formats:e,fsize:!0,fsizes:f,funit:"px",color:!0,linktypes:h,b:!0,i:!0,u:!0,ol:!0,ul:!0,sub:!0,sup:!0,outdent:!0,indent:!0,left:!0,center:!0,right:!0,strike:!0,link:!0,unlink:!0,remove:!0,rule:!0,source:!0,placeholder:!1,br:!0,p:!0,change:"",focus:"",blur:""},b);a.fn.jqteVal=function(b){a(this).closest("."+i.css).find("."+i.css+"_editor").html(b)};var j=navigator.userAgent.toLowerCase();/msie [1-7]./.test(j)&&(i.title=!1);var k=[];return c("format","formats","","",!1),c("fsize","fSize","","",!1),c("color","colors","","",!1),c("b","Bold","B",["b","strong"],!0),c("i","Italic","I",["i","em"],!0),c("u","Underline","U",["u"],!0),c("ol","insertorderedlist","¾",["ol"],!0),c("ul","insertunorderedlist","¼",["ul"],!0),c("sub","subscript","(",["sub"],!0),c("sup","superscript","&",["sup"],!0),c("outdent","outdent","%",["blockquote"],!1),c("indent","indent","'",["blockquote"],!0),c("left","justifyLeft","","",!1),c("center","justifyCenter","","",!1),c("right","justifyRight","","",!1),c("strike","strikeThrough","K",["strike"],!0),c("link","linkcreator","L",["a"],!0),c("unlink","unlink","",["a"],!1),c("remove","removeformat",".","",!1),c("rule","inserthorizontalrule","H",["hr"],!1),c("source","displaysource","","",!1),this.each(function(){function b(){return window.getSelection?window.getSelection():document.selection&&document.selection.createRange&&"None"!=document.selection.type?document.selection.createRange():void 0}function c(a,c){var d,f=b();window.getSelection?(f.anchorNode&&f.getRangeAt&&(d=f.getRangeAt(0)),d&&(f.removeAllRanges(),f.addRange(d)),j.match(/msie/)||document.execCommand("StyleWithCSS",!1,!1),document.execCommand(a,!1,c)):document.selection&&document.selection.createRange&&"None"!=document.selection.type&&(d=document.selection.createRange(),d.execCommand(a,!1,c)),e(!1,!1)}function d(c,d,f){if(H.not(":focus")&&H.focus(),window.getSelection){var g,h,i,j=b();j.anchorNode&&j.getRangeAt&&(g=j.getRangeAt(0),h=document.createElement(c),a(h).attr(d,f),i=g.extractContents(),h.appendChild(i),g.insertNode(h),j.removeAllRanges(),"style"==d?e(a(h),f):e(a(h),!1))}else if(document.selection&&document.selection.createRange&&"None"!=document.selection.type){var k=document.selection.createRange(),l=k.htmlText,m="<"+c+" "+d+'="'+f+'">'+l+"</"+c+">";document.selection.createRange().pasteHTML(m)}}function e(a,b){var c=ba();if(c=c?c:a,c&&0==b)c.parent().is("[style]")&&c.attr("style",c.parent().attr("style")),c.is("[style]")&&c.find("*").attr("style",c.attr("style"));else if(a&&b&&a.is("[style]")){var d=b.split(";");d=d[0].split(":"),a.is("[style*="+d[0]+"]")&&a.find("*").css(d[0],d[1]),f(a)}}function f(b){if(b){var b=b[0];if(document.body.createTextRange){var c=document.body.createTextRange();c.moveToElementText(b),c.select()}else if(window.getSelection){var d=window.getSelection(),c=document.createRange();"undefined"!=b&&null!=b&&(c.selectNodeContents(b),d.removeAllRanges(),d.addRange(c),a(b).is(":empty")&&(a(b).append(" "),f(a(b))))}}}function h(){if(F.data("sourceOpened"))m(!1);else{var b=ba(),c="http://";if(m(!0),b){var e=b.prop("tagName").toLowerCase();"a"==e&&b.is("[href]")?(c=b.attr("href"),b.attr(O,"")):d("a",O,"")}else K.val(c).focus();J.click(function(b){(a(b.target).hasClass(i.css+"_linktypetext")||a(b.target).hasClass(i.css+"_linktypearrow"))&&n(!0)}),M.find("a").click(function(){var b=a(this).attr(i.css+"-linktype");M.data("linktype",b),N.find("."+i.css+"_linktypetext").html(M.find("a:eq("+M.data("linktype")+")").text()),o(c),n()}),o(c),K.focus().val(c).bind("keypress keyup",function(a){return 13==a.keyCode?(l(E.find("["+O+"]")),!1):void 0}),L.click(function(){l(E.find("["+O+"]"))})}}function l(b){K.focus(),f(b),b.removeAttr(O),"2"!=M.data("linktype")?c("createlink",K.val()):(c("insertImage",K.val()),H.find("img").each(function(){var b=a(this).prev("a"),c=a(this).next("a");b.length>0&&""==b.html()?b.remove():c.length>0&&""==c.html()&&c.remove()})),m(),H.trigger("change")}function m(a){r("["+O+"]:not([href])"),E.find("["+O+"][href]").removeAttr(O),a?(F.data("linkOpened",!0),G.show()):(F.data("linkOpened",!1),G.hide()),n()}function n(a){a?M.show():M.hide()}function o(a){var b=M.data("linktype");K.val("1"!=b||"http://"!=K.val()&&!K.is("[value^=http://]")&&K.is("[value^=mailto]")?"1"==b||K.is("[value^=http://]")?a:"http://":"mailto:")}function p(b){F.data("sourceOpened")?q(styleField,!1):("fSize"==b?styleField=_:"colors"==b&&(styleField=aa),q(styleField,!0),styleField.find("a").unbind("click").click(function(){var c=a(this).attr(i.css+"-styleval");"fSize"==b?(styleType="font-size",c+=i.funit):"colors"==b&&(styleType="color",c="rgb("+c+")");var e=s(styleType);d("span","style",styleType+":"+c+";"+e),q("",!1),a("."+i.css+"_title").remove(),H.trigger("change")})),m(!1)}function q(a,b){var c="",d=[{d:"fsizeOpened",f:_},{d:"cpallOpened",f:aa}];if(""!=a)for(var e=0;e<d.length;e++)a==d[e].f&&(c=d[e]);if(b){F.data(c.d,!0),c.f.slideDown(100);for(var e=0;e<d.length;e++)c.d!=d[e].d&&(F.data(d[e].d,!1),d[e].f.slideUp(100))}else for(var e=0;e<d.length;e++)F.data(d[e].d,!1),d[e].f.slideUp(100)}function r(b){E.find(b).each(function(){a(this).before(a(this).html()).remove()})}function s(a){var b=ba();if(b&&b.is("[style]")&&""!=b.css(a)){var c=b.css(a);b.css(a,"");var d=b.attr("style");return b.css(a,c),d}return""}function t(){u(!0),$.find("a").click(function(){a("*",this).click(function(a){return a.preventDefault(),!1}),v(a(this).text());var b=a(this).attr(i.css+"-formatval");c("formatBlock","<"+b+">"),u(!1)})}function u(a){var b=a?!0:!1;b=a&&$.data("status")?!0:!1,b||!a?$.data("status",!1).slideUp(200):$.data("status",!0).slideDown(200)}function v(a){var b=$.closest("."+i.css+"_tool").find("."+i.css+"_tool_label").find("."+i.css+"_tool_text");a.length>10&&(a=a.substr(0,7)+"..."),b.html(a)}function w(a){var b,c,d;for(b=a.replace(/\n/gim,"").replace(/\r/gim,"").replace(/\t/gim,"").replace(/ /gim," "),c=[/\<span(|\s+.*?)><span(|\s+.*?)>(.*?)<\/span><\/span>/gim,/<(\w*[^p])\s*[^\/>]*>\s*<\/\1>/gim,/\<div(|\s+.*?)>(.*?)\<\/div>/gim,/\<strong(|\s+.*?)>(.*?)\<\/strong>/gim,/\<em(|\s+.*?)>(.*?)\<\/em>/gim],d=["<span$2>$3</span>","","<p$1>$2</p>","<b$1>$2</b>","<i$1>$2</i>"],W=0;5>W;W++)for(var e=0;e<c.length;e++)b=b.replace(c[e],d[e]);if(i.p||(b=b.replace(/\<p(|\s+.*?)>(.*?)\<\/p>/gi,"<br/>$2")),!i.br){c=[/\<br>(.*?)/gi,/\<br\/>(.*?)/gi],d=["<p>$1</p>","<p>$1</p>"];for(var e=0;e<c.length;e++)b=b.replace(c[e],d[e])}return i.p||i.br||(b=b.replace(/\<p>(.*?)\<\/p>/gi,"<div>$1</div>")),b}function x(){var a=""==H.text()&&H.html().length<12?"":H.html();B.val(w(a))}function y(){H.html(w(B.val()))}function z(b){var c,d=!1,e=ba();return e?(a.each(b,function(b,f){c=e.prop("tagName").toLowerCase(),c==f?d=!0:e.parents().each(function(){c=a(this).prop("tagName").toLowerCase(),c==f&&(d=!0)})}),d):!1}function A(b){for(var c=0;c<k.length;c++)i[k[c].name]&&k[c].emphasis&&""!=k[c].tag&&(z(k[c].tag)?F.find("."+i.css+"_tool_"+k[c].cls).addClass(I):a("."+i.css+"_tool_"+k[c].cls).removeClass(I));if(i.format&&a.isArray(i.formats)){for(var d=!1,e=0;e<i.formats.length;e++){var f=[];if(f[0]=i.formats[e][0],i.formats[e][0].length>0&&z(f)){v(i.formats[e][1]),d=!0;break}}d||v(i.formats[0][1])}q("",!1),u(!1)}if(a(this).data("jqte")&&null!=a(this).data("jqte")&&"undefined"!=a(this).data("jqte")?a(this).data("jqte",!1):a(this).data("jqte",!0),i.status&&a(this).data("jqte")){var B=a(this),C=a(this).prop("tagName").toLowerCase();a(this).attr("data-origin",C);var D=a(this).is("[value]")||"textarea"==C?a(this).val():a(this).html();D=D.replace(/&#34;/g,'"').replace(/&#39;/g,"'").replace(/</g,"<").replace(/>/g,">").replace(/&/g,"&"),a(this).after('<div class="'+i.css+'"></div>');var E=a(this).next("."+i.css);E.html('<div class="'+i.css+'_toolbar" role="toolbar" unselectable></div><div class="'+i.css+'_linkform" style="display:none" role="dialog"></div><div class="'+i.css+'_editor"></div>');var F=E.find("."+i.css+"_toolbar"),G=E.find("."+i.css+"_linkform"),H=E.find("."+i.css+"_editor"),I=i.css+"_tool_depressed";G.append('<div class="'+i.css+'_linktypeselect" unselectable></div><input class="'+i.css+'_linkinput" type="text/css" value=""><div class="'+i.css+'_linkbutton" unselectable>'+i.button+'</div> <div style="height:1px;float:none;clear:both"></div>');var J=G.find("."+i.css+"_linktypeselect"),K=G.find("."+i.css+"_linkinput"),L=G.find("."+i.css+"_linkbutton");J.append('<div class="'+i.css+'_linktypeview" unselectable></div><div class="'+i.css+'_linktypes" role="menu" unselectable></div>');var M=J.find("."+i.css+"_linktypes"),N=J.find("."+i.css+"_linktypeview"),O=i.css+"-setlink";H.after('<div class="'+i.css+"_source "+i.css+'_hiddenField"></div>');var P=E.find("."+i.css+"_source");if(B.appendTo(P),"textarea"!=C){var Q="";a(B[0].attributes).each(function(){"type"!=this.nodeName&&"value"!=this.nodeName&&(Q=Q+" "+this.nodeName+'="'+this.nodeValue+'"')}),B.replaceWith("<textarea "+Q+">"+D+"</textarea>"),B=P.find("textarea")}H.attr("contenteditable","true").html(D);for(var R=0;R<k.length;R++)if(i[k[R].name]){var S=k[R].key.length>0&&null!=i.titletext[R].hotkey&&"undefined"!=i.titletext[R].hotkey&&""!=i.titletext[R].hotkey?" (Ctrl+"+i.titletext[R].hotkey+")":"",T=null!=i.titletext[R].title&&"undefined"!=i.titletext[R].title&&""!=i.titletext[R].title?i.titletext[R].title+S:"";if(F.append('<div class="'+i.css+"_tool "+i.css+"_tool_"+k[R].cls+'" role="button" data-tool="'+R+'" unselectable><a class="'+i.css+'_tool_icon" unselectable></a></div>'),F.find("."+i.css+"_tool[data-tool="+R+"]").data({tag:k[R].tag,command:k[R].command,emphasis:k[R].emphasis,title:T}),"format"==k[R].name&&a.isArray(i.formats)){var U=i.formats[0][1].length>0&&"undefined"!=i.formats[0][1]?i.formats[0][1]:"";F.find("."+i.css+"_tool_"+k[R].cls).find("."+i.css+"_tool_icon").replaceWith('<a class="'+i.css+'_tool_label" unselectable><span class="'+i.css+'_tool_text" unselectable>'+U+'</span><span class="'+i.css+'_tool_icon" unselectable></span></a>'),F.find("."+i.css+"_tool_"+k[R].cls).append('<div class="'+i.css+'_formats" unselectable></div>');for(var V=0;V<i.formats.length;V++)F.find("."+i.css+"_formats").append("<a "+i.css+'-formatval="'+i.formats[V][0]+'" class="'+i.css+"_format "+i.css+"_format_"+V+'" role="menuitem" unselectable>'+i.formats[V][1]+"</a>");F.find("."+i.css+"_formats").data("status",!1)}else if("fsize"==k[R].name&&a.isArray(i.fsizes)){F.find("."+i.css+"_tool_"+k[R].cls).append('<div class="'+i.css+'_fontsizes" unselectable></div>');for(var V=0;V<i.fsizes.length;V++)F.find("."+i.css+"_fontsizes").append("<a "+i.css+'-styleval="'+i.fsizes[V]+'" class="'+i.css+'_fontsize" style="font-size:'+i.fsizes[V]+i.funit+'" role="menuitem" unselectable>Abcdefgh...</a>')}else if("color"==k[R].name&&a.isArray(g)){F.find("."+i.css+"_tool_"+k[R].cls).append('<div class="'+i.css+'_cpalette" unselectable></div>');for(var W=0;W<g.length;W++)F.find("."+i.css+"_cpalette").append(null!=g[W]?"<a "+i.css+'-styleval="'+g[W]+'" class="'+i.css+'_color" style="background-color: rgb('+g[W]+')" role="gridcell" unselectable></a>':'<div class="'+i.css+'_colorSeperator"></div>')}}M.data("linktype","0");for(var R=0;3>R;R++)M.append("<a "+i.css+'-linktype="'+R+'" unselectable>'+i.linktypes[R]+"</a>"),N.html('<div class="'+i.css+'_linktypearrow" unselectable></div><div class="'+i.css+'_linktypetext">'+M.find("a:eq("+M.data("linktype")+")").text()+"</div>");var X="";if(X=/msie/.test(j)?"-ms-":/chrome/.test(j)||/safari/.test(j)||/yandex/.test(j)?"-webkit-":/mozilla/.test(j)?"-moz-":/opera/.test(j)?"-o-":/konqueror/.test(j)?"-khtml-":"",i.placeholder&&""!=i.placeholder){E.prepend('<div class="'+i.css+'_placeholder" unselectable><div class="'+i.css+'_placeholder_text">'+i.placeholder+"</div></div>");var Y=E.find("."+i.css+"_placeholder");Y.click(function(){H.focus()})}E.find("[unselectable]").css(X+"user-select","none").addClass("unselectable").attr("unselectable","on").on("selectstart mousedown",!1);var Z=F.find("."+i.css+"_tool"),$=F.find("."+i.css+"_formats"),_=F.find("."+i.css+"_fontsizes"),aa=F.find("."+i.css+"_cpalette"),ba=function(){var b,c;if(window.getSelection&&(c=getSelection(),b=c.anchorNode),!b&&document.selection&&document.selection.createRange&&"None"!=document.selection.type){c=document.selection;var d=c.getRangeAt?c.getRangeAt(0):c.createRange();b=d.commonAncestorContainer?d.commonAncestorContainer:d.parentElement?d.parentElement():d.item(0)}return b?a("#text"==b.nodeName?b.parentNode:b):!1};Z.unbind("click").click(function(b){"displaysource"!=a(this).data("command")||F.data("sourceOpened")?(F.data("sourceOpened")?(F.data("sourceOpened",!1),F.find("."+i.css+"_tool").removeClass(i.css+"_hiddenField"),P.addClass(i.css+"_hiddenField"),H.removeClass(i.css+"_hiddenField")):"linkcreator"==a(this).data("command")?F.data("linkOpened")?(m(!1),u(!1)):h():"formats"==a(this).data("command")?("formats"!=a(this).data("command")||a(b.target).hasClass(i.css+"_format")||t(),q("",!1),H.not(":focus")&&H.focus()):"fSize"==a(this).data("command")||"colors"==a(this).data("command")?(("fSize"==a(this).data("command")&&!a(b.target).hasClass(i.css+"_fontsize")||"colors"==a(this).data("command")&&!a(b.target).hasClass(i.css+"_color"))&&p(a(this).data("command")),u(!1),H.not(":focus")&&H.focus()):(H.not(":focus")&&H.focus(),c(a(this).data("command"),null),q("",!1),u(!1),n(),1!=a(this).data("emphasis")||a(this).hasClass(I)?a(this).removeClass(I):a(this).addClass(I),P.addClass(i.css+"_hiddenField"),H.removeClass(i.css+"_hiddenField")),i.placeholder&&""!=i.placeholder&&(""!=H.html()?Y.hide():Y.show())):(F.find("."+i.css+"_tool").addClass(i.css+"_hiddenField"),a(this).removeClass(i.css+"_hiddenField"),F.data("sourceOpened",!0),B.css("height",H.outerHeight()),P.removeClass(i.css+"_hiddenField"),H.addClass(i.css+"_hiddenField"),B.focus(),m(!1),q("",!1),u(),i.placeholder&&""!=i.placeholder&&Y.hide()),H.trigger("change")}).hover(function(b){if(i.title&&""!=a(this).data("title")&&(a(b.target).hasClass(i.css+"_tool")||a(b.target).hasClass(i.css+"_tool_icon"))){a("."+i.css+"_title").remove(),E.append('<div class="'+i.css+'_title"><div class="'+i.css+'_titleArrow"><div class="'+i.css+'_titleArrowIcon"></div></div><div class="'+i.css+'_titleText">'+a(this).data("title")+"</div></div>");var c=a("."+i.css+"_title:first"),d=(c.find("."+i.css+"_titleArrowIcon"),a(this).position()),e=d.left+a(this).outerWidth()-c.outerWidth()/2-a(this).outerWidth()/2,f=d.top+a(this).outerHeight()+5;c.delay(400).css({top:f,left:e}).fadeIn(200)}},function(){a("."+i.css+"_title").remove()});var ca=null;H.bind("keypress keyup keydown drop cut copy paste DOMCharacterDataModified DOMSubtreeModified",function(){F.data("sourceOpened")||a(this).trigger("change"),n(),a.isFunction(i.change)&&i.change(),i.placeholder&&""!=i.placeholder&&(""!=a(this).text()?Y.hide():Y.show())}).bind("change",function(){F.data("sourceOpened")||(clearTimeout(ca),ca=setTimeout(x,10))}).keydown(function(a){if(a.ctrlKey)for(var b=0;b<k.length;b++)if(i[k[b].name]&&a.keyCode==k[b].key.charCodeAt(0))return""!=k[b].command&&"linkcreator"!=k[b].command?c(k[b].command,null):"linkcreator"==k[b].command&&h(),!1}).bind("mouseup keyup",A).focus(function(){if(a.isFunction(i.focus)&&i.focus(),E.addClass(i.css+"_focused"),/opera/.test(j)){var b=document.createRange();b.selectNodeContents(H[0]),b.collapse(!1);var c=window.getSelection();c.removeAllRanges(),c.addRange(b)}}).focusout(function(){Z.removeClass(I),q("",!1),u(!1),n(),a.isFunction(i.blur)&&i.blur(),E.removeClass(i.css+"_focused"),a.isArray(i.formats)&&v(i.formats[0][1])}),B.bind("keydown keyup",function(){setTimeout(y,0),a(this).height(a(this)[0].scrollHeight),""==a(this).val()&&a(this).height(0)}).focus(function(){E.addClass(i.css+"_focused")}).focusout(function(){E.removeClass(i.css+"_focused")})}else if(a(this).closest("."+i.css).length>0){var da=a(this).closest("."+i.css).find("."+i.css+"_editor").html(),Q="";a(a(this)[0].attributes).each(function(){"style"!=this.nodeName&&(Q=Q+" "+this.nodeName+'="'+this.nodeValue+'"')});var C=a(this).is("[data-origin]")&&""!=a(this).attr("data-origin")?a(this).attr("data-origin"):"textarea",ea=">"+da;("input"==C||"option"==C)&&(da=da.replace(/"/g,"&#34;").replace(/'/g,"&#39;").replace(/</g,"<").replace(/>/g,">"),ea='value="'+da+'">');var fa=a(this).clone();a(this).data("jqte",!1).closest("."+i.css).before(fa).remove(),fa.replaceWith("<"+C+Q+ea+"</"+C+">")}})}}(jQuery);