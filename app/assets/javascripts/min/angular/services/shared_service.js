homeApp.service("sharedService",["$timeout","$rootScope","ColorConstants","$location","bookService","shelfService","$mdToast","infinityService","$mdDialog",function(a,b,c,d,e,f,g,h,i){this.get_popular_books=function(a,b){var c=!(a.info.loading||!angular.isUndefined(a.constant)&&a.constant.show_book||!angular.isUndefined(a.info.author_filter)&&a.info.author_filter||!angular.isUndefined(a.info.group_by_alphabet)&&a.info.group_by_alphabet||a.info.reading_time_filter||a.info.published_era_filter||a.info.custom_loading||a.info.subject_filter||!(a.info.infinity||angular.isUndefined(a.info.infinity)||angular.isDefined(b)));c&&this.load_popular_books(a,b)},this.show_book_dialog=function(a,b,c,d){a.active_book=c,a.active_book.show_info_only=!0,i.show({templateUrl:"/assets/angular/html/news/book.html",scope:b,preserveScope:!0,clickOutsideToClose:!0,targetEvent:d}),d.stopPropagation()},this.filtered_books=function(a){if(!a.info.fetching_books){var b=a.info.books.length;a.info.loading=!0,a.info.fetching_books=!0,h.get_books(b).then(function(b){angular.forEach(b.books,function(a){var b=Math.floor(Math.random()*c.value.length),d=angular.extend(a,{color:c.value[b]});this.push(d)},a.info.books),a.info.loading=!1,a.info.fetching_books=!1,delete b.books,a.info.other_info=b})}},this.toggle_bookmark=function(a,b,c){var d={bottom:!1,top:!0,left:!1,right:!0},e=function(){return Object.keys(d).filter(function(a){return d[a]}).join(" ")};if(angular.isUndefined(b)||!b)var h=!0;else var h=!1;var i=c.id,j=c.type,k=a.label_key||a.key,l={id:i,type:j,shelf:k,status:h};f.bookmark(l),g.show({controller:"toastController",templateUrl:"assets/angular/html/shared/toast/bookmark_action.html",hideDelay:6e3,position:e()})},this.load_popular_books=function(a,b){a.info.loading=!0,angular.isUndefined(b)&&(b=angular.isUndefined(a.info.books)?[]:a.info.books);var d=b.length;angular.isUndefined(a.filters)&&(a.filters={});var f=angular.extend(a.filters,{skip_count:d});f=angular.toJson(f);var g=function(b){var c=!1;return angular.forEach(a.info.categories,function(a){angular.equals(a,b)&&(c=!0)}),!c};e.get_popular_books(f).then(function(d){var e=function(a){if(a.pages_count<50)var b="For a flight journey";else if(a.pages_count<100)var b="For a weekend getaway";else if(a.pages_count<=250)var b="For a week holiday";else if(a.pages_count>250)var b="For a month vacation";else var b="Dont Know";return b},f=function(a){if(a.published_year>2e3)var b="Contemporary";else if(a.published_year>=1939&&a.published_year<2e3)var b="Post Modern Literature";else if(a.published_year>=1900&&a.published_year<1939)var b="Modernism";else if(a.published_year>=1837&&a.published_year<1901)var b="Victorian Literature";else if(a.published_year>=1900&&a.published_year<1939)var b="Romanticism";else if(a.published_year>=1798&&a.published_year<1837)var b="Neo Classical Period";else if(a.published_year>=1900&&a.published_year<1939)var b="English Renaissance";else if(a.published_year>=1660&&a.published_year<1798)var b="Middle English Literature";else if(a.published_year>=1900&&a.published_year<1939)var b="Old English Literature";else var b="Don't Know";return b};angular.forEach(d,function(b){angular.isDefined(a.info.categories)&&angular.forEach(b.root_category,function(b){0==a.info.categories.length?null!=b.name&&a.info.categories.push(b):angular.forEach(a.info.categories,function(a){!angular.equals(b,a)&&g(b)&&null!=b.name&&this.push(b)},a.info.categories)});var d=Math.floor(Math.random()*c.value.length),h=null!=b.status,i=e(b),j=f(b),k={published_era:j,reading_time:i,status:h,isBook:!0,colspan:1,color:c.value[d],rowspan:1,alphabet:b.title[0]};k=angular.extend(b,k),this.push(k)},b),a.info.loading=!1})}}]);